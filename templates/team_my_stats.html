
{% extends "layout_main.html" %}


{% block body %}

        <div class='col-12 dtop flex menu-header-bar'>
            <div class='col-12'>
                <a href='/' class='menu-link'><span class='menu-link' style='padding-left:10px;'><span class='font-15'>Home</span></span></a>
                <a href='/team_my_schedule' class='menu-link'><span class='menu-link' style='padding-left:10px;'><span class='font-15'>My Schedule</span></span></a>
                <a href='/team_my_stats' class='menu-link active'><span class='menu-link' style=''><span class='active-link font-15'>My Stats</span></span></a>
                <a href='/team_my_rankings' class='menu-link'><span class='menu-link' style=''><span class='font-15'>My Rankings</span></span></a>
            </div>
        </div>

        <div class='col-12 centered' id='banner'></div>
        
        
        
        {% if misc.error %}
            <div class='col-12 error centered'><span class='error' >{{misc.error}}</span></div>
        {% endif %}
        {% if misc.msg %}
            <div class='col-12 error centered'><span class='' >{{misc.msg}}</span></div>
        {% endif %}
        <div class=''>
            <div class='no-padding options-bar col-12 flex'>
                <div class='no-padding col-9'>
                {% if misc.breadcrumbs %}
                    <div class='breadcrumbs'>
                        {{misc.breadcrumbs|safe}}
                    </div>
                {% endif %}
                </div>
                <div class='no-padding col-3 right'>
                    <div class='no-padding col-12 right'>
                        <div class='gear-settings'>
                            <img onclick='toggle_settings_bar("settings-bar");' id='settings-icon' class='icon-15 settings' src='/static/img/blue_gear15.png' />
                        </div>
                    </div>
                </div>
                
            </div>
            <div class='settings-bar single-row not-shown no-padding right' id='settings-bar'>
                <div class='' style='padding-right:10px;'>
                    <span class='font-13' style='padding-right:10px;'>Year</span>
                    <select class='settings-bar' id='general_focus_year' onchange='update_settings(this.id, this.value);'>
                        <option value=2020>2020</option>
                        <option value=2019>2019</option>
                    </select>
                </div>
            </div>
            <div class='refreshing-bar not-shown no-padding right' id='refreshing-bar'>
                <div class='centered' style=''>
                    <span class='font-18 bold' style=''>Refreshing content...</span>
                </div>
            </div>
            
            
            <div class='non-dashboard-landing'>
                <div class='col-12 mob centered no-padding'>
                    <select style='width:80%; margin: 0% 10%;' id='top_menu_select' onChange='choose_left_menu_item(this.value);'>
                        <option id='offense_option' value='offense'>Offense</option>
                        <option id='defense_option' value='defense'>Defense</option>
                        <option id='faceoffs_option' value='faceoffs'>Faceoffs</option>
                        <option id='goalkeepers_option' value='goalkeepers'>Goalkeepers</option>
                    </select>
                </div>
                <div class='flex col-12 no-padding'>
                    <div class='left-menu col-2-12 dtop'>
                        <div id='offense_menu_item' onclick='choose_left_menu_item(this.id);' class='active left-menu-item'><span class='mouseover-link pointer font-15'>Offense</span></div>
                        <div id='defense_menu_item' onclick='choose_left_menu_item(this.id);' class='left-menu-item'><span class='mouseover-link pointer font-15'>Defense</span></div>
                        <div id='faceoffs_menu_item' onclick='choose_left_menu_item(this.id);' class='left-menu-item'><span class='mouseover-link pointer font-15'>Faceoffs</span></div>
                        <div id='goalkeepers_menu_item' onclick='choose_left_menu_item(this.id);' class='left-menu-item'><span class='mouseover-link pointer font-15'>Goalkeepers</span></div>
                    </div>
                    <div class='right-content col-10-12' id='right-content-panel'>
                        <div class='right-content-panel' id='offense_panel'>
                            <div class='col-12 no-padding'>
                                <div class='non-dashboard-section card col-12' id='offensive_ranks_container_div'>
                                    <div class='non-dashboard-section-header'>
                                        <div onclick='drill_down_header(this.id, 1);' id='offensive_ranks_label' route="|offensive_ranks" class='col-11-9 no-padding non-dashboard-label'>Offensive Ranks</div>
                                                    
                                        <div class='col-1 right no-padding dashboard-tile-help-icon icon-visible mob' id='offensive_ranks_filtericon' style='margin-top:2px;'><img onclick='toggle_settings_bar("offensive-ranks-settings-bar");' class='icon-15 settings'  src="static/img/gray_Filter150.png" /></div>
                                        <div class='col-1 right no-padding dashboard-tile-help-icon icon-visible' id='offensive_ranks_helpicon' style='margin-top:2px;'><img class='icon-15 explanation' value="team_my_stats.html|offensive_ranks" src="static/img/Gray_Info150.png" /></div>
                                        <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='offensive_ranks_img' class='icon-15 toggle' onclick='toggle_tile_visibility("offensive_ranks");' src="static/img/Gray_Minus150.png" /></div>
                                                
                                                    
                                        
                                    </div>
                                    <div class='non-dashboard-tile-content bigger visible' id='offensive_ranks_div'>
                                        <div class='no-padding'>
                                            <div class='mob no-padding' style=''>
                                                <div class='settings-bar rounded not-shown no-padding' id='offensive-ranks-settings-bar'>
                                                    <div class='' style='margin-bottom:25px;'>
                                                        <div class='no-padding col-12 flex'>
                                                            <div class='col-4 margin white'>
                                                                <div class='light col-12 no-padding'><span class=' no-padding font-15'>Metric</span></div>
                                                                <div id='offensive_ranks_stat_select_mob' class='stat-select'> </div>
                                                            </div>
                                                            <div class='col-4 margin white'>
                                                                <div class='light col-12 no-padding'><span class=' no-padding font-15'>Comparison</span></div>
                                                                <div class='col-12 flex no-padding' id='offensive_ranks_mob_peers'></div>
                                                                
                                                            </div>
                                                            <div class='col-4 margin white'>
                                                                <div class='light col-12 no-padding'><span class=' no-padding font-15'>Calculation</span></div>
                                                                <div class='col-12 flex no-padding' id='offensive_ranks_mob_calculation'></div>
                                                                
                                                            </div>
                                                        </div>
                                                        
                                                        <div class='margin white no-padding'>
                                                            <div class='light no-padding'><span class='font-15'>Filters</span></div>
                                                            <div id='offensive_ranks_filter_options_ranks_mob' class='block-flex filter-options'></div>
                                                        </div>
                                                        
                                                    
                                                    </div>
                                                </div>
                                                
                                            </div>
                                            <div class='flex no-padding'>
                                                <div class='col-8-12 non-dashboard-tile-section' id='offensive_ranks_graph_div' style=''>
                                                
                                                </div>
                                            
                                              
                                                <div class='col-2 dtop non-dashboard-tile-section' style=''>
                                                    <div class='col-12 no-padding'><span class='no-padding font-15 bold'>Select a Stat</span></div>
                                                    <div id='offensive_ranks_stat_tags_dtop' class='stat-tags'> </div>
                                                    <div class='no-padding centered'><span class='font-12'>- OR -</span></div>
                                                    <div id='offensive_ranks_stat_select_dtop' class='stat-select'> </div>
                                                    <div class='col-12 no-padding' style='padding-top:10px;'><span class='no-padding font-15 bold'>Calculation</span></div>
                                                    <div class='col-12 flex no-padding'>
                    
                                                    <div class='col-10 no-padding' style='padding-left:10px;'><span class='contents font-11'>Raw</span></div>
                                                    <div class='col-2 no-padding right'><input value='offensive_calculation_raw' type=radio name='radio1' class='offensive_calculation_radio' onclick='toggler(this);'></div>
                                                    </div>
                                                    <div class='col-12 flex no-padding'>
                    
                                                    <div class='col-10 no-padding' style='padding-left:10px;'><span class='contents font-11'>Adjusted</span></div>
                                                    <div class='col-2 no-padding right'><input value='offensive_calculation_adjusted'  class='offensive_calculation_radio' type=radio name='radio2' onclick='toggler(this);'></div>
                                                    </div>
                                                </div>
                                            
                                              
                                                <div class='col-2 dtop non-dashboard-tile-section'>
                                                    <div class='col-12 no-padding'><span class='no-padding font-15 bold'>Filter</span></div>
                                                    <div id='offensive_ranks_filter_options_dtop' class='filter-options'></div>
                                                    
                                                    {% if misc.data.conference_ID %}
                                                    <div class='col-12 no-padding' style='padding-top:10px;'><span class='no-padding font-15 bold'>Comparison</span></div>
                                                    <div class='col-12 flex no-padding'>
                    
                                                    <div class='col-10 no-padding' style='padding-left:5px;'><span class='contents font-11'>League-wide</span></div>
                                                    <div class='col-2 no-padding right'><input value='offensive_peers_league' type=radio name='radio3' class='offensive_peers_radio' onclick='toggler(this);'></div>
                                                    </div>
                                                    <div class='col-12 flex no-padding'>
                    
                                                    <div class='col-10 no-padding' style='padding-left:5px;'><span class='contents font-11'>Conference</span></div>
                                                    <div class='col-2 no-padding right'><input value='offensive_peers_conference' class='offensive_peers_radio' type=radio name='radio4' onclick='toggler(this);'></div>
                                                    </div>
                                                {% endif %}
                                                </div>
                                                
                                                
                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <div class='non-dashboard-section card col-12' id='offensive_profile_container_div'>
                                    <div class='non-dashboard-section-header'>
                                        <div onclick='drill_down_header(this.id, 1);' id='offensive_profile_label' route="|offensive_profile" class='col-11-10 no-padding non-dashboard-label'>Time-based Profile</div>
                                                    
                                        <div class='col-1 right no-padding dashboard-tile-help-icon' id='offensive_profile_helpicon' style='margin-top:2px;'></div>
                                        <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='offensive_profile_img' class='icon-15 toggle' onclick='toggle_tile_visibility("offensive_profile");' src="static/img/Gray_Plus150.png" /></div>
                                                
                                                    
                                        
                                    </div>
                                    <div class='non-dashboard-tile-content' id='offensive_profile_div'>
                                        <div class='flex-block'>
                                            <div class='col-4-12 non-dashboard-tile-section' id='offensive_shooting_profile_graph_container_div'>
                                                <div class='flex no-padding'>
                                                    <div class='col-10 no-padding'><span class='no-padding font-15 bold'>Shooting Profile</span></div>
                                                    <div class='col-2 no-padding'><img class='icon-15 explanation' value="team_my_stats.html|offensive_profile" src="static/img/Gray_Info150.png" /></div>
                                                </div>
                                                <div class='col-12 no-padding small_graph' style='' id='offensive_shooting_profile_graph_div'></div>
                                            </div>
                                            <div class='col-4-12 non-dashboard-tile-section' id='offensive_pace_profile_graph_container_div' style=''>
                                                <div class='flex no-padding'>
                                                    <div class='col-10 no-padding'><span class='no-padding font-15 bold'>Pace Profile: Length</span></div>
                                                    <div class='col-2 no-padding'><img class='icon-15 explanation' value="team_my_stats.html|offensive_profile" src="static/img/Gray_Info150.png" /></div>
                                                </div>
                                                <div class='col-12 no-padding small_graph' style='' id='offensive_pace_profile_graph_div'></div>
                                            </div>
                                            <div class='col-4-12 non-dashboard-tile-section' id='offensive_1st_shot_profile_graph_container_div' style=''>
                                                <div class='flex no-padding'>
                                                    <div class='col-10 no-padding'><span class='no-padding font-15 bold'>Pace Profile: 1st Shot</span></div>
                                                    <div class='col-2 no-padding'><img class='icon-15 explanation' value="team_my_stats.html|offensive_profile" src="static/img/Gray_Info150.png" /></div>
                                                </div>
                                                <div class='col-12 no-padding small_graph' style='' id='offensive_1st_shot_profile_graph_div'></div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <div class='non-dashboard-section card col-12' id='offensive_movement_container_div'>
                                    <div class='non-dashboard-section-header'>
                                        <div onclick='drill_down_header(this.id, 1);' id='offensive_movement_label' route="|offensive_movement" class='col-11-9 no-padding non-dashboard-label'>Performance Trends</div>
                                                    
                                        <div class='col-1 right no-padding dashboard-tile-help-icon mob' id='offensive_movement_filtericon' style='margin-top:2px;'><img onclick='toggle_settings_bar("offensive-movement-settings-bar");' class='icon-15 settings'  src="static/img/gray_Filter150.png" /></div>
                                        <div class='col-1 right no-padding dashboard-tile-help-icon' id='offensive_movement_helpicon' style='margin-top:2px;'><img class='icon-15 explanation' value="team_my_stats.html|offensive_movement" src="static/img/Gray_Info150.png" /></div>
                                        <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='offensive_movement_img' class='icon-15 toggle' onclick='toggle_tile_visibility("offensive_movement");' src="static/img/Gray_Plus150.png" /></div>
                                                
                                                    
                                        
                                    </div>
                                    <div class='non-dashboard-tile-content bigger' id='offensive_movement_div'>
                                        <div class='no-padding'>
                                            <div class='mob no-padding' style=''>
                                               
                                                <div class='settings-bar rounded not-shown no-padding' id='offensive-movement-settings-bar'>
                                                    <div class='' style='margin-bottom:25px;'>
                                                        <div class='no-padding col-12 flex'>
                                                            <div class='col-4 margin white'>
                                                                <div class='light col-12 no-padding'><span class=' no-padding font-15'>Metric</span></div>
                                                                <div id='offensive_movement_stat_select_mob' class='stat-select'> </div>
                                                            </div>
                                                            <div class='col-4 margin white'>
                                                                <div class='light col-12 no-padding'><span class=' no-padding font-15'>Comparison</span></div>
                                                                <div class='col-12 flex no-padding' id='offensive_movement_mob_peers'></div>   
                                                            </div>
                                                        </div>
                                                        
                                                        <div class='margin white no-padding'>
                                                            <div class='light no-padding'><span class='font-15'>Filters</span></div>
                                                            <div id='offensive_movement_filter_options_movement_mob' class='block-flex filter-options'></div>
                                                        </div>
                                                        
                                                    
                                                    </div>
                                                </div>
                                                
                                            </div>
                                    
                                        <div class='flex no-padding'>
                                            <div class='col-8-12 non-dashboard-tile-section' id='offensive_movement_graph_div' style=''>
                                                
                                            </div>
                                        
                                          
                                            <div class='col-2 dtop non-dashboard-tile-section' style=''>
                                                <div class='col-12 no-padding'><span class='no-padding font-15 bold'>Select a Stat</span></div>
                                                <div id='offensive_movement_stat_tags_dtop' class='stat-tags'> </div>
                                                <div class='no-padding centered'><span class='font-12'>- OR -</span></div>
                                                <div id='offensive_movement_stat_select_dtop' class='stat-select'> </div>
                                                <div class='col-12 no-padding' style='padding-top:10px;'><span class='no-padding font-15 bold'>Calculation</span></div>
                                                <div class='col-12 flex no-padding'>
                
                                                <div class='col-10 no-padding' style='padding-left:10px;'><span class='contents font-11'>Raw</span></div>
                                                <div class='col-2 no-padding right'><input value='offensive_calculation_raw' type=radio name='radio5' class='offensive_calculation_radio' onclick='toggler(this);'></div>
                                                </div>
                                                <div class='col-12 flex no-padding'>
                
                                                <div class='col-10 no-padding' style='padding-left:10px;'><span class='contents font-11'>Adjusted</span></div>
                                                <div class='col-2 no-padding right'><input value='offensive_calculation_adjusted' class='offensive_calculation_radio' type=radio name='radio6' onclick='toggler(this);'></div>
                                                </div>
                                            </div>
                                        
                                          
                                            <div class='col-2 dtop non-dashboard-tile-section'>
                                                <div class='col-12 no-padding'><span class='no-padding font-15 bold'>Filter</span></div>
                                                <div id='offensive_movement_filter_options_dtop' class='filter-options'></div>
                                            </div>
                                            
                                            
                                        </div>

                                    </div>
                                </div>
                            
                                </div>
                            
                            </div>
                        </div>
                        <div class='right-content-panel' id='defense_panel'>
                            <div class='col-12 no-padding'>
                                <div class='non-dashboard-section card col-12' id='defensive_ranks_container_div'>
                                    <div class='non-dashboard-section-header'>
                                        <div onclick='drill_down_header(this.id, 1);' id='defensive_ranks_label' route="|defensive_ranks" class='col-11-9 no-padding non-dashboard-label'>Defensive Ranks</div>
                                                    
                                        <div class='col-1 right no-padding dashboard-tile-help-icon icon-visible mob' id='defensive_ranks_filtericon' style='margin-top:2px;'><img onclick='toggle_settings_bar("defensive-ranks-settings-bar");' class='icon-15 settings'  src="static/img/gray_Filter150.png" /></div>
                                        <div class='col-1 right no-padding dashboard-tile-help-icon icon-visible' id='defensive_ranks_helpicon' style='margin-top:2px;'><img class='icon-15 explanation' value="team_my_stats.html|defensive_ranks" src="static/img/Gray_Info150.png" /></div>
                                        <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='defensive_ranks_img' class='icon-15 toggle' onclick='toggle_tile_visibility("defensive_ranks");' src="static/img/Gray_Minus150.png" /></div>
                                                
                                                    
                                        
                                    </div>
                                    <div class='non-dashboard-tile-content bigger visible' id='defensive_ranks_div'>
                                        <div class='no-padding'>
                                            <div class='mob no-padding' style=''>
                                                <div class='settings-bar rounded not-shown no-padding' id='defensive-ranks-settings-bar'>
                                                    <div class='' style='margin-bottom:25px;'>
                                                        <div class='no-padding col-12 flex'>
                                                            <div class='col-4 margin white'>
                                                                <div class='light col-12 no-padding'><span class=' no-padding font-15'>Metric</span></div>
                                                                <div id='defensive_ranks_stat_select_mob' class='stat-select'> </div>
                                                            </div>
                                                            <div class='col-4 margin white'>
                                                                <div class='light col-12 no-padding'><span class=' no-padding font-15'>Comparison</span></div>
                                                                <div class='col-12 flex no-padding' id='defensive_ranks_mob_peers'></div>
                                                                
                                                            </div>
                                                            <div class='col-4 margin white'>
                                                                <div class='light col-12 no-padding'><span class=' no-padding font-15'>Calculation</span></div>
                                                                <div class='col-12 flex no-padding' id='defensive_ranks_mob_calculation'></div>
                                                                
                                                            </div>
                                                        </div>
                                                        
                                                        <div class='margin white no-padding'>
                                                            <div class='light no-padding'><span class='font-15'>Filters</span></div>
                                                            <div id='defensive_ranks_filter_options_ranks_mob' class='block-flex filter-options'></div>
                                                        </div>
                                                        
                                                    
                                                    </div>
                                                </div>
                                                
                                            </div>
                                            <div class='flex no-padding'>
                                                <div class='col-8-12 non-dashboard-tile-section' id='defensive_ranks_graph_div' style=''>
                                                
                                                </div>
                                            
                                              
                                                <div class='col-2 dtop non-dashboard-tile-section' style=''>
                                                    <div class='col-12 no-padding'><span class='no-padding font-15 bold'>Select a Stat</span></div>
                                                    <div id='defensive_ranks_stat_tags_dtop' class='stat-tags'> </div>
                                                    <div class='no-padding centered'><span class='font-12'>- OR -</span></div>
                                                    <div id='defensive_ranks_stat_select_dtop' class='stat-select'> </div>
                                                    <div class='col-12 no-padding' style='padding-top:10px;'><span class='no-padding font-15 bold'>Calculation</span></div>
                                                    <div class='col-12 flex no-padding'>
                    
                                                    <div class='col-10 no-padding' style='padding-left:10px;'><span class='contents font-11'>Raw</span></div>
                                                    <div class='col-2 no-padding right'><input value='defensive_calculation_raw' type=radio name='radio7' class='defensive_calculation_radio' onclick='toggler(this);'></div>
                                                    </div>
                                                    <div class='col-12 flex no-padding'>
                    
                                                    <div class='col-10 no-padding' style='padding-left:10px;'><span class='contents font-11'>Adjusted</span></div>
                                                    <div class='col-2 no-padding right'><input value='defensive_calculation_adjusted'  class='defensive_calculation_radio' type=radio name='radio8' onclick='toggler(this);'></div>
                                                    </div>
                                                </div>
                                            
                                              
                                                <div class='col-2 dtop non-dashboard-tile-section'>
                                                    <div class='col-12 no-padding'><span class='no-padding font-15 bold'>Filter</span></div>
                                                    <div id='defensive_ranks_filter_options_dtop' class='filter-options'></div>
                                                    
                                                    {% if misc.data.conference_ID %}
                                                    <div class='col-12 no-padding' style='padding-top:10px;'><span class='no-padding font-15 bold'>Comparison</span></div>
                                                    <div class='col-12 flex no-padding'>
                    
                                                    <div class='col-10 no-padding' style='padding-left:5px;'><span class='contents font-11'>League-wide</span></div>
                                                    <div class='col-2 no-padding right'><input value='defensive_peers_league' type=radio name='radio9' class='defensive_peers_radio' onclick='toggler(this);'></div>
                                                    </div>
                                                    <div class='col-12 flex no-padding'>
                    
                                                    <div class='col-10 no-padding' style='padding-left:5px;'><span class='contents font-11'>Conference</span></div>
                                                    <div class='col-2 no-padding right'><input value='defensive_peers_conference' class='defensive_peers_radio' type=radio name='radio10' onclick='toggler(this);'></div>
                                                    </div>
                                                {% endif %}
                                                </div>
                                                
                                                
                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <div class='non-dashboard-section card col-12' id='defensive_profile_container_div'>
                                    <div class='non-dashboard-section-header'>
                                        <div onclick='drill_down_header(this.id, 1);' id='defensive_profile_label' route="|defensive_profile" class='col-11-10 no-padding non-dashboard-label'>Time-based Profile</div>
                                                    
                                        <div class='col-1 right no-padding dashboard-tile-help-icon' id='defensive_profile_helpicon' style='margin-top:2px;'></div>
                                        <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='defensive_profile_img' class='icon-15 toggle' onclick='toggle_tile_visibility("defensive_profile");' src="static/img/Gray_Plus150.png" /></div>
                                                
                                                    
                                        
                                    </div>
                                    <div class='non-dashboard-tile-content' id='defensive_profile_div'>
                                        <div class='flex-block'>
                                            <div class='col-4-12 non-dashboard-tile-section' id='defensive_shooting_profile_graph_container_div'>
                                                <div class='flex no-padding'>
                                                    <div class='col-10 no-padding'><span class='no-padding font-15 bold'>Shooting Profile</span></div>
                                                    <div class='col-2 no-padding'><img class='icon-15 explanation' value="team_my_stats.html|defensive_profile" src="static/img/Gray_Info150.png" /></div>
                                                </div>
                                                <div class='col-12 no-padding small_graph' style='' id='defensive_shooting_profile_graph_div'></div>
                                            </div>
                                            <div class='col-4-12 non-dashboard-tile-section' id='defensive_pace_profile_graph_container_div' style=''>
                                                <div class='flex no-padding'>
                                                    <div class='col-10 no-padding'><span class='no-padding font-15 bold'>Pace Profile: Length</span></div>
                                                    <div class='col-2 no-padding'><img class='icon-15 explanation' value="team_my_stats.html|defensive_profile" src="static/img/Gray_Info150.png" /></div>
                                                </div>
                                                <div class='col-12 no-padding small_graph' style='' id='defensive_pace_profile_graph_div'></div>
                                            </div>
                                            <div class='col-4-12 non-dashboard-tile-section' id='defensive_1st_shot_profile_graph_container_div' style=''>
                                                <div class='flex no-padding'>
                                                    <div class='col-10 no-padding'><span class='no-padding font-15 bold'>Pace Profile: 1st Shot</span></div>
                                                    <div class='col-2 no-padding'><img class='icon-15 explanation' value="team_my_stats.html|defensive_profile" src="static/img/Gray_Info150.png" /></div>
                                                </div>
                                                <div class='col-12 no-padding small_graph' style='' id='defensive_1st_shot_profile_graph_div'></div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <div class='non-dashboard-section card col-12' id='defensive_movement_container_div'>
                                    <div class='non-dashboard-section-header'>
                                        <div onclick='drill_down_header(this.id, 1);' id='defensive_movement_label' route="|defensive_movement" class='col-11-9 no-padding non-dashboard-label'>Performance Trends</div>
                                                    
                                        <div class='col-1 right no-padding dashboard-tile-help-icon mob' id='defensive_movement_filtericon' style='margin-top:2px;'><img onclick='toggle_settings_bar("defensive-movement-settings-bar");' class='icon-15 settings'  src="static/img/gray_Filter150.png" /></div>
                                        <div class='col-1 right no-padding dashboard-tile-help-icon' id='defensive_movement_helpicon' style='margin-top:2px;'><img class='icon-15 explanation' value="team_my_stats.html|defensive_movement" src="static/img/Gray_Info150.png" /></div>
                                        <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='defensive_movement_img' class='icon-15 toggle' onclick='toggle_tile_visibility("defensive_movement");' src="static/img/Gray_Plus150.png" /></div>
                                                
                                                    
                                        
                                    </div>
                                    <div class='non-dashboard-tile-content bigger' id='defensive_movement_div'>
                                        <div class='no-padding'>
                                            <div class='mob no-padding' style=''>
                                               
                                                <div class='settings-bar rounded not-shown no-padding' id='defensive-movement-settings-bar'>
                                                    <div class='' style='margin-bottom:25px;'>
                                                        <div class='no-padding col-12 flex'>
                                                            <div class='col-4 margin white'>
                                                                <div class='light col-12 no-padding'><span class=' no-padding font-15'>Metric</span></div>
                                                                <div id='defensive_movement_stat_select_mob' class='stat-select'> </div>
                                                            </div>
                                                            <div class='col-4 margin white'>
                                                                <div class='light col-12 no-padding'><span class=' no-padding font-15'>Comparison</span></div>
                                                                <div class='col-12 flex no-padding' id='defensive_movement_mob_peers'></div>   
                                                            </div>
                                                        </div>
                                                        
                                                        <div class='margin white no-padding'>
                                                            <div class='light no-padding'><span class='font-15'>Filters</span></div>
                                                            <div id='defensive_movement_filter_options_movement_mob' class='block-flex filter-options'></div>
                                                        </div>
                                                        
                                                    
                                                    </div>
                                                </div>
                                                
                                            </div>
                                    
                                        <div class='flex no-padding'>
                                            <div class='col-8-12 non-dashboard-tile-section' id='defensive_movement_graph_div' style=''>
                                                
                                            </div>
                                        
                                          
                                            <div class='col-2 dtop non-dashboard-tile-section' style=''>
                                                <div class='col-12 no-padding'><span class='no-padding font-15 bold'>Select a Stat</span></div>
                                                <div id='defensive_movement_stat_tags_dtop' class='stat-tags'> </div>
                                                <div class='no-padding centered'><span class='font-12'>- OR -</span></div>
                                                <div id='defensive_movement_stat_select_dtop' class='stat-select'> </div>
                                                <div class='col-12 no-padding' style='padding-top:10px;'><span class='no-padding font-15 bold'>Calculation</span></div>
                                                <div class='col-12 flex no-padding'>
                
                                                <div class='col-10 no-padding' style='padding-left:10px;'><span class='contents font-11'>Raw</span></div>
                                                <div class='col-2 no-padding right'><input value='defensive_calculation_raw' type=radio name='radio11' class='defensive_calculation_radio' onclick='toggler(this);'></div>
                                                </div>
                                                <div class='col-12 flex no-padding'>
                
                                                <div class='col-10 no-padding' style='padding-left:10px;'><span class='contents font-11'>Adjusted</span></div>
                                                <div class='col-2 no-padding right'><input value='defensive_calculation_adjusted' class='defensive_calculation_radio' type=radio name='radio12' onclick='toggler(this);'></div>
                                                </div>
                                            </div>
                                        
                                          
                                            <div class='col-2 dtop non-dashboard-tile-section'>
                                                <div class='col-12 no-padding'><span class='no-padding font-15 bold'>Filter</span></div>
                                                <div id='defensive_movement_filter_options_dtop' class='filter-options'></div>
                                            </div>
                                            
                                            
                                        </div>

                                    </div>
                                </div>
                            
                                </div>
                            
                            </div>
                        </div>
                        <div class='right-content-panel' id='faceoffs_panel'>
                            <div class='col-12 no-padding'>
                                <div class='non-dashboard-section card col-12' id='faceoffs_ranks_container_div'>
                                    <div class='non-dashboard-section-header'>
                                        
                                        <div onclick='drill_down_header(this.id, 1);' id='faceoffs_ranks_label' route="|faceoffs_ranks" class='col-11-9 no-padding non-dashboard-label'>
                                            {% if misc.data.gender == 'men' %}
                                                Faceoff Ranks
                                            {% else %}
                                                Draw Control Ranks
                                            {% endif %}
                                        </div>
                                        
                                        <div class='col-1 right no-padding dashboard-tile-help-icon icon-visible mob' id='faceoffs_ranks_filtericon' style='margin-top:2px;'><img onclick='toggle_settings_bar("faceoffs-ranks-settings-bar");' class='icon-15 settings'  src="static/img/gray_Filter150.png" /></div>
                                        <div class='col-1 right no-padding dashboard-tile-help-icon icon-visible' id='faceoffs_ranks_helpicon' style='margin-top:2px;'><img class='icon-15 explanation' value="team_my_stats.html|faceoffs_ranks" src="static/img/Gray_Info150.png" /></div>
                                        <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='faceoffs_ranks_img' class='icon-15 toggle' onclick='toggle_tile_visibility("faceoffs_ranks");' src="static/img/Gray_Minus150.png" /></div>
                                                
                                                    
                                        
                                    </div>
                                    <div class='non-dashboard-tile-content bigger visible' id='faceoffs_ranks_div'>
                                        <div class='no-padding'>
                                            <div class='mob no-padding' style=''>
                                                <div class='settings-bar rounded not-shown no-padding' id='faceoffs-ranks-settings-bar'>
                                                    <div class='' style='margin-bottom:25px;'>
                                                        <div class='no-padding col-12 flex'>
                                                            <div class='col-6 margin white'>
                                                                <div class='light col-12 no-padding'><span class=' no-padding font-15'>Comparison</span></div>
                                                                <div class='col-12 flex no-padding' id='faceoffs_ranks_mob_peers'></div>
                                                                
                                                            </div>
                                                            <div class='col-6 margin white'>
                                                                <div class='light col-12 no-padding'><span class=' no-padding font-15'>Calculation</span></div>
                                                                <div class='col-12 flex no-padding' id='faceoffs_ranks_mob_calculation'></div>
                                                                
                                                            </div>
                                                        </div>
                                                        
                                                        <div class='margin white no-padding'>
                                                            <div class='light no-padding'><span class='font-15'>Filters</span></div>
                                                            <div id='faceoffs_ranks_filter_options_ranks_mob' class='block-flex filter-options'></div>
                                                        </div>
                                                        
                                                    
                                                    </div>
                                                </div>
                                                
                                            </div>
                                            <div class='flex no-padding'>
                                                <div class='col-8-12 non-dashboard-tile-section' id='faceoffs_ranks_graph_div' style=''>
                                                
                                                </div>
                                            
                                              
                                                <div class='col-2 dtop non-dashboard-tile-section' style=''>
                                                    
                                                    <div class='col-12 no-padding'><span class='no-padding font-15 bold'>Calculation</span></div>
                                                    <div class='col-12 flex no-padding'>
                    
                                                    <div class='col-10 no-padding' style='padding-left:10px;'><span class='contents font-11'>Raw</span></div>
                                                    <div class='col-2 no-padding right'><input value='faceoffs_calculation_raw' type=radio name='radio13' class='faceoffs_calculation_radio' onclick='toggler(this);'></div>
                                                    </div>
                                                    <div class='col-12 flex no-padding'>
                    
                                                    <div class='col-10 no-padding' style='padding-left:10px;'><span class='contents font-11'>Adjusted</span></div>
                                                    <div class='col-2 no-padding right'><input value='faceoffs_calculation_adjusted'  class='faceoffs_calculation_radio' type=radio name='radio14' onclick='toggler(this);'></div>
                                                    </div>
                                                </div>
                                            
                                              
                                                <div class='col-2 dtop non-dashboard-tile-section'>
                                                    <div class='col-12 no-padding'><span class='no-padding font-15 bold'>Filter</span></div>
                                                    <div id='faceoffs_ranks_filter_options_dtop' class='filter-options'></div>
                                                    
                                                    {% if misc.data.conference_ID %}
                                                    <div class='col-12 no-padding' style='padding-top:10px;'><span class='no-padding font-15 bold'>Comparison</span></div>
                                                    <div class='col-12 flex no-padding'>
                    
                                                    <div class='col-10 no-padding' style='padding-left:5px;'><span class='contents font-11'>League-wide</span></div>
                                                    <div class='col-2 no-padding right'><input value='faceoffs_peers_league' type=radio name='radio15' class='faceoffs_peers_radio' onclick='toggler(this);'></div>
                                                    </div>
                                                    <div class='col-12 flex no-padding'>
                    
                                                    <div class='col-10 no-padding' style='padding-left:5px;'><span class='contents font-11'>Conference</span></div>
                                                    <div class='col-2 no-padding right'><input value='faceoffs_peers_conference' class='faceoffs_peers_radio' type=radio name='radio16' onclick='toggler(this);'></div>
                                                    </div>
                                                {% endif %}
                                                </div>
                                                
                                                
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                            <div class='col-12 flex-block no-padding'>
                                <div class='non-dashboard-section card col-6-12' id='faceoff_elo_container_div'>
                                    <div class='non-dashboard-section-header'>
                                        <div class='col-11-10 no-padding non-dashboard-label'>Player Ratings</div>
                                                    
                                        <div class='col-1 right no-padding dashboard-tile-help-icon' id='faceoff_elo_helpicon' style='margin-top:2px;'><img class='icon-15 explanation' value="team_my_stats.html|faceoff_elo" src="static/img/Gray_Info150.png" /></div>
                                        <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='faceoff_elo_img' class='icon-15 toggle' onclick='toggle_tile_visibility("faceoff_elo");' src="static/img/Gray_Plus150.png" /></div>
                                                
                                                    
                                        
                                    </div>
                                    <div class='non-dashboard-tile-content' id='faceoff_elo_div'>
                                        
                                    </div>

                                </div>
                                <div class='non-dashboard-section card col-6-12' id='faceoff_splits_container_div'>
                                    <div class='non-dashboard-section-header'>
                                        <div class='col-11-10 no-padding non-dashboard-label'>W/L Splits</div>
                                                    
                                        <div class='col-1 right no-padding dashboard-tile-help-icon' id='faceoff_splits_helpicon' style='margin-top:2px;'><img class='icon-15 explanation' value="team_my_stats.html|faceoff_splits" src="static/img/Gray_Info150.png" /></div>
                                        <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='faceoff_splits_img' class='icon-15 toggle' onclick='toggle_tile_visibility("faceoff_splits");' src="static/img/Gray_Plus150.png" /></div>
                                                
                                                    
                                        
                                    </div>
                                    <div class='non-dashboard-tile-content' id='faceoff_splits_div'>
                                        
                                    </div>

                                </div>
                            </div>
                            
                        </div>
                        <div class='right-content-panel' id='goalkeepers_panel'>
                            <div class='col-12 no-padding'>
                                <div class='col-12 no-padding'>
                                <div class='non-dashboard-section card col-12' id='goalkeepers_ranks_container_div'>
                                    <div class='non-dashboard-section-header'>
                                        
                                        <div onclick='drill_down_header(this.id, 1);' id='goalkeepers_ranks_label' route="|goalkeepers_ranks" class='col-11-9 no-padding non-dashboard-label'>Goalkeepers Ranks</div>
                                        
                                        <div class='col-1 right no-padding dashboard-tile-help-icon icon-visible mob' id='goalkeepers_ranks_filtericon' style='margin-top:2px;'><img onclick='toggle_settings_bar("goalkeepers-ranks-settings-bar");' class='icon-15 settings'  src="static/img/gray_Filter150.png" /></div>
                                        <div class='col-1 right no-padding dashboard-tile-help-icon icon-visible' id='goalkeepers_ranks_helpicon' style='margin-top:2px;'><img class='icon-15 explanation' value="team_my_stats.html|goalkeepers_ranks" src="static/img/Gray_Info150.png" /></div>
                                        <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='goalkeepers_ranks_img' class='icon-15 toggle' onclick='toggle_tile_visibility("goalkeepers_ranks");' src="static/img/Gray_Minus150.png" /></div>
                                                
                                                    
                                        
                                    </div>
                                    <div class='non-dashboard-tile-content bigger visible' id='goalkeepers_ranks_div'>
                                        <div class='no-padding'>
                                            <div class='mob no-padding' style=''>
                                                <div class='settings-bar rounded not-shown no-padding' id='goalkeepers-ranks-settings-bar'>
                                                    <div class='' style='margin-bottom:25px;'>
                                                        <div class='no-padding col-12 flex'>
                                                            <div class='col-6 margin white'>
                                                                <div class='light col-12 no-padding'><span class=' no-padding font-15'>Comparison</span></div>
                                                                <div class='col-12 flex no-padding' id='goalkeepers_ranks_mob_peers'></div>
                                                                
                                                            </div>
                                                            <div class='col-6 margin white'>
                                                                <div class='light col-12 no-padding'><span class=' no-padding font-15'>Calculation</span></div>
                                                                <div class='col-12 flex no-padding' id='goalkeepers_ranks_mob_calculation'></div>
                                                                
                                                            </div>
                                                        </div>
                                                        
                                                        <div class='margin white no-padding'>
                                                            <div class='light no-padding'><span class='font-15'>Filters</span></div>
                                                            <div id='goalkeepers_ranks_filter_options_ranks_mob' class='block-flex filter-options'></div>
                                                        </div>
                                                        
                                                    
                                                    </div>
                                                </div>
                                                
                                            </div>
                                            <div class='flex no-padding'>
                                                <div class='col-8-12 non-dashboard-tile-section' id='goalkeepers_ranks_graph_div' style=''>
                                                
                                                </div>
                                            
                                              
                                                <div class='col-2 dtop non-dashboard-tile-section' style=''>
                                                    
                                                    <div class='col-12 no-padding'><span class='no-padding font-15 bold'>Calculation</span></div>
                                                    <div class='col-12 flex no-padding'>
                    
                                                    <div class='col-10 no-padding' style='padding-left:10px;'><span class='contents font-11'>Raw</span></div>
                                                    <div class='col-2 no-padding right'><input value='goalkeepers_calculation_raw' type=radio name='radio19' class='goalkeepers_calculation_radio' onclick='toggler(this);'></div>
                                                    </div>
                                                    <div class='col-12 flex no-padding'>
                    
                                                    <div class='col-10 no-padding' style='padding-left:10px;'><span class='contents font-11'>Adjusted</span></div>
                                                    <div class='col-2 no-padding right'><input value='goalkeepers_calculation_adjusted'  class='goalkeepers_calculation_radio' type=radio name='radio20' onclick='toggler(this);'></div>
                                                    </div>
                                                </div>
                                            
                                              
                                                <div class='col-2 dtop non-dashboard-tile-section'>
                                                    <div class='col-12 no-padding'><span class='no-padding font-15 bold'>Filter</span></div>
                                                    <div id='goalkeepers_ranks_filter_options_dtop' class='filter-options'></div>
                                                    
                                                    {% if misc.data.conference_ID %}
                                                    <div class='col-12 no-padding' style='padding-top:10px;'><span class='no-padding font-15 bold'>Comparison</span></div>
                                                    <div class='col-12 flex no-padding'>
                    
                                                    <div class='col-10 no-padding' style='padding-left:5px;'><span class='contents font-11'>League-wide</span></div>
                                                    <div class='col-2 no-padding right'><input value='goalkeepers_peers_league' type=radio name='radio21' class='goalkeepers_peers_radio' onclick='toggler(this);'></div>
                                                    </div>
                                                    <div class='col-12 flex no-padding'>
                    
                                                    <div class='col-10 no-padding' style='padding-left:5px;'><span class='contents font-11'>Conference</span></div>
                                                    <div class='col-2 no-padding right'><input value='goalkeepers_peers_conference' class='goalkeepers_peers_radio' type=radio name='radio22' onclick='toggler(this);'></div>
                                                    </div>
                                                {% endif %}
                                                </div>
                                                
                                                
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                            <div class='col-12 flex-block no-padding'>
                                <div class='non-dashboard-section card col-6-12' id='goalkeepers_adjusted_shotclock_container_div'>
                                    <div class='non-dashboard-section-header'>
                                        <div class='col-11-10 no-padding non-dashboard-label'>by Shot Clock Bucket</div>
                                                    
                                        <div class='col-1 right no-padding dashboard-tile-help-icon' id='goalkeepers_adjusted_shotclock_helpicon' style='margin-top:2px;'><img class='icon-15 explanation' value="team_my_stats.html|goalkeepers_adjusted_shotclock" src="static/img/Gray_Info150.png" /></div>
                                        <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='goalkeepers_adjusted_shotclock_img' class='icon-15 toggle' onclick='toggle_tile_visibility("goalkeepers_adjusted_shotclock");' src="static/img/Gray_Plus150.png" /></div>
                                                
                                                    
                                        
                                    </div>
                                    <div class='non-dashboard-tile-content' id='goalkeepers_adjusted_shotclock_div' style='padding-bottom:10px;'>
                                        
                                    </div>

                                </div>
                                <div class='non-dashboard-section card col-6-12' id='goalkeepers_adjusted_manup_container_div'>
                                    <div class='non-dashboard-section-header'>
                                        <div class='col-11-10 no-padding non-dashboard-label'>by Man-up/Even</div>
                                                    
                                        <div class='col-1 right no-padding dashboard-tile-help-icon' id='goalkeepers_adjusted_manup_helpicon' style='margin-top:2px;'><img class='icon-15 explanation' value="team_my_stats.html|goalkeepers_adjusted_manup" src="static/img/Gray_Info150.png" /></div>
                                        <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='goalkeepers_adjusted_manup_img' class='icon-15 toggle' onclick='toggle_tile_visibility("goalkeepers_adjusted_manup");' src="static/img/Gray_Plus150.png" /></div>
                                                
                                                    
                                        
                                    </div>
                                    <div class='non-dashboard-tile-content' id='goalkeepers_adjusted_manup_div'>
                                        
                                    </div>

                                </div>
                            </div>
                            <div class='col-12 flex-block no-padding'>
                                <div class='non-dashboard-section card col-6-12' id='goalkeepers_adjusted_leading_container_div'>
                                    <div class='non-dashboard-section-header'>
                                        <div class='col-11-10 no-padding non-dashboard-label'>by Game Status</div>
                                                    
                                        <div class='col-1 right no-padding dashboard-tile-help-icon' id='goalkeepers_adjusted_leading_helpicon' style='margin-top:2px;'><img class='icon-15 explanation' value="team_my_stats.html|goalkeepers_adjusted_leading" src="static/img/Gray_Info150.png" /></div>
                                        <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='goalkeepers_adjusted_leading_img' class='icon-15 toggle' onclick='toggle_tile_visibility("goalkeepers_adjusted_leading");' src="static/img/Gray_Plus150.png" /></div>
                                                
                                                    
                                        
                                    </div>
                                    <div class='non-dashboard-tile-content' id='goalkeepers_adjusted_leading_div'>
                                        
                                    </div>

                                </div>
                                <div class='non-dashboard-section card col-6-12' id='goalkeepers_adjusted_possessiontype_container_div'>
                                    <div class='non-dashboard-section-header'>
                                        <div class='col-11-10 no-padding non-dashboard-label'><!--by Possession Type--></div>
                                                    
                                        <div class='col-1 right no-padding dashboard-tile-help-icon' id='goalkeepers_adjusted_possessiontype_helpicon' style='margin-top:2px;'><img class='icon-15 explanation' value="team_my_stats.html|goalkeepers_adjusted_possessiontype" src="static/img/Gray_Info150.png" /></div>
                                        <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='goalkeepers_adjusted_possessiontype_img' class='icon-15 toggle' onclick='toggle_tile_visibility("goalkeepers_adjusted_possessiontype");' src="static/img/Gray_Plus150.png" /></div>
                                                
                                                    
                                        
                                    </div>
                                    <div class='non-dashboard-tile-content' id='goalkeepers_adjusted_possessiontype_div'>
                                        
                                    </div>

                                </div>
                            </div>
                            
                        </div>
                        
                    </div>
                </div>
            </div>
            
        </div>
    

<script src="static/js/d3.v4.min.js"></script><script src="static/js/laxrefpro_graphing.js?dt=1"></script>
<script>
    var on_mobile = null;
    var console_log = []; var success = null;
    var time_log = JSON.parse({{misc.time_log|to_json2}});
    
    var single_stat = "<div class='col-12'><span class='lightish contents font-20'>[header]</span></div>";
    single_stat += "<div class='col-12 centered ' style='padding-top:65px;'><span class='tile-message font-18'>[stat]</span></div>";
    
    time_log.push({'tag': "parse misc to JSON", 'start': new Date().getTime()});
    var misc = parse_misc({{misc|to_json2}});
    time_log[time_log.length-1].end = new Date().getTime();
        
    console_log.push({'msg': 'Loaded misc...'});
    var user_obj = {'settings': {{user_obj.settings|to_json2}}};
    console_log.push({'msg': 'Loaded user settings...'});
    //console.log(misc);
    var explanations = {{user_obj.explanations|to_json2}};
    
    var ranks_stat_tag = {'offense': "efficiency", 'defense': "efficiency", 'faceoffs': 'faceoff_win_rate', 'goalkeepers': 'save_pct'}; var filters = {'offense': [], 'defense': [], 'faceoffs': [], 'goalkeepers': []};
    var calc_specs = {'offense': null, 'defense': null, 'faceoffs': null, 'goalkeepers': null}
    filters.offense.options = [{'tag': 'WinProb', 'desc': 'Game Situation', 'choices': [{'desc': 'Garbage Time', 'val': 'NonCompetitive'}, {'desc': 'Competitive', 'val': 'Competitive'}]}];
    filters.defense.options = [{'tag': 'WinProb', 'desc': 'Game Situation', 'choices': [{'desc': 'Garbage Time', 'val': 'NonCompetitive'}, {'desc': 'Competitive', 'val': 'Competitive'}]}];
    filters.faceoffs.options = [{'tag': 'WinProb', 'desc': 'Game Situation', 'choices': [{'desc': 'Garbage Time', 'val': 'NonCompetitive'}, {'desc': 'Competitive', 'val': 'Competitive'}]}];
    filters.goalkeepers.options = [{'tag': 'WinProb', 'desc': 'Game Situation', 'choices': [{'desc': 'Garbage Time', 'val': 'NonCompetitive'}, {'desc': 'Competitive', 'val': 'Competitive'}]}];
    
    
    var default_settings = {};
    tmp_tags = {'offensive': 1, 'defensive': 1, 'faceoffs': 1, 'goalkeepers': 1}
    for(tmp in tmp_tags){
        if((tmp + '_ranks_calculation') in user_obj.settings){ default_settings[tmp + '_ranks_calculation'] = user_obj.settings[tmp + '_ranks_calculation'].val; }
        else{ default_settings[tmp + '_ranks_calculation'] = "raw"; }
        
        if((tmp + '_ranks_peers') in user_obj.settings){ default_settings[tmp + '_ranks_peers'] = user_obj.settings[tmp + '_ranks_peers'].val; }
        else{ default_settings[tmp + '_ranks_peers'] = "league"; }
    }
    /*if('defensive_ranks_calculation' in user_obj.settings){ default_settings.defensive_ranks_calculation = user_obj.settings.defensive_ranks_calculation.val; }
    else{ default_settings.defensive_ranks_calculation = "raw"; }
    
    if('defensive_ranks_peers' in user_obj.settings){ default_settings.defensive_ranks_peers = user_obj.settings.defensive_ranks_peers.val; }
    else{ default_settings.defensive_ranks_peers = "league"; }
    */
    
    for(k in filters){
        unit_desc = "";
        if(k == "offense"){ unit_desc = "offensive"; data_type = "offense"; }
        else if(k == "defense"){ unit_desc = "defensive"; data_type = "defense"; }
        else if(k == "faceoffs"){ unit_desc = "faceoffs"; data_type = "offense"; }
        else if(k == "goalkeepers"){ unit_desc = "goalkeepers"; data_type = "defense"; }

        calc_specs[k] = {'overlap_solved': 0, 'peers': default_settings[unit_desc + '_ranks_peers'], 'calculation': default_settings[unit_desc + '_ranks_calculation'], 'data_type': data_type, 'filters': [{'filter': null, 'includes': [null]}]};
        if('options' in filters[k]){
            for(var a = 0;a<filters[k].options.length;a++){
                for(var b = 0;b<filters[k].options[a].choices.length;b++){
                    filters[k].options[a].choices[b].selected = 1;
                }
            }
        }
    }
    console.log(calc_specs.faceoffs);
    console.log("Set true: input[value='faceoffs_calculation_" + calc_specs.faceoffs.calculation + "']");
    
    $("input[value='offensive_peers_" + calc_specs.offense.peers + "']").prop("checked", true);
    $("input[value='offensive_calculation_" + calc_specs.offense.calculation + "']").prop("checked", true);
    $("input[value='defensive_peers_" + calc_specs.defense.peers + "']").prop("checked", true);
    $("input[value='defensive_calculation_" + calc_specs.defense.calculation + "']").prop("checked", true);
    $("input[value='faceoffs_peers_" + calc_specs.faceoffs.peers + "']").prop("checked", true);
    $("input[value='faceoffs_calculation_" + calc_specs.faceoffs.calculation + "']").prop("checked", true);
    $("input[value='goalkeepers_peers_" + calc_specs.goalkeepers.peers + "']").prop("checked", true);
    $("input[value='goalkeepers_calculation_" + calc_specs.goalkeepers.calculation + "']").prop("checked", true);
    
    function toggle_rank_filter(id, s, checked){
        
        id_tokens = id.split("|");
        tokens = s.split("|");
        filter_list = tokens[0];
        tag = tokens[1];
        val = tokens[2];
        
        fltr = filters[id_tokens[0]].options.filter(d => d.tag == id_tokens[1])[0]
        
        for(var b = 0;b<fltr.choices.length;b++){
            if(val == fltr.choices[b].val){ fltr.choices[b].selected = (checked) ? 1: 0; }
        }
        
        filter_settings = []
        for(var a = 0;a<filters[id_tokens[0]].options.length;a++){
            all_selected = true;
            none_selected = true;
            f = {'filter': tag, 'includes': []}
            for(var b = 0;b<filters[id_tokens[0]].options[a].choices.length;b++){
                if(filters[id_tokens[0]].options[a].choices[b].selected){
                    none_selected = false;
                    f.includes.push(filters[id_tokens[0]].options[a].choices[b].val);
                }
                else{
                    all_selected = false;
                }
            }
            if(!none_selected && !all_selected){
                filter_settings.push(f);
            }
        }
        if(filter_settings.length == 0){
            filter_settings.push({'filter': null, 'includes': [null]});
        }
        

        
        calc_specs[id_tokens[0]].data_type = null;
        if(['offense', 'faceoffs'].indexOf(id_tokens[0]) > -1){ calc_specs[id_tokens[0]].data_type ="offense"; }
        else{ calc_specs[id_tokens[0]].data_type ="defense"; }
        calc_specs[id_tokens[0]].filters = filter_settings;
        
        if(id_tokens[0] == "offense"){ display_primary_unit("offense", "offensive_ranks"); }  
        if(id_tokens[0] == "defense"){ display_primary_unit("defense", "defensive_ranks"); } 
        if(id_tokens[0] == "faceoffs"){ display_faceoffs("faceoffs", "faceoffs_ranks"); }    
        if(id_tokens[0] == "goalkeepers"){ display_goalkeepers("goalkeepers", "goalkeepers_ranks"); }    
        
    }
    
    
    function calculate_ranks(raw_data, teams, data_keys, specs, tag){
        
        time_log.push({'tag': "calculate_ranks", 'start': new Date().getTime()});
        
        data = JSON.parse(JSON.stringify(raw_data));
        data = data.filter(r => r.data_type == specs.data_type);

        for(var a = 0;a<specs.filters.length;a++){
            var flt = specs.filters[a];
            data = data.filter(r => r.filter == flt.filter && flt.includes.indexOf(r.filter_val) > -1);
        }
        
        stat_key = misc.data.ranks.stat_keys.filter( r => r.tag == tag)[0];
        adj_tag = 'adj_' + stat_key.tag
        adj = (specs.calculation == "raw") ? 0 : 1;
        game_results = [];
        adj_game_results = [];
        
        for(var a = 0;a<teams.length;a++){
            team = teams[a];
            team.radius = 10;
            team_data = data.filter(r => r.team_ID == team.ID);
            if(team.ID == 62){  console.log(team_data);   }
            sum = 0.0; n = 0.0;
            if(stat_key.calc.operation == "divide"){
                sum1 = 0.0; sum2 = 0.0; adj_val = 0.0;
                if('val3' in stat_key.calc){
                    for(var b = 0;b<team_data.length;b++){ r = team_data[b];
                        sum1 += r[stat_key.calc.val1]; sum2 += r[stat_key.calc.val2] + r[stat_key.calc.val3];
                        if(adj_tag in r){ 
                            adj_val += (r[stat_key.calc.val2] + r[stat_key.calc.val3]) * r[adj_tag]; 
                        }
                        
                        if(misc.data.ID == team.ID){
                            game_val = (r[stat_key.calc.val2] + r[stat_key.calc.val3] > 0) ?  r[stat_key.calc.val1]/(r[stat_key.calc.val2] + r[stat_key.calc.val3]) : null;
                            game_results.push({'x': game_results.length + 1, 'y': game_val});
                            
                            if(adj_tag in r){ 
                                adj_game_val = game_val + r[adj_tag]; 
                                adj_game_results.push({'x': adj_game_results.length + 1, 'y': adj_game_val});
                            }
                            
                        }
                    }
                }
                else{
                    for(var b = 0;b<team_data.length;b++){ r = team_data[b];
                        sum1 += r[stat_key.calc.val1]; sum2 += r[stat_key.calc.val2];
                        if(adj_tag in r){ adj_val += r[stat_key.calc.val2] * r[adj_tag];  }
                        
                        
                        if(misc.data.ID == team.ID){
                            game_val = (r[stat_key.calc.val2] > 0) ? r[stat_key.calc.val1]/(r[stat_key.calc.val2]) : null;
                            game_results.push({'x': game_results.length + 1, 'y': game_val});
                            
               
                            if(adj_tag in r){ 
                                adj_game_val = game_val + r[adj_tag]; 
                                adj_game_results.push({'x': adj_game_results.length + 1, 'y': adj_game_val});
                            }
                        }
                    }
                }
                
                if(adj){
                    //if(misc.data.ID==team.ID){ console.log("Final", adj_val, sum1,  sum2, ((adj_val + sum1) / sum2)); }
                    val = (sum2 > 0) ? ((adj_val + sum1) / sum2) : null;
                }
                else{
                    val = (sum2 > 0) ? (sum1 / sum2) : null;
                }
            }
            if(stat_key.calc.operation == "weighted"){
                sum1 = 0.0; sum2 = 0.0; adj_val = 0.0;
                for(var b = 0;b<team_data.length;b++){ r = team_data[b];
                    sum1 += r[stat_key.calc.val1] * r[stat_key.calc.val2]; sum2 += r[stat_key.calc.val2];
                    if(adj_tag in r){ adj_val += r[adj_tag]; }
                    
                    game_val = r[stat_key.calc.val1];
                    if(misc.data.ID == team.ID){ 
                        game_results.push({'x': game_results.length + 1, 'y': game_val}); 
                    
                        if(adj_tag in r){ 
                            adj += r[adj_tag];
                            adj_game_val = game_val + r[adj_tag]; 
                            adj_game_results.push({'x': adj_game_results.length + 1, 'y': adj_game_val});
                        }
                    }
                }
                
                if(adj){
                    val = (sum2 > 0) ? ((adj_val + sum1) / sum2) : null;
                
                }
                else{
                    val = (sum2 > 0) ? (sum1 / sum2) : null;
                }
            }
            if(stat_key.calc.operation == "average"){
                sum1 = 0.0; sum2 = 0.0; adj_val = 0.0;
                for(var b = 0;b<team_data.length;b++){ r = team_data[b];
                    sum1 += r[tag]; sum2 += 1.0;
                    if(adj_tag in r){ adj_val += r[adj_tag]; }
                    
                    game_val = r[tag];
                    if(misc.data.ID == team.ID){ 
                        game_results.push({'x': game_results.length + 1, 'y': game_val}); 
                    
                        if(adj_tag in r){ 
                            adj_game_val = game_val + r[adj_tag]; 
                            adj_game_results.push({'x': adj_game_results.length + 1, 'y': adj_game_val});
                        }
                    }
                }
                
                if(adj){
                    val = (sum2 > 0) ? ((adj_val + sum1) / sum2) : null;
                }
                else{
                    val = (sum2 > 0) ? (sum1 / sum2) : null;
                }
            }
            
            val_str = "N/A";
            if(val != null){ val_str = jsformat(val, stat_key.jsfmt) }
            team.rank = {'display': team.display_name, 'short_code': team.short_code, 'highlight': (misc.data.ID == team.ID) ? 1 : 0, 'conference_ID': team.conference_ID, 'radius': team.radius, 'x': val, 'team_ID': team.ID, 'val': val, 'val_str': val_str};
        }
        
        min_val = null; max_val = null; 
        for(var a = 0;a<teams.length;a++){
            team = teams[a];
            if(team.rank.val != null){
                if(["offense", "faceoffs"].indexOf(specs.data_type) > -1){
                    if(stat_key.reverse == 0){
                        team.rank.rank = teams.filter( r => r.rank.val != null && r.rank.val < team.rank.val ).length + 1;
                        team.rank.conf_rank = teams.filter( r => team.conference_ID==r.conference_ID && r.rank.val != null && r.rank.val < team.rank.val ).length + 1;
                    }
                    else{
                        team.rank.rank = teams.filter( r => r.rank.val != null && r.rank.val > team.rank.val ).length + 1;
                        team.rank.conf_rank = teams.filter( r => team.conference_ID==r.conference_ID && r.rank.val != null && r.rank.val > team.rank.val ).length + 1;
                    }
                }
                else if(["defense", "goalkeepers"].indexOf(specs.data_type) > -1){
                    if(stat_key.reverse == 0){
                        team.rank.rank = teams.filter( r => r.rank.val != null && r.rank.val > team.rank.val ).length + 1;
                        team.rank.conf_rank = teams.filter( r => team.conference_ID==r.conference_ID && r.rank.val != null && r.rank.val > team.rank.val ).length + 1;
                    }
                    else{
                        team.rank.rank = teams.filter( r => r.rank.val != null && r.rank.val < team.rank.val ).length + 1;
                        team.rank.conf_rank = teams.filter( r => team.conference_ID==r.conference_ID && r.rank.val != null && r.rank.val < team.rank.val ).length + 1;
                    }
                }
                if(min_val == null || team.rank.val < min_val){ min_val = team.rank.val; }
                if(max_val == null || team.rank.val > max_val){ max_val = team.rank.val; }
            }
            else{ team.rank.rank = "N/A"; team.rank.conf_rank = "N/A"; }
            
            
        }
        
        teams.sort(function(first, second) {
            if(stat_key.reverse){
                return !(second.rank.val - first.rank.val);
            }
            else{
                return second.rank.val - first.rank.val;
            }
        });
        
        var me = teams.filter(r => misc.data.ID == r.ID)[0];
        me_str = me.display_name + ": " + jsformat(me.rank.val, stat_key.jsfmt ) + " (rank: " + add_suffix(me.rank.rank) + ")";
        me_conf_str = me.display_name + ": " + jsformat(me.rank.val, stat_key.jsfmt ) + " (conf. rank: " + add_suffix(me.rank.conf_rank) + ")";
        me_mob_str = me.short_code + ": " + jsformat(me.rank.val, stat_key.jsfmt ) + " (rank: " + me.rank.rank + ")";
        me_mob_conf_str = me.short_code + ": " + jsformat(me.rank.val, stat_key.jsfmt ) + " (conf. rank: " + me.rank.conf_rank + ")";
        diff = max_val - min_val; inc = diff / stat_key.nbuckets;
        
        var buckets = [];
        for(var a = 0;a<stat_key.nbuckets;a++){
            var bucket = {'x': a, 'min_x': min_val + a*inc, 'max_x': min_val + (a+1)*inc, 'label': jsformat((min_val + (a+.5)*inc), stat_key.bucket_fmt )};
            //console.log((min_val + a*inc), stat_key.jsfmt , jsformat((min_val + a*inc), stat_key.jsfmt ));
            
            if(a < stat_key.nbuckets - 1){ 
                bucket.y = teams.filter(r => bucket.min_x <= r.rank.val && bucket.max_x > r.rank.val).length;
                bucket.highlight = bucket.min_x <= me.rank.val && bucket.max_x > me.rank.val ? 1 : 0;
            }
            else{
                bucket.y = teams.filter(r => bucket.min_x <= r.rank.val && bucket.max_x >= r.rank.val).length;
                bucket.highlight = bucket.min_x <= me.rank.val && bucket.max_x >= me.rank.val ? 1 : 0;
            }
            
            buckets.push(bucket);
        }
        
        
        time_log[time_log.length-1].end = new Date().getTime();
        var team_ranks = []
        for(var a = 0;a<teams.length;a++){
            team_ranks.push(teams[a].rank);
        }
        for(var a = 0;a<game_results.length;a++){
            if(game_results.length > 10){
                if(a % 2 == 0){ game_results[a].label = a+1; }
            }
            else{
                game_results[a].label = a+1;
            }
        }
        
        return {'buckets': buckets, 'teams': team_ranks, 'me_str': me_str, 'me_conf_str': me_conf_str, 'me_mob_str': me_mob_str, 'me_mob_conf_str': me_mob_conf_str, 'game_results': game_results, 'adj_game_results': adj_game_results};
    }
    function click_tag(panel, tag){ 
        console.log(panel, tag);
        if(panel == "offense"){ ranks_stat_tag[panel] = tag; display_primary_unit(panel, panel); }
        if(panel == "defense"){ ranks_stat_tag[panel] = tag; display_primary_unit(panel, panel); }
    }
     
    function display_primary_unit(unit, panel){
        
        unit_desc = (unit=="offense") ? "offensive" : "defensive";
        if([null, unit, unit_desc + '_ranks', unit_desc + '_movement', unit_desc + '_profile', ''].indexOf(panel) == -1){ return; }
        
        id = unit_desc + '_ranks'; success = false;
        ranks = calculate_ranks(misc.extra_data.db_team_game_summaries, misc.extra_data.db_teams, misc.data.ranks.keys, calc_specs[unit], ranks_stat_tag[unit]);
            
        try{
            
            /* data */
            stat_key = misc.data.ranks.stat_keys.filter( r => r.tag == ranks_stat_tag[unit])[0];
        
    
            /* visualization */
            if(calc_specs[unit].peers == "league"){
                specs = {'highlight': 1, 'margin_left': 25, 'chart_size': 'bigger', 'flip': 0};
            
                data = {'axis_labels': {'y': 'Number of teams grouped by ' + stat_key.desc, 'x': stat_key.desc}, 'data': []};
                tmp = {'stroke-dasharray': '3-3', 'stroke': "#666", 'points': []}

                tmp.points = ranks.buckets;
                data.data.push(tmp)
                
                x_ticks = create_game_x_ticks(data.data);
                data['x_ticks'] = x_ticks.ticks; data['max_x'] = x_ticks.max; data['min_x'] = x_ticks.min;
                y_ticks = create_numeric_y_ticks(data.data)
                data['y_ticks'] = y_ticks.ticks;
                data['max_y'] = y_ticks.max;  data['min_y'] = 0;
                if(on_mobile){
                    specs.width = $('#' + unit_desc + '_ranks_container_div').width()-20;
                }
                else{
                    specs.width = $('#' + unit_desc + '_ranks_container_div').width()*.66667-20;
                }
                data.text = [{'x': specs.width-35, 'y': on_mobile ? 15 : -15, 'align': 'end', 'text': on_mobile ? ranks.me_mob_str : ranks.me_str}];
                
                data['legend'] = {'items': [], 'layout': 'horizontal'}
                data.legend.items.push({'icon_type': 'rect', 'fill': 'orange', 'label': misc.data.short_code + " Bucket"})
                
                vertical_bars(data, unit_desc + '_ranks_graph_div', specs);
            }
            else{ // Show the conference line bubbles
                specs = {'highlight': 1, 'margin_left': 60, 'margin-right': 60, 'chart_size': 'bigger', 'flip': 0};
            
                data = {'show-data-labels': 'short_code', 'axis_labels': {'y': 'Conf teams; axis = ' + stat_key.desc, 'x': stat_key.desc}, 'data': []};
                tmp = {'stroke-dasharray': '3-3', 'stroke': "#666", 'points': []}
                tmp.points = ranks.teams.filter(r => r.conference_ID == misc.data.conference_ID);
                data.data.push(tmp)
                
                x_ticks = create_game_x_ticks(data.data);
                data['x_ticks'] = x_ticks.ticks; data['max_x'] = x_ticks.max; data['min_x'] = x_ticks.min;
                y_ticks = create_numeric_y_ticks(data.data)
                data['y_ticks'] = y_ticks.ticks;
                data['max_y'] = y_ticks.max;  data['min_y'] = 0;
                if(on_mobile){
                    specs.width = $('#' + unit_desc + '_ranks_container_div').width()-20;
                }
                else{
                    specs.width = $('#' + unit_desc + '_ranks_container_div').width()*.66667-20;
                }
                data.text = [{'x': specs.width-65, 'y': on_mobile ? 15 : -15, 'align': 'end', 'text': on_mobile ? ranks.me_mob_conf_str : ranks.me_conf_str}];
                
                data['legend'] = {'items': [], 'layout': 'horizontal'}
                data.legend.items.push({'icon_type': 'rect', 'fill': 'orange', 'label': misc.data.short_code + " Bucket"})
                
                horizontal_trainmap(data, unit_desc + '_ranks_graph_div', specs);
                
            }
            // Add the stat labels
            
            stat_tags_ranks = $("#" + unit_desc + "_ranks_stat_tags_dtop"); stat_tags_ranks.empty();
            stat_tags_movement = $("#" + unit_desc + "_movement_stat_tags_dtop"); stat_tags_movement.empty();
            html = "";
            
            misc.data.ranks.stat_keys.sort(function(first, second) {
                return !(second.seq - first.seq);
            });
            subset = misc.data.ranks.stat_keys.slice(0,6);
            active_tag = false;
            for(var a = 0 ;a<subset.length;a++){
                var key = subset[a];
                
                html += "<div onclick='click_tag(\"" + unit + "\", \"" + key.tag + "\");' class='tag" + ((key.tag == ranks_stat_tag[unit]) ? " active" : "") + "'>";
                html += "<span class='no-padding font-11'>" + key.short + "</span>";
                html += "</div>"
                if(key.tag == ranks_stat_tag[unit]){ active_tag = true; }
            }
            stat_tags_ranks.append(html); stat_tags_movement.append(html);
            
            
            stat_select_ranks_dtop = $("#" + unit_desc + "_ranks_stat_select_dtop"); stat_select_ranks_dtop.empty();
            stat_select_ranks_mob = $("#" + unit_desc + "_ranks_stat_select_mob"); stat_select_ranks_mob.empty();
            stat_select_movement_dtop = $("#" + unit_desc + "_movement_stat_select_dtop"); stat_select_movement_dtop.empty();
            stat_select_movement_mob = $("#" + unit_desc + "_movement_stat_select_mob"); stat_select_movement_mob.empty();
            
            
            html = "";
            html += "<select onchange='click_tag(\"" + unit + "\",this.value);' class='stat-select font-12'>";
            html += "<option ></option>";
            for(var a = 0 ;a<misc.data.ranks.stat_keys.length;a++){
                var key = misc.data.ranks.stat_keys[a];
                html += "<option " + ((key.tag == ranks_stat_tag[unit] && (on_mobile || !active_tag)) ? " selected" : "") + " value='" + key.tag + "'>" + key.display + "</option>";
            }
            html += "</select>";
            stat_select_ranks_dtop.append(html); stat_select_ranks_mob.append(html);
            stat_select_movement_dtop.append(html); stat_select_movement_mob.append(html);
            
            filter_options_ranks_dtop = $("#" + unit_desc + "_ranks_filter_options_dtop"); filter_options_ranks_dtop.empty();
            filter_options_ranks_mob = $("#" + unit_desc + "_ranks_filter_options_ranks_mob"); filter_options_ranks_mob.empty();
            filter_options_movement_dtop = $("#" + unit_desc + "_movement_filter_options_dtop"); filter_options_movement_dtop.empty();
            filter_options_movement_mob = $("#" + unit_desc + "_movement_filter_options_movement_mob"); filter_options_movement_mob.empty();
           
            
            
            for(var a = 0 ;a<filters[unit].options.length;a++){
                var fltr = filters[unit].options[a];
                html = "";
                html += "<div class='col-12-4 no-padding'>";
                html += "<div class='col-12 no-padding'><span class=' font-11 light'>" + fltr.desc + "</span></div>";
                
                for(var b = 0;b<fltr.choices.length;b++){
                    choice = fltr.choices[b];
                    html += "<div class='flex no-padding'>";
                    
                    html += "<div class='col-10 no-padding' style='padding-left:10px;'><span class='no-padding font-11'>" + choice.desc + "</span></div>";
                    html += "<div class='col-2 no-padding'><input id=\'" + [unit, fltr.tag].join("|") + "' " + (choice.selected ? " checked" : "") + " value='" + [unit, fltr.tag, choice.val].join("|") + "' type=checkbox onclick='toggle_rank_filter(this.id, this.value, this.checked);'></div>";
                    html += "</div>";
                    
                    
                }
                html += "</div>";
                filter_options_ranks_dtop.append(html); filter_options_ranks_mob.append(html);
                filter_options_movement_dtop.append(html); filter_options_movement_mob.append(html);
            }
            
            
            
            /* mark complete */
            success = true;
        }
        catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.log(err.stack); console.log(err.message); } }
        if(!success){
            $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
            report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
        }
         
        id = unit_desc + '_profile'; success = false;
        try{
            //  This is the shooting profile graph
            /* data */
            
            /* visualization */
             
            specs = {'highlight': 1, 'margin_left': 25, 'margin-right': 0, 'chart_size': 'small', 'flip': 0};
            
            data = {'show_counts': null,'axis_labels': {'y': 'Shooting % by shot clock remaining', 'x': "Shot Clock Left"}, 'data': []};
            data.show_comparison_line = 'league_pct';
            
            tmp = {'stroke-dasharray': '3-3', 'stroke': "#666", 'points': []}
            tmp.points = misc.data[unit_desc + "_shooting_profile"].data;
            data.data.push(tmp)
            
            x_ticks = create_game_x_ticks(data.data);
            data['x_ticks'] = x_ticks.ticks; data['max_x'] = x_ticks.max; data['min_x'] = x_ticks.min;
            y_ticks = create_pct_y_ticks(data.data, {'min': 0})
            data['y_ticks'] = y_ticks.ticks;
            data['max_y'] = y_ticks.max; data['min_y'] = 0;
            
            specs.width = $('#' + unit_desc + '_shooting_profile_graph_container_div').width()-15;
            
            
            data['legend'] = {'items': [], 'layout': 'horizontal'}
            data.legend.items.push({'stroke-dasharray': "5,5", 'icon_type': 'line', 'stroke-width': 3, 'color': 'orange', 'label': 'All Teams'})
            
            vertical_bars(data, unit_desc + '_shooting_profile_graph_div', specs);
            
            //  This is the pace profile graph
            /* data */
            
            /* visualization */
            specs = {'highlight': 1, 'margin_left': 25, 'margin-right': 0, 'chart_size': 'small', 'flip': 0};
            
            data = {'show_counts': null,'axis_labels': {'y': 'Efficiency % by possession length', 'x': "Poss. Length"}, 'data': []};
            data.show_comparison_line = 'league_pct';
            
            tmp = {'stroke-dasharray': '3-3', 'stroke': "#666", 'points': []}
            tmp.points = misc.data[unit_desc + "_pace_profile"].length_data;
            data.data.push(tmp)
            
            x_ticks = create_game_x_ticks(data.data);
            data['x_ticks'] = x_ticks.ticks; data['max_x'] = x_ticks.max; data['min_x'] = x_ticks.min;
            y_ticks = create_pct_y_ticks(data.data, {'min': 0})
            data['y_ticks'] = y_ticks.ticks;
            data['max_y'] = y_ticks.max; data['min_y'] = 0;
            
            specs.width = $('#' + unit_desc + '_pace_profile_graph_container_div').width() - 15;
            
            
            data['legend'] = {'items': [], 'layout': 'horizontal'}
            data.legend.items.push({'stroke-dasharray': "5,5", 'icon_type': 'line', 'stroke-width': 3, 'color': 'orange', 'label': 'All Teams'})
            
            vertical_bars(data, unit_desc + '_pace_profile_graph_div', specs);
            
            //  This is the 1st shot profile graph
            /* data */
            
            /* visualization */
            specs = {'highlight': 1, 'margin_left': 25, 'margin-right': 0, 'chart_size': 'small', 'flip': 0};
            
            data = {'show_counts': null,'axis_labels': {'y': 'Efficiency % by time of 1st shot', 'x': "Time of 1st shot"}, 'data': []};
            data.show_comparison_line = 'league_pct';
            
            tmp = {'stroke-dasharray': '3-3', 'stroke': "#666", 'points': []}
            tmp.points = misc.data[unit_desc + "_pace_profile"].first_shot_data;
            data.data.push(tmp)
            
            x_ticks = create_game_x_ticks(data.data);
            data['x_ticks'] = x_ticks.ticks; data['max_x'] = x_ticks.max; data['min_x'] = x_ticks.min;
            y_ticks = create_pct_y_ticks(data.data, {'min': 0})
            data['y_ticks'] = y_ticks.ticks;
            data['max_y'] = y_ticks.max; data['min_y'] = 0;
            
            specs.width = $('#' + unit_desc + '_1st_shot_profile_graph_container_div').width() - 15;
            
            
            data['legend'] = {'items': [], 'layout': 'horizontal'}
            data.legend.items.push({'stroke-dasharray': "5,5", 'icon_type': 'line', 'stroke-width': 3, 'color': 'orange', 'label': 'All Teams'})
            
            vertical_bars(data, unit_desc + '_1st_shot_profile_graph_div', specs);
            
            /* mark complete */
            success = true;
        }
        catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
        if(!success){
            $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
            report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
        }
         
        id = unit_desc + '_movement'; success = false;
        try{
            //  This is the 1st shot profile graph
            /* data */

            
            /* visualization */
            specs = {'highlight': 1, 'margin_left': 35, 'chart_size': 'bigger', 'flip': 0};
            
            data = {'axis_labels': {'y': 'Performance by Game: ' + stat_key.desc, 'x': "Games"}, 'data': []};
            
            no_adj = false;
            if(ranks.adj_game_results == null){ no_adj = true; }
            else if(ranks.adj_game_results.length == 0){ no_adj = true; }

            if(calc_specs[unit].calculation == "raw" || no_adj){
                tmp = {'ball_r': 4, 'ball_fill': "#33F", 'stroke': "#ccc", 'points': []}
                tmp.points = ranks.game_results;
                data.data.push(tmp)
                data['legend'] = {'items': [], 'layout': 'horizontal'}
                data.legend.items.push({'icon_type': 'circle', 'fill': "#33F", 'stroke': "#33F", 'label': "Raw Performance"})
            }
            else{
            
                data.data.push( {'ball_r': 4, 'ball_fill': "#FFF",  'ball_stroke': "#AAF", 'stroke': "#EEE", 'points': ranks.game_results});
                data.data.push( {'ball_r': 4, 'ball_fill': "#33F", 'stroke': "#EEE", 'points': ranks.adj_game_results});
                data['legend'] = {'items': [], 'layout': 'horizontal'}
                data.legend.items.push({'icon_type': 'circle', 'fill': "#FFF", 'stroke': "#AAF", 'label': "Raw Performance"})
                data.legend.items.push({'icon_type': 'circle', 'fill': '#33F', 'stroke': '#33F', 'label': "Opp Adj. Perf"})
            }
            
            
            x_ticks = create_game_x_ticks(data.data);
            data['x_ticks'] = x_ticks.ticks; data['max_x'] = x_ticks.max; data['min_x'] = x_ticks.min;

            if('fmt' in stat_key && stat_key.fmt != null && stat_key.fmt.indexOf("%") > -1){
                y_ticks = create_pct_y_ticks(data.data, {})
            }
            else{
                y_ticks = create_numeric_y_ticks(data.data);
            }
            
            data['y_ticks'] = y_ticks.ticks;
            data['max_y'] = y_ticks.max;  data['min_y'] = y_ticks.min;
            if(on_mobile){
                specs.width = $('#' + unit_desc + '_movement_container_div').width()-20;
            }
            else{
                specs.width = $('#' + unit_desc + '_movement_container_div').width()*.66667-20;
            }
           
            if(calc_specs[unit].calculation == "adjusted" && no_adj){
                data.text = [{'font_style': 'italic', 'fill': 'red', 'x': specs.width-35, 'y': on_mobile ? 15 : -15, 'align': 'end', 'text': "Adjusted stats are not available for " + stat_key.desc}];
            }
            
            horizontal_line(data, unit_desc + '_movement_graph_div', specs);
            /* mark complete */
            success = true;
        }
        catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
        if(!success){
            $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
            report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
        }
         
    }
    
    function display_faceoffs(panel){
        unit = "faceoffs"; unit_desc = unit;
        if([null, 'faceoffs', '', '', '', ''].indexOf(panel) == -1){ return; }

        id = 'faceoff_ranks'; success = false;
 
        ranks = calculate_ranks(misc.extra_data.db_team_game_summaries, misc.extra_data.db_teams, misc.data.ranks.keys, calc_specs[unit], ranks_stat_tag[unit]);

        try{
            /* data */
            stat_key = misc.data.ranks.stat_keys.filter( r => r.tag == ranks_stat_tag[unit])[0];
       
                
            /* visualization */
            if(calc_specs[unit].peers == "league"){
                specs = {'highlight': 1, 'margin_left': 25, 'chart_size': 'bigger', 'flip': 0};
            
                data = {'axis_labels': {'y': 'Number of teams grouped by ' + stat_key.desc, 'x': stat_key.desc}, 'data': []};
                tmp = {'stroke-dasharray': '3-3', 'stroke': "#666", 'points': []}

                tmp.points = ranks.buckets;
                data.data.push(tmp)
                
                x_ticks = create_game_x_ticks(data.data);
                data['x_ticks'] = x_ticks.ticks; data['max_x'] = x_ticks.max; data['min_x'] = x_ticks.min;
                y_ticks = create_numeric_y_ticks(data.data)
                data['y_ticks'] = y_ticks.ticks;
                data['max_y'] = y_ticks.max;  data['min_y'] = 0;
                if(on_mobile){
                    specs.width = $('#' + unit_desc + '_ranks_container_div').width()-20;
                }
                else{
                    specs.width = $('#' + unit_desc + '_ranks_container_div').width()*.66667-20;
                }
                data.text = [{'x': specs.width-35, 'y': on_mobile ? 15 : -15, 'align': 'end', 'text': on_mobile ? ranks.me_mob_str : ranks.me_str}];
                
                data['legend'] = {'items': [], 'layout': 'horizontal'}
                data.legend.items.push({'icon_type': 'rect', 'fill': 'orange', 'label': misc.data.short_code + " Bucket"})
                
                vertical_bars(data, unit_desc + '_ranks_graph_div', specs);
            }
            else{ // Show the conference line bubbles
                specs = {'highlight': 1, 'margin_left': 60, 'margin-right': 60, 'chart_size': 'bigger', 'flip': 0};
            
                data = {'show-data-labels': 'short_code', 'axis_labels': {'y': 'Conf teams; axis = ' + stat_key.desc, 'x': stat_key.desc}, 'data': []};
                tmp = {'stroke-dasharray': '3-3', 'stroke': "#666", 'points': []}
                tmp.points = ranks.teams.filter(r => r.conference_ID == misc.data.conference_ID);
                data.data.push(tmp)
                
                x_ticks = create_game_x_ticks(data.data);
                data['x_ticks'] = x_ticks.ticks; data['max_x'] = x_ticks.max; data['min_x'] = x_ticks.min;
                y_ticks = create_numeric_y_ticks(data.data)
                data['y_ticks'] = y_ticks.ticks;
                data['max_y'] = y_ticks.max;  data['min_y'] = 0;
                if(on_mobile){
                    specs.width = $('#' + unit_desc + '_ranks_container_div').width()-20;
                }
                else{
                    specs.width = $('#' + unit_desc + '_ranks_container_div').width()*.66667-20;
                }
                data.text = [{'x': specs.width-65, 'y': on_mobile ? 15 : -15, 'align': 'end', 'text': on_mobile ? ranks.me_mob_conf_str : ranks.me_conf_str}];
                
                data['legend'] = {'items': [], 'layout': 'horizontal'}
                data.legend.items.push({'icon_type': 'rect', 'fill': 'orange', 'label': misc.data.short_code + " Bucket"})
                
                horizontal_trainmap(data, unit_desc + '_ranks_graph_div', specs);
                
            }
            
            
            filter_options_faceoffs_dtop = $("#faceoffs_ranks_filter_options_dtop"); filter_options_faceoffs_dtop.empty();
            filter_options_faceoffs_mob = $("#faceoffs_ranks_filter_options_mob"); filter_options_faceoffs_mob.empty();
            
            
            for(var a = 0 ;a<filters[unit].options.length;a++){
                var fltr = filters[unit].options[a];
                html = "";
                html += "<div class='col-12-4 no-padding'>";
                html += "<div class='col-12 no-padding'><span class=' font-11 light'>" + fltr.desc + "</span></div>";
                
                for(var b = 0;b<fltr.choices.length;b++){
                    choice = fltr.choices[b];
                    html += "<div class='flex no-padding'>";
                    
                    html += "<div class='col-10 no-padding' style='padding-left:10px;'><span class='no-padding font-11'>" + choice.desc + "</span></div>";
                    html += "<div class='col-2 no-padding'><input id=\'" + [unit, fltr.tag].join("|") + "' " + (choice.selected ? " checked" : "") + " value='" + [unit, fltr.tag, choice.val].join("|") + "' type=checkbox onclick='toggle_rank_filter(this.id, this.value, this.checked);'></div>";
                    html += "</div>";
                    
                    
                }
                html += "</div>";
                filter_options_faceoffs_dtop.append(html); filter_options_faceoffs_mob.append(html);
            }
            /* mark complete */
            success = true;
        }
        catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
        if(!success){
            $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
            report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
        }
         
        id = 'faceoff_elo'; success = false;
        try{
            /* data */
            console.log("misc.data.fogos");
            console.log(misc.data.fogos);
            misc.data.fogos.sort(function(first, second) {          
                return second.faceoff_ELO - first.faceoff_ELO;
                            });
        
            misc.data.fogos= misc.data.fogos.filter(r => r.display);
            
            /* visualization */
            elem = $("#faceoff_elo_div"); elem.empty();
            
            html = "";
            html += "<div class='flex col-12 no-padding bbottom'>";
            
            html += "<div class='col-6 no-padding'>";
            html += "<span class='font-15 bold'>Player</span>";
            html += "</div>";
            
            html += "<div class='col-2 no-padding centered'>";
            html += "<span class='font-15 bold'>Win %</span>";
            html += "</div>";
            
            html += "<div class='col-2 no-padding centered'>";
            html += "<span class='font-15 bold'>ELO</span>";
            html += "</div>";
            
            html += "<div class='col-2 no-padding centered'>";
            html += "<span class='font-15 bold'>Season</span>";
            html += "</div>";
            
            html += "</div>";
            elem.append(html);
            
            for(var a = 0;a<misc.data.fogos.length;a++){
                fogo = misc.data.fogos[a];
                html = "";
                html += "<div class='table-row'>";
                html += "<div class='flex col-12 no-padding'>"
                
                html += "<div class='col-6 no-padding'>";
                html += "<span class='font-15'>" + fogo.player + "</span>";
                html += "</div>";
                
                html += "<div class='col-2 no-padding centered'>";
                html += "<span class='font-15'>" + fogo.faceoff_pct_str + "</span>";
                html += "</div>";
                
                html += "<div class='col-2 no-padding centered'>";
                html += "<span class='font-15'>" + fogo.faceoff_ELO_str + "</span>";
                html += "</div>";
                
                html += "<div class='col-2 no-padding centered' id='faceoff_elo_spark" + a + "'></div>";
                
                html += "</div>";
                html += "</div>";
                elem.append(html);
            }
            var min_val = null; var max_val = null;
            for(var a = 0;a<misc.data.fogos.length;a++){
                fogo = misc.data.fogos[a];
                for(var b = 0;b<fogo.faceoff_ELO_history.length;b++){
                    y = fogo.faceoff_ELO_history[b].y;
                    if(min_val == null || min_val > y){ min_val = y; }
                    if(max_val == null || max_val < y){ max_val = y; }
                }
            }
            if(min_val < 1400 && max_val > 1600){  // Both ends are outside of the range
                if((max_val - 1500) > (1500 - min_val)){ // Check which is farther away; here it is the max
                    y_max = max_val; y_min = 1500 - (max_val - 1500);
                }
                else{
                    y_min = min_val; y_max = 1500 + (1500 - min_val);
                }
            }
            else if(min_val >= 1400 && max_val > 1600){ 
                y_max = max_val; y_min = 1500 - (max_val - 1500);
            }
            else if(min_val < 1400 && max_val <= 1600){ 
                y_min = min_val; y_max = 1500 + (1500 - min_val) ;
            }
            else if(min_val >= 1400 && max_val <= 1600){ 
                y_min = 1400; y_max = 1600;
            }
            y_min -= 25; y_max += 25;
            
            // Use the min of any team member FOGO and the max for all the charts instead of a min/max that is chart-specific
            
            for(var a = 0;a<misc.data.fogos.length;a++){
                fogo = misc.data.fogos[a];
                
                specs = {'highlight': 1, 'margin_left': 10, 'margin_right': 10, 'margin_top': 2, 'margin_bottom': 0, 'chart_size': 'spark', 'flip': 0};
            
                data = {'data': []};
                if(fogo.faceoff_ELO_history.length > 1){
                    start = fogo.faceoff_ELO_history[0].y;
                    end = fogo.faceoff_ELO_history[fogo.faceoff_ELO_history.length - 1].y;
                    
                    tmp = {'stroke-width': '2', 'points': []}
                    if(end > start){
                        tmp.stroke = "#3F3";
                    }
                    else{
                        tmp.stroke = "#800";
                    }
                    tmp.points = fogo.faceoff_ELO_history;
                    data.data.push(tmp)
                    
                    x_ticks = create_game_x_ticks(data.data);
                    data['x_ticks'] = x_ticks.ticks; data['max_x'] = x_ticks.max; data['min_x'] = x_ticks.min;
                    y_ticks = create_numeric_y_ticks(data.data)
                    data['y_ticks'] = y_ticks.ticks;
                    data['max_y'] = y_max;  data['min_y'] = y_min;
                    
                }
                specs.width = $('#' + id + '_container_div').width() * .166;
                
                specs.height = 19;
                spark_line(data, "faceoff_elo_spark" + a, specs);
                
            }
            
             
            /* mark complete */
            success = true;
        }
        catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
        if(!success){
            $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
            report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
        }
         
        id = 'faceoff_splits'; success = false;
        try{
            /* data */
            
            console.log("misc.data.fogo_splits");
            console.log(misc.data.fogo_splits);
            
                
            /* visualization */
  
            html = ""; $("#" + id + "_div").empty();
            for(var a = 0;a<misc.data.fogo_splits.length;a++){
                sp = misc.data.fogo_splits[a];
                
                if(a % 2 == 0){ html += "<div class='flex no-padding'>"; }
                    html += "<div class='col-6' style='margin:5px; background-color: #EEF;'><div class='no-padding'>";
                        html += "<div class='col-12 no-padding'><span class='light font-11'>" + sp.header + "</span></div>";
                        for(var b = 0;b<sp.options.length;b++){
                            o = sp.options[b];
                      
                            spark_bar_id = "spark_bar_fogo_splits_div" + a + "_" + b;
                            
                            html += "<div class='col-12 no-padding flex'>";
                            html += "<div class='col-6 no-padding'><span class='font-12'>" + o.label + "</span></div>";
                            html += "<div class='col-6 no-padding'><div class='no-padding spark-bar ' id='" + spark_bar_id + "' style=''></div></div>";
                            /*html += "<div class='col-4 no-padding right'><span class='font-12' style='font-style:italic;'>n = " + o.cnt_str + "</span></div>";*/
                            html += "</div>";  
                        }
                    html += "</div></div>";
                
                if(a % 2 == 1 || a == misc.data.fogo_splits.length-1){ html += "</div>"; }
               
                
                
                
            }
            $("#" + id + "_div").append(html)
            for(var a = 0;a<misc.data.fogo_splits.length;a++){
                sp = misc.data.fogo_splits[a];
                for(var b = 0;b<sp.options.length;b++){
                    o = sp.options[b];
                    spark_bar_id = "spark_bar_fogo_splits_div" + a + "_" + b;
                    
                    w = $('#faceoff_splits_container_div').width() * .5 * .5 * .95;
                    spark_bar(spark_bar_id, {'width': w, 'chart_size': 'small', 'label': (o.pct != null) ? (zFormat(100.0 * o.pct, 0) + "%") : null, 'margin_left': 0, 'margin_top': 0, 'margin_bottom': 0, 'margin_right': 0, 'height': 15, 'bar_width': o.pct, 'bar_fill': "#FFF", 'fill': "#88F"});
                }
            }
            
            /* mark complete */
            success = true;
        }
        catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
        if(!success){
            $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
            report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
        }
         
    }
    
    function display_goalkeepers(panel){
        unit = "goalkeepers"; unit_desc = unit;
        if([null, 'goalkeepers', '', '', '', ''].indexOf(panel) == -1){ return; }

        id = 'goalkeepers_ranks'; success = false;
 
        ranks = calculate_ranks(misc.extra_data.db_team_game_summaries, misc.extra_data.db_teams, misc.data.ranks.keys, calc_specs[unit], ranks_stat_tag[unit]);

        try{
            /* data */
            stat_key = misc.data.ranks.stat_keys.filter( r => r.tag == ranks_stat_tag[unit])[0];
       
                
            /* visualization */
            if(calc_specs[unit].peers == "league"){
                specs = {'highlight': 1, 'margin_left': 25, 'chart_size': 'bigger', 'flip': 0};
            
                data = {'axis_labels': {'y': 'Number of teams grouped by ' + stat_key.desc, 'x': stat_key.desc}, 'data': []};
                tmp = {'stroke-dasharray': '3-3', 'stroke': "#666", 'points': []}

                tmp.points = ranks.buckets;
                data.data.push(tmp)
                
                x_ticks = create_game_x_ticks(data.data);
                data['x_ticks'] = x_ticks.ticks; data['max_x'] = x_ticks.max; data['min_x'] = x_ticks.min;
                y_ticks = create_numeric_y_ticks(data.data)
                data['y_ticks'] = y_ticks.ticks;
                data['max_y'] = y_ticks.max;  data['min_y'] = 0;
                if(on_mobile){
                    specs.width = $('#' + unit_desc + '_ranks_container_div').width()-20;
                }
                else{
                    specs.width = $('#' + unit_desc + '_ranks_container_div').width()*.66667-20;
                }
                data.text = [{'x': specs.width-35, 'y': on_mobile ? 15 : -15, 'align': 'end', 'text': on_mobile ? ranks.me_mob_str : ranks.me_str}];
                
                data['legend'] = {'items': [], 'layout': 'horizontal'}
                data.legend.items.push({'icon_type': 'rect', 'fill': 'orange', 'label': misc.data.short_code + " Bucket"})
                
                vertical_bars(data, unit_desc + '_ranks_graph_div', specs);
            }
            else{ // Show the conference line bubbles
                specs = {'highlight': 1, 'margin_left': 60, 'margin-right': 60, 'chart_size': 'bigger', 'flip': 0};
            
                data = {'show-data-labels': 'short_code', 'axis_labels': {'y': 'Conf teams; axis = ' + stat_key.desc, 'x': stat_key.desc}, 'data': []};
                tmp = {'stroke-dasharray': '3-3', 'stroke': "#666", 'points': []}
                tmp.points = ranks.teams.filter(r => r.conference_ID == misc.data.conference_ID);
                data.data.push(tmp)
                
                x_ticks = create_game_x_ticks(data.data);
                data['x_ticks'] = x_ticks.ticks; data['max_x'] = x_ticks.max; data['min_x'] = x_ticks.min;
                y_ticks = create_numeric_y_ticks(data.data)
                data['y_ticks'] = y_ticks.ticks;
                data['max_y'] = y_ticks.max;  data['min_y'] = 0;
                if(on_mobile){
                    specs.width = $('#' + unit_desc + '_ranks_container_div').width()-20;
                }
                else{
                    specs.width = $('#' + unit_desc + '_ranks_container_div').width()*.66667-20;
                }
                data.text = [{'x': specs.width-65, 'y': on_mobile ? 15 : -15, 'align': 'end', 'text': on_mobile ? ranks.me_mob_conf_str : ranks.me_conf_str}];
                
                data['legend'] = {'items': [], 'layout': 'horizontal'}
                data.legend.items.push({'icon_type': 'rect', 'fill': 'orange', 'label': misc.data.short_code + " Bucket"})
                
                horizontal_trainmap(data, unit_desc + '_ranks_graph_div', specs);
                
            }
            
            
            filter_options_goalkeepers_dtop = $("#goalkeepers_ranks_filter_options_dtop"); filter_options_goalkeepers_dtop.empty();
            filter_options_goalkeepers_mob = $("#goalkeepers_ranks_filter_options_mob"); filter_options_goalkeepers_mob.empty();
            
            
            for(var a = 0 ;a<filters[unit].options.length;a++){
                var fltr = filters[unit].options[a];
                html = "";
                html += "<div class='col-12-4 no-padding'>";
                html += "<div class='col-12 no-padding'><span class=' font-11 light'>" + fltr.desc + "</span></div>";
                
                for(var b = 0;b<fltr.choices.length;b++){
                    choice = fltr.choices[b];
                    html += "<div class='flex no-padding'>";
                    
                    html += "<div class='col-10 no-padding' style='padding-left:10px;'><span class='no-padding font-11'>" + choice.desc + "</span></div>";
                    html += "<div class='col-2 no-padding'><input id=\'" + [unit, fltr.tag].join("|") + "' " + (choice.selected ? " checked" : "") + " value='" + [unit, fltr.tag, choice.val].join("|") + "' type=checkbox onclick='toggle_rank_filter(this.id, this.value, this.checked);'></div>";
                    html += "</div>";
                    
                    
                }
                html += "</div>";
                filter_options_goalkeepers_dtop.append(html); filter_options_goalkeepers_mob.append(html);
            }
            /* mark complete */
            success = true;
        }
        catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
        if(!success){
            $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
            report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
        }
         
        mappings = []
        mappings.push({'db_tag': 'leading_status', 'div_tag': "leading"});
        mappings.push({'db_tag': 'man_up', 'div_tag': "manup"});
        mappings.push({'db_tag': 'shot_clock_remaining_bucket', 'div_tag': "shotclock"});
        //mappings.push({'db_tag': 'possession_started_with_bucket', 'div_tag': "possessiontype"});
        
        for(var a = 0;a<mappings.length;a++){
            m = mappings[a];
            id = 'goalkeepers_adjusted_' + m.div_tag; success = false;
            try{
                //  This is the shooting profile graph
                /* data */
                console.log("misc.data.goalkeepers_adjusted_shooting[" + m.db_tag+ "]");
                data = misc.data.goalkeepers_adjusted_shooting.filter(r => r.tag == m.db_tag)[0];
                
                /* visualization */
                 
                html = ""; $("#" + id + "_div").empty();
                html += "<div class='col-12 no-padding'>";
        
                    
                html += "<div class='col-12 no-padding flex bbottom'>";
                html += "<div class='col-3 no-padding'><span class='font-12'>Category</span></div>";
                html += "<div class='col-2 no-padding centered'><span class='font-12' style=''>S.O.G.</span></div>";
                html += "<div class='col-5 no-padding'><span class='font-12' style=''>Save % Comparison</span></div>";
                html += "<div class='col-2 no-padding right'><span class='font-12'>vs Avg.</span></div>";
                html += "</div>";  
                        
                html += "</div>";
                
                for(var b = 0;b<data.buckets.length;b++){
                    bkt = data.buckets[b];
                    bkt.save_pct = 1.0 - bkt.pct_sog;
                    bkt.league_avg_save_pct = 1.0 - bkt.league_avg_on_goal;
                    bkt.excess_save_pct = bkt.save_pct - bkt.league_avg_save_pct;
                    bkt.excess_save_pct_str = (bkt.excess_save_pct > 0 ? "+" : "") + zFormat(bkt.excess_save_pct * 100.0) + "%";
                    bkt.save_pct_str = zFormat(bkt.save_pct * 100.0) + "%";
                    bkt.league_avg_save_pct_str = zFormat(bkt.league_avg_save_pct * 100.0) + "%";
                    
                    spark_bar_id = "spark_bar_goalkeepers_splits_div" + a + "_" + b;
                    
                    html += "<div class='col-12 no-padding'>";
        
                    
                    html += "<div class='col-12 no-padding flex'>";
                    html += "<div class='col-3 no-padding'><span class='font-12' style='padding:3px;'>" + bkt.label + "</span></div>";
                    html += "<div class='col-2 no-padding centered'><span class='font-12' style='padding:3px;'>" + bkt.sog + "</span></div>";
                    html += "<div class='col-5 no-padding'><div class='no-padding spark-bar ' id='" + spark_bar_id + "' style=''></div></div>";
                    html += "<div class='col-2 no-padding right'><span class='font-12' style='padding:3px; color: " + (bkt.excess_save_pct >= 0 ? "#3B3" : "#800") + "'>" + (bkt.sog > 0 ? bkt.excess_save_pct_str : "") + " </span></div>";
                    html += "</div>";  
                        
                    html += "</div>";
                

                   
                    
                    
                    
                }
                $("#" + id + "_div").append(html)
                for(var b = 0;b<data.buckets.length;b++){
                    bkt = data.buckets[b];
                    spark_bar_id = "spark_bar_goalkeepers_splits_div" + a + "_" + b;
                        
                    //w = $('#goalkeepers_splits_container_div').width() * .5 * .5 * .95;
                    comparison_bar(spark_bar_id, {'show_labels': 1, 'chart_size': 'small', 'margin_left': 5, 'margin_top': 0, 'margin_bottom': 0, 'margin_right': 28, 'height': 13, 'label': zFormat(100.0*bkt.save_pct, 0) + "%", 'comp_label': zFormat(100.0*bkt.league_avg_save_pct, 0) + "%", 'comp_value': bkt.league_avg_save_pct, 'value': bkt.save_pct, 'bar_fill': "#FFF", 'fill': "#88F"});
                    
                }
                console.log(data);
                
                
                /* mark complete */
                success = true;
            }
            catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
            if(!success){
                $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
                report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
            }
        }
    }
    
    function redraw(panel=null){
        on_mobile = $("#main_logo").css('display') == "none";
        
        if(typeof panel == "object"){ panel = null; }
        
        console_log.push({'msg': 'Check misc.data...'});
        if('data' in misc && [{}, null].indexOf(misc.data) == -1){
            console_log.push({'msg': 'display_offense...'});
            display_primary_unit("offense", panel);
            console_log.push({'msg': 'display_defense...'});
            display_primary_unit("defense", panel);
            console_log.push({'msg': 'display_faceoffs...'});
            display_faceoffs(panel);
            console_log.push({'msg': 'display_goalkeepers...'});
            display_goalkeepers(panel);
            
            
            
        }
        
    }
    
    unit = "offense"; unit_desc = "offensive";
    toggle = {'val': calc_specs[unit].calculation == "raw" ? 0 : 1, 'start_x': 25, 'end_x': 40, 'id': 'movement_mob_calculation', 'text_align': 'right', 'start_label': 'Raw', 'end_label': "Adjusted"};
    display_toggle(toggle, unit_desc + '_movement_mob_calculation', {'chart_size': 'small', 'class': unit_desc + '_calculation_radio', 'height': 20});
    toggle = {'val': calc_specs[unit].calculation == "raw" ? 0: 1, 'start_x': 25, 'end_x': 40, 'id': 'ranks_mob_calculation', 'text_align': 'right', 'start_label': 'Raw', 'end_label': "Adjusted"};
    display_toggle(toggle, unit_desc + '_ranks_mob_calculation', {'chart_size': 'small', 'class': unit_desc + '_calculation_radio', 'height': 20});
    
    
    toggle = {'val': calc_specs[unit].peers == "conference" ? 1 : 0, 'start_x': 30, 'end_x': 40, 'id': 'movement_mob_peers', 'text_align': 'right', 'start_label':  'League', 'end_label': "Conference"};
    display_toggle(toggle, unit_desc + '_movement_mob_peers', {'chart_size': 'small', 'class': unit_desc + '_peers_radio', 'height': 20});
    toggle = {'val': calc_specs[unit].peers == "conference" ? 1 : 0, 'start_x': 30, 'end_x': 40, 'id': 'ranks_mob_peers', 'text_align': 'right', 'start_label': 'League', 'end_label': "Conference"};
    display_toggle(toggle, unit_desc + '_ranks_mob_peers', {'chart_size': 'small', 'class': unit_desc + '_peers_radio', 'height': 20});
    
    unit = "defense"; unit_desc = "defensive";
    toggle = {'val': calc_specs[unit].calculation == "raw" ? 0 : 1, 'start_x': 25, 'end_x': 40, 'id': 'movement_mob_calculation', 'text_align': 'right', 'start_label': 'Raw', 'end_label': "Adjusted"};
    display_toggle(toggle, unit_desc + '_movement_mob_calculation', {'chart_size': 'small', 'class': unit_desc + '_calculation_radio', 'height': 20});
    toggle = {'val': calc_specs[unit].calculation == "raw" ? 0: 1, 'start_x': 25, 'end_x': 40, 'id': 'ranks_mob_calculation', 'text_align': 'right', 'start_label': 'Raw', 'end_label': "Adjusted"};
    display_toggle(toggle, unit_desc + '_ranks_mob_calculation', {'chart_size': 'small', 'class': unit_desc + '_calculation_radio', 'height': 20});
    
    toggle = {'val': calc_specs[unit].peers == "conference" ? 1 : 0, 'start_x': 30, 'end_x': 40, 'id': 'movement_mob_peers', 'text_align': 'right', 'start_label':  'League', 'end_label': "Conference"};
    display_toggle(toggle, unit_desc + '_movement_mob_peers', {'chart_size': 'small', 'class': unit_desc + '_peers_radio', 'height': 20});
    toggle = {'val': calc_specs[unit].peers == "conference" ? 1 : 0, 'start_x': 30, 'end_x': 40, 'id': 'ranks_mob_peers', 'text_align': 'right', 'start_label': 'League', 'end_label': "Conference"};
    display_toggle(toggle, unit_desc + '_ranks_mob_peers', {'chart_size': 'small', 'class': unit_desc + '_peers_radio', 'height': 20});
    
    unit = "faceoffs"; unit_desc = unit;
    toggle = {'val': calc_specs[unit].calculation == "raw" ? 0 : 1, 'start_x': 25, 'end_x': 40, 'id': 'movement_mob_calculation', 'text_align': 'right', 'start_label': 'Raw', 'end_label': "Adjusted"};
    display_toggle(toggle, unit_desc + '_movement_mob_calculation', {'chart_size': 'small', 'class': unit_desc + '_calculation_radio', 'height': 20});
    toggle = {'val': calc_specs[unit].calculation == "raw" ? 0: 1, 'start_x': 25, 'end_x': 40, 'id': 'ranks_mob_calculation', 'text_align': 'right', 'start_label': 'Raw', 'end_label': "Adjusted"};
    display_toggle(toggle, unit_desc + '_ranks_mob_calculation', {'chart_size': 'small', 'class': unit_desc + '_calculation_radio', 'height': 20});
    
    toggle = {'val': calc_specs[unit].peers == "conference" ? 1 : 0, 'start_x': 30, 'end_x': 40, 'id': 'movement_mob_peers', 'text_align': 'right', 'start_label':  'League', 'end_label': "Conference"};
    display_toggle(toggle, unit_desc + '_movement_mob_peers', {'chart_size': 'small', 'class': unit_desc + '_peers_radio', 'height': 20});
    toggle = {'val': calc_specs[unit].peers == "conference" ? 1 : 0, 'start_x': 30, 'end_x': 40, 'id': 'ranks_mob_peers', 'text_align': 'right', 'start_label': 'League', 'end_label': "Conference"};
    display_toggle(toggle, unit_desc + '_ranks_mob_peers', {'chart_size': 'small', 'class': unit_desc + '_peers_radio', 'height': 20});
    
    unit = "goalkeepers"; unit_desc = unit;
    toggle = {'val': calc_specs[unit].calculation == "raw" ? 0 : 1, 'start_x': 25, 'end_x': 40, 'id': 'movement_mob_calculation', 'text_align': 'right', 'start_label': 'Raw', 'end_label': "Adjusted"};
    display_toggle(toggle, unit_desc + '_movement_mob_calculation', {'chart_size': 'small', 'class': unit_desc + '_calculation_radio', 'height': 20});
    toggle = {'val': calc_specs[unit].calculation == "raw" ? 0: 1, 'start_x': 25, 'end_x': 40, 'id': 'ranks_mob_calculation', 'text_align': 'right', 'start_label': 'Raw', 'end_label': "Adjusted"};
    display_toggle(toggle, unit_desc + '_ranks_mob_calculation', {'chart_size': 'small', 'class': unit_desc + '_calculation_radio', 'height': 20});
    
    toggle = {'val': calc_specs[unit].peers == "conference" ? 1 : 0, 'start_x': 30, 'end_x': 40, 'id': 'movement_mob_peers', 'text_align': 'right', 'start_label':  'League', 'end_label': "Conference"};
    display_toggle(toggle, unit_desc + '_movement_mob_peers', {'chart_size': 'small', 'class': unit_desc + '_peers_radio', 'height': 20});
    toggle = {'val': calc_specs[unit].peers == "conference" ? 1 : 0, 'start_x': 30, 'end_x': 40, 'id': 'ranks_mob_peers', 'text_align': 'right', 'start_label': 'League', 'end_label': "Conference"};
    display_toggle(toggle, unit_desc + '_ranks_mob_peers', {'chart_size': 'small', 'class': unit_desc + '_peers_radio', 'height': 20});
    
    
    
    // Select the appropriate panel to display
    if('active_element' in misc){ choose_left_menu_item(misc.active_element); }
    else{ choose_left_menu_item("goalkeepers"); }
    
    console_log.push({'msg': 'Start finish load...'});
    finish_load(JSON.parse({{user_obj.notifications|to_json2}}));
    
    window.addEventListener("resize", redraw); 
    
    
</script>
{% endblock %}

