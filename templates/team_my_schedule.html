
{% extends "layout_main.html" %}


{% block body %}

        <div class='col-12 dtop flex menu-header-bar'>
            <div class='col-12'>
                <a href='/' class='menu-link'><span class='menu-link' style='padding-left:10px;'><span class='font-15'>Home</span></span></a>
                <a href='/team_my_schedule' class='menu-link active'><span class='menu-link' style='padding-left:10px;'><span class='active-link font-15'>My Schedule</span></span></a>
                <a href='/team_my_stats' class='menu-link'><span class='menu-link' style=''><span class='font-15'>My Stats</span></span></a>
                <a href='/team_my_rankings' class='menu-link'><span class='menu-link' style=''><span class='font-15'>My Rankings</span></span></a>
            </div>
        </div>

        <div class='col-12 centered' id='banner'></div>
        
        
        
        {% if misc.error %}
            <div class='col-12 error centered'><span class='error' >{{misc.error|safe}}</span></div>
        {% endif %}
        {% if misc.msg %}
            <div class='col-12 error centered'><span class='' >{{misc.msg}}</span></div>
        {% endif %}
        <div class=''>
            <div class='no-padding options-bar col-12 flex'>
                <div class='no-padding col-9'>
                {% if misc.breadcrumbs %}
                    <div class='breadcrumbs'>
                        {{misc.breadcrumbs|safe}}
                    </div>
                {% endif %}
                </div>
                <div class='no-padding col-3 right'>
                    <div class='no-padding col-12 right'>
                        <div class='gear-settings'>
                            <img onclick='toggle_settings_bar();' id='settings-icon' class='icon-15 settings' src='/static/img/blue_gear15.png' />
                        </div>
                    </div>
                </div>
                
            </div>
            <div class='settings-bar single-row not-shown no-padding right' id='settings-bar'>
                <div class='' style='padding-right:10px;'>
                    <span class='font-13' style='padding-right:10px;'>Year</span>
                    <select class='settings-bar' id='general_focus_year' onchange='update_settings(this.id, this.value);'>
                        <option value=2020>2020</option>
                        <option value=2019>2019</option>
                    </select>
                </div>
            </div>
            <div class='refreshing-bar not-shown no-padding right' id='refreshing-bar'>
                <div class='centered' style=''>
                    <span class='font-18 bold' style=''>Refreshing content...</span>
                </div>
            </div>
            
            
            <div id='' class='non-dashboard-landing'>
                <div class='col-12 mob centered no-padding'>
                    <select style='width:80%; margin: 0% 10%;' id='top_menu_select' onChange='choose_left_menu_item(this.value);'>
                        <option id='next_game_option' value='next_game'>Next Game</option>
                        <option id='last_game_option' value='last_game'>Last Game</option>
                        <option id='full_schedule_option' value='full_schedule'>Full Schedule</option>
                    </select>
                </div>
                <div class='flex col-12 no-padding'>
                    <div class='left-menu col-2-12 dtop'>
                        <div id='next_game_menu_item' onclick='choose_left_menu_item(this.id);' class='active left-menu-item'><span class='mouseover-link pointer font-15'>Next Game</span></div>
                        <div id='last_game_menu_item' onclick='choose_left_menu_item(this.id);' class='left-menu-item'><span class='mouseover-link pointer font-15'>Last Game</span></div>
                        <div id='full_schedule_menu_item' onclick='choose_left_menu_item(this.id);' class='left-menu-item'><span class='mouseover-link pointer font-15'>Full Schedule</span></div>
                    </div>
                    <div class='right-content col-10-12' id='right-content-panel'>
                        <div class='right-content-panel' id='next_game_panel'>
                            <div class='col-12 block no-padding'>
                                <div class='non-dashboard-section card col-12' id='film_guide_container_div'>
                                    <div class='non-dashboard-section-header'>
                                        <div class='col-11-10 no-padding non-dashboard-label'>Film Guide</div>
                                                    
                                        <div class='col-1 right no-padding dashboard-tile-help-icon' id='film_guide_helpicon' style='margin-top:2px;'><img class='icon-15 explanation' value="team_my_schedule.html|film_guide" src="static/img/Gray_Info150.png" /></div>
                                        <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='film_guide_img' class='icon-15 toggle' onclick='toggle_tile_visibility("film_guide");' src="static/img/Gray_Plus150.png" /></div>
                                                
                                                    
                                        
                                    </div>
                                    <div class='non-dashboard-tile-content' id='film_guide_div'>
                                        <div class='flex-block col-12'>
                                            <div class='col-6-12 non-dashboard-tile-section' style=''>
                                                <div class='col-12 no-padding'><span class='font-18'>Their Defense: film to learn from</span></div>
                                                <div class='col-12 no-padding' id='film_guide_defense'></div>
                                            </div>
                                            <div class='col-6-12 non-dashboard-tile-section' style=''>
                                                <div class='col-12 no-padding'><span class='font-18'>Their Offense: film to learn from</span> </div>
                                                <div class='col-12 no-padding' id='film_guide_offense'></div>
                                            </div>
                                        </div>
                                    
                                    </div>

                                </div>
                            </div>
                            <div class='col-12 block no-padding'>
                                <div class='non-dashboard-section card col-12' id='matchup_advantages_shooting_container_div'>
                                    <div class='non-dashboard-section-header'>
                                        <div class='col-11-10 no-padding non-dashboard-label'>Match-Up Advantages: Shot Clock Management</div>
                                                    
                                        <div class='col-1 right no-padding dashboard-tile-help-icon icon-visible' id='matchup_advantages_shooting_helpicon' style='margin-top:2px;'><img class='icon-15 explanation' value="team_my_schedule.html|matchup_advantages_shooting" src="static/img/Gray_Info150.png" /></div>
                                        <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='matchup_advantages_shooting_img' class='icon-15 toggle' onclick='toggle_tile_visibility("matchup_advantages_shooting");' src="static/img/Gray_Minus150.png" /></div>
                                                
                                                    
                                        
                                    </div>
                                    <div class='non-dashboard-tile-content visible bigger' id='matchup_advantages_shooting_div'>
                                        <div class='flex-block col-12'>
                                            <div class='col-6-12 non-dashboard-tile-section' style=''>
                                                <div class='col-12 no-padding'><span class='font-18'>Your Offense vs Their Defense </span></div>
                                                <div class='col-12 no-padding' id='matchup_advantages_shooting_offense'></div>
                                            </div>
                                            <div class='col-6-12 non-dashboard-tile-section' style=''>
                                                <div class='col-12 no-padding'><span class='font-18'>Their Offense vs Your Defense</span> </div>
                                                <div class='col-12 no-padding' id='matchup_advantages_shooting_defense'></div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                            <div class='col-12 block no-padding'>
                                <div class='non-dashboard-section card col-12' id='matchup_advantages_pacing_container_div'>
                                    <div class='non-dashboard-section-header'>
                                        <div class='col-11-10 no-padding non-dashboard-label'>Match-Up Advantages: Pacing</div>
                                                    
                                        <div class='col-1 right no-padding dashboard-tile-help-icon icon-visible' id='matchup_advantages_pacing_helpicon' style='margin-top:2px;'><img class='icon-15 explanation' value="team_my_schedule.html|matchup_advantages_pacing" src="static/img/Gray_Info150.png" /></div>
                                        <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='matchup_advantages_pacing_img' class='icon-15 toggle' onclick='toggle_tile_visibility("matchup_advantages_pacing");' src="static/img/Gray_Minus150.png" /></div>
                                                
                                                    
                                        
                                    </div>
                                    <div class='non-dashboard-tile-content visible bigger' id='matchup_advantages_pacing_div'>
                                        <div class='flex-block col-12'>
                                            <div class='col-6-12 non-dashboard-tile-section' style=''>
                                                <div class='col-12 no-padding'><span class='font-18'>Your Offense vs Their Defense </span></div>
                                                <div class='col-12 no-padding' id='matchup_advantages_pacing_offense'></div>
                                            </div>
                                            <div class='col-6-12 non-dashboard-tile-section' style=''>
                                                <div class='col-12 no-padding'><span class='font-18'>Their Offense vs Your Defense</span> </div>
                                                <div class='col-12 no-padding' id='matchup_advantages_pacing_defense'></div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                            <div class='col-12 flex-block no-padding'>
                                <div class='non-dashboard-section card col-12' id='matchup_history_container_div'>
                                    <div class='non-dashboard-section-header'>
                                        <div class='col-11-10 no-padding non-dashboard-label'>Match-Up History</div>
                                                    
                                        <div class='col-1 right no-padding dashboard-tile-help-icon icon-visible' id='matchup_history_helpicon' style='margin-top:2px;'><img class='icon-15 explanation' value="team_my_schedule.html|matchup_history" src="static/img/Gray_Info150.png" /></div>
                                        <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='matchup_history_img' class='icon-15 toggle' onclick='toggle_tile_visibility("matchup_history");' src="static/img/Gray_Minus150.png" /></div>
                                                
                                                    
                                        
                                    </div>
                                    <div class='non-dashboard-tile-content visible' id='matchup_history_div'>
                                        
                                    </div>

                                </div>
                            </div>
                            
                            
                        </div>
                        <div class='right-content-panel' id='last_game_panel'>
                            <div class='flex-block'>
                            
                            </div>
                        
                        </div>
                        <div class='right-content-panel' id='full_schedule_panel'>
                            <div class='col-12 flex-block no-padding'>
                            
                            </div>
                            <div class='col-12 flex-block no-padding'>
                            
                            </div>
                            
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
    

<script src="static/js/d3.v4.min.js"></script><script src="static/js/laxrefpro_graphing.js?dt=200"></script>
<script>
    var on_mobile = null;
    var console_log = []; var success = null;
    var time_log = JSON.parse({{misc.time_log|to_json2}});
    
    var single_stat = "<div class='col-12'><span class='lightish contents font-20'>[header]</span></div>";
    single_stat += "<div class='col-12 centered ' style='padding-top:65px;'><span class='tile-message font-18'>[stat]</span></div>";
    var misc = parse_misc({{misc|to_json2}});
    console_log.push({'msg': 'Loaded misc...'});
    var user_obj = {'settings': {{user_obj.settings|to_json2}}};
    console_log.push({'msg': 'Loaded user settings...'});
    //console.log(misc);
    var explanations = {{user_obj.explanations|to_json2}};

    if(misc.data.next_game == null){
        
        $("#next_game_panel").empty();
        $("#next_game_panel").append("<div class='col-12 centered no-padding'><span class='error font-18'>There is no \"next game\" to display yet.</span></div>");
        
    }

    if(misc.data.last_game == null){

        $("#last_game_panel").empty();
        $("#last_game_panel").append("<div class='col-12 centered no-padding'><span class='error font-18'>There is no \"last game\" to display yet.</span></div>");
    }
    
    function display_next_game(panel){ 
        if([null, 'next_game', 'matchup_advantages_shooting', 'film_guide', 'opp_profile_offense'].indexOf(panel) == -1){ return; }
    
        
        
        if(misc.data.next_game != null){
        
            cell_width = $("#matchup_advantages_shooting_container_div").width()/4/2;
            if(on_mobile){ cell_width *= 2; }
            
            id = 'film_guide_div'; success = false;
            try{
                // Data
                max_rows = Math.max(misc.data.next_game.film_guide.offense.key_stretches.length, misc.data.next_game.film_guide.defense.key_stretches.length);
                //console.log("misc.data.next_game.film_guide");
                //console.log(misc.data.next_game.film_guide);
                // Visualization
                for (tag in {'offense': 1, 'defense': 1}){
                    elem = $("#film_guide_" + tag); elem.empty();
                    html = "";
                    
                    html += "<div class='no-padding'>";
                    
                    html += "<div class='flex bbottom no-padding'>";
                    html += " <div class='col-4 no-padding'><span class='font-12 bold'>Opp</span></div>";
                    html += " <div class='col-2 no-padding'><span class='font-12 bold contents'>Start</span></div>";
                    html += " <div class='col-2 no-padding'><span class='font-12 bold contents'>End</span></div>";
                    html += " <div class='col-2 no-padding centered'><span class='font-12 bold contents'>Goals</span></div>";
                    html += " <div class='col-2 no-padding centered'><span class='font-12 bold contents'>Poss</span></div>";
                    html += "</div>";
                    printed = 0; show_last_year = false;
                    for(var a = 0;a<misc.data.next_game.film_guide[tag].key_stretches.length;a++){
                        bkt = misc.data.next_game.film_guide[tag].key_stretches[a];
                        if(bkt.last_year){ show_last_year = true; }
                        html += "<div class='flex table-row no-padding'>";
                        html += " <div class='col-4 no-padding'><span class='font-12'>" + bkt.opp_short_code + " (" + bkt.short_date_str + (bkt.last_year ? "*" : "") + ")</span></div>";
                        html += " <div class='col-2 no-padding'><span class='font-12 contents'>" + bkt.start_timestamp + "</span></div>";
                        html += " <div class='col-2 no-padding'><span class='font-12 contents'>" + bkt.end_timestamp + "</span></div>";
                        html += " <div class='col-2 no-padding centered'><span class='font-12 contents'>" + zFormat(bkt.goals, 0) + "</span></div>";
                        html += " <div class='col-2 no-padding centered'><span class='font-12 contents'>" + zFormat(bkt.possessions, 0) + "</span></div>";
                        html += "</div>";
                    }
                    elem.append(html); printed += 1;
                    while(printed < max_rows){
                        html += "<div class='flex no-padding'>";
                        html += " <div class='col-12 no-padding'><span class='font-12'>&nbsp;</span></div>";
                        html += "</div>";
                        printed += 1;
                    }
                    if(show_last_year){
                        html += "<div class='flex no-padding'>";
                        html += " <div class='col-12 right'><span class='font-12'>* Last Season</span></div>";
                        html += "</div>";
                    }
                }
                
                // Mark complete
                success = true;
            }
            catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
            
            if(!success){
                $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
                report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
            }
            id = 'matchup_advantages_shooting_div'; success = false;
            try{
                // Data
                
                tmp_data = {};
                tmp_data.shooting_offense = misc.data.full_shooting_profile_offense.this_year.filter(r=> r.tag == "shot_clock_remaining_bucket")[0];
                tmp_data.shooting_defense = misc.data.full_shooting_profile_defense.this_year.filter(r=> r.tag == "shot_clock_remaining_bucket")[0];
                //console.log(tmp_data);
                // Visualization
                for (tag in {'offense': 1, 'defense': 1}){
                    elem = $("#matchup_advantages_shooting_" + tag); elem.empty();
                    html = "";
                    
                    html += "<div class='no-padding'>";
                    
                    html += "<div class='flex bbottom'>";
                    html += " <div class='col-3'><span class='font-12 bold'>Clock Rem.</span></div>";
                    html += " <div class='col-3 centered'><span class='font-12 bold contents'>" + (tag=="offense" ? "Your": "Their") + " Share</span></div>";
                    html += " <div class='col-3 centered'><span class='font-12 bold contents'>Opportunity</span></div>";
                    html += " <div class='col-3 centered'><span class='font-12 bold contents'>Risk</span></div>";
                    html += "</div>";
                    
                    for(var a = 0;a<tmp_data['shooting_' + tag].buckets.length;a++){
                        bkt = tmp_data['shooting_' + tag].buckets[a];
                        bkt.label = (bkt.bucket) + (a < tmp_data['shooting_' + tag].buckets.length - 1 ? "-" + (bkt.bucket +9) + "s" : "+")
                        //console.log(bkt)
                        html += "<div class='flex table-row'>";
                        html += " <div class='col-3'><span class='font-12'>" + bkt.label + "</span></div>";
                        html += " <div class='col-3 centered'><span class='font-12 contents'>" + zFormat(100.0*bkt.share, 0) + "%</span></div>";
                        html += " <div class='col-3 centered' id='shotclock_pct" + a + "_" + tag + "'></div>";
                        html += " <div class='col-3 centered' id='shotclock_share" + a + "_" + tag + "'></div>";
                        html += "</div>";
                    }
                    elem.append(html);
                    for(var a = 0;a<tmp_data['shooting_' + tag].buckets.length;a++){
                        bkt = tmp_data['shooting_' + tag].buckets[a];
                        id = "shotclock_share" + a + "_" + tag;
                        
                        if(bkt.share_effect_weighted > .002){
                            dir = "up"; fill = '#282'; color = "#FFF";
                        }
                        else if(bkt.share_effect_weighted < -.002){
                            dir = "down"; fill = '#800'; color = "#FFF";
                        }
                        else{
                            dir = "sideways"; fill = '#EE1'; color = "#333";
                        }
                        
                        harvey_ball(id, {'width': cell_width, 'height':21, 'harvey_width': 18, 'chart_size': 'small', 'chart_type': 'harvey', 'fill': [fill, fill], color: color});
                        
                        id = "shotclock_pct" + a + "_" + tag;
                        
                        if(bkt.pct_effect_weighted > .02){
                            dir = "up"; fill = '#282'; color = "#FFF";
                        }
                        else if(bkt.pct_effect_weighted < -.02){
                            dir = "down"; fill = '#800'; color = "#FFF";
                        }
                        else{
                            dir = "sideways"; fill = '#EE1'; color = "#333";
                        }
                        
                        labeled_arrow(id, {'width': cell_width, 'height':21, 'dir': dir, 'arrow_width': 33, 'chart_size': 'small', 'chart_type': 'arrow', 'fill': fill, color: color, 'label': zFormat(100.0*bkt.pct_effect_weighted, 1) + "%"});
                    }
                }
                // Mark complete
                success = true;
            }
            catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
            
            if(!success){
                $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
                report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
            }
            
            id = 'matchup_advantages_pacing_div'; success = false;
            try{
                // Data

                
                
                tmp_data = {};
                tmp_data.pacing_offense = {'tag': 'poss_length', 'buckets': misc.data.offensive_pace_profile.length_data};
                tmp_data.pacing_defense = {'tag': 'poss_length', 'buckets': misc.data.defensive_pace_profile.length_data};
                //console.log(tmp_data);
                // Visualization
                for (tag in {'offense': 1, 'defense': 1}){
                    elem = $("#matchup_advantages_pacing_" + tag); elem.empty();
                    html = "";
                    
                    html += "<div class='no-padding'>";
                    
                    html += "<div class='flex bbottom'>";
                    html += " <div class='col-3'><span class='font-12 bold'>Poss. Length</span></div>";
                    html += " <div class='col-3 centered'><span class='font-12 bold contents'>" + (tag=="offense" ? "Your": "Their") + " Share</span></div>";
                    html += " <div class='col-3 centered'><span class='font-12 bold contents'>Opportunity</span></div>";
                    html += " <div class='col-3 centered'><span class='font-12 bold contents'>Risk</span></div>";
                    html += "</div>";
                    
                    for(var a = 0;a<tmp_data['pacing_' + tag].buckets.length;a++){
                        bkt = tmp_data['pacing_' + tag].buckets[a];
                        bkt.label = (bkt.min_t) + (a < tmp_data['pacing_' + tag].buckets.length - 1 ? "-" + (bkt.max_t - 1) + "s" : "+")
                        //console.log(bkt)
                        html += "<div class='flex table-row'>";
                        html += " <div class='col-3'><span class='font-12'>" + bkt.label + "</span></div>";
                        html += " <div class='col-3 centered'><span class='font-12 contents'>" + zFormat(100.0*bkt.share_this_year, 0) + "%</span></div>";
                        html += " <div class='col-3 centered' id='pacing_pct" + a + "_" + tag + "'></div>";
                        html += " <div class='col-3 centered' id='pacing_share" + a + "_" + tag + "'></div>";
                        html += "</div>";
                    }
                    elem.append(html);
                    for(var a = 0;a<tmp_data['pacing_' + tag].buckets.length;a++){
                        bkt = tmp_data['pacing_' + tag].buckets[a];
                        id = "pacing_share" + a + "_" + tag;
                        
                        if(bkt.share_effect > .002){
                            dir = "up"; fill = '#282'; color = "#FFF";
                        }
                        else if(bkt.share_effect < -.002){
                            dir = "down"; fill = '#800'; color = "#FFF";
                        }
                        else{
                            dir = "sideways"; fill = '#EE1'; color = "#333";
                        }
                        
                        harvey_ball(id, {'width': cell_width, 'height':21, 'harvey_width': 18, 'chart_size': 'small', 'chart_type': 'harvey', 'fill': [fill, fill], color: color});
                        
                        id = "pacing_pct" + a + "_" + tag;
                        
                        if(bkt.pct_effect > .02){
                            dir = "up"; fill = '#282'; color = "#FFF";
                        }
                        else if(bkt.pct_effect < -.02){
                            dir = "down"; fill = '#800'; color = "#FFF";
                        }
                        else{
                            dir = "sideways"; fill = '#EE1'; color = "#333";
                        }
                        
                        labeled_arrow(id, {'width': cell_width, 'height':21, 'dir': dir, 'arrow_width': 33, 'chart_size': 'small', 'chart_type': 'arrow', 'fill': fill, color: color, 'label': zFormat(100.0*bkt.pct_effect, 1) + "%"});
                    }
                }
                // Mark complete
                success = true;
            }
            catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
            
            if(!success){
                $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
                report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
            }
        }
        
        id = 'matchup_history_div'; success = false;
        try{
            // Data
            console.log("misc.data.matchup_history");
            console.log(misc.data.matchup_history);
            // Visualization
            elem = $("#" + id); elem.empty();
            html = "";
            
            tags = []
            tags.push({'class': '', 'label': 'Adj Off.', 'tag': 'adj_efficiency_offense', 'fmt': '%'})
            tags.push({'class': '', 'label': 'Adj Def.', 'tag': 'adj_efficiency_defense', 'fmt': '%'})
            tags.push({'class': '', 'label': 'FO %', 'tag': 'fo_win_rate', 'fmt': '%'})
            tags.push({'class': '', 'label': 'Save %', 'tag': 'save_pct', 'fmt': '%'})
            tags.push({'class': '', 'label': 'GB %', 'tag': 'gb_win_rate', 'fmt': '%'})
            tags.push({'class': 'dtop', 'label': 'Man-Up Off.', 'tag': 'man_up_offense', 'fmt': ""})
            tags.push({'class': 'dtop', 'label': 'Total Poss.', 'tag': 'total_possessions', 'fmt': 0})
            html += "<div class='no-padding'>";
            
            html += "<div class='flex bbottom'>";
            html += " <div class='col-2'><span class='font-12 bold'>Date</span></div>";
            html += " <div class='col-1'><span class='font-12 bold contents'>Result</span></div>";
            html += " <div class='col-9'><ul class='table-ul left' style='background-color:inherit;'>";
            for(var a = 0;a<tags.length;a++){ tag = tags[a];
            
                html += " <li style='' class='" + tag.class + " table-li no-padding centered'><div class='cell-holder no-padding'><span class='font-12 bold contents'>" + tag.label + "</span></div></li>";
            }
            html += "</ul></div>";
            html += "</div>";
            
            for(var a = 0;a<misc.data.matchup_history.length;a++){
                gm = misc.data.matchup_history[a];
               
                html += "<div class='flex table-row'>";
                html += " <div class='col-2'><span class='font-12'>" + gm.game_date_str + "</span></div>";
                html += " <div class='col-1'><span class='font-12 contents'>" + gm.result_str + "</span></div>";
                html += " <div class='col-9'><ul class='table-ul left' style='background-color:inherit;'>";
                for(var b = 0;b<tags.length;b++){ tag = tags[b];
                    if([null, ''].indexOf(gm[tag.tag]) > -1){ txt = ""; }
                    else if(tag.fmt == "%"){ txt = zFormat(100.0*gm[tag.tag], 1) + "%"; }
                    else if(tag.fmt == ""){ txt = gm[tag.tag]; }
                    else{ txt = zFormat(gm[tag.tag], tag.fmt); }
                    
                    html += " <li style='' class='" + tag.class + " table-li no-padding centered'><div class='cell-holder no-padding'><span class='font-12 contents'>" + txt + "</span></div></li>";
                }
                html += "</ul></div>";
                html += "</div>";
            }
            elem.append(html);
    
            // Mark complete
            success = true;
        }
        catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
        
        if(!success){
            $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
            report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
        }
    }
    
    
    function display_last_game(panel){
        //console.log("display_last_game: " + panel);
        if([null, 'last_game', 'last_game_history', 'last_game_game_results', 'last_game_movement'].indexOf(panel) == -1){ return; }
        
        if(misc.data.last_game == null){
        
        }
        else{
            id = 'last_game_game_results'; success = false;
            try{
                // Data
                
                // Visualization
                
                // Mark complete
                success = true;
            }
            catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
            
            if(!success){
                $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
                report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
            }
                    
            
            id = "last_game_history_div"; success = false;
            try{
                // Data
                
                // Visualization
                
                // Mark complete
                success = true;
            }
            catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
            
            if(!success){
                $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
                report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
            }
                
                
            id = "last_game_movement_div"; success = false;
            
            try{
                // Data
                
                // Visualization
                
                // Mark complete
                success = true;
            }
            catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
            
            if(!success){
                $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
                report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
            }
        }
    }
    
    function display_full_schedule(panel){
        if([null, 'full_schedule', 'record_scenarios', 'bubble_watch', 'conf_seed_probabilities', 'selection_rivals'].indexOf(panel) == -1){ return; }
        
        id = 'record_scenarios'; success = false;
        try{
            // Data
            
            // Visualization
            
            // Mark complete
            success = true;
        }
        catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
        
        if(!success){
            $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
            report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
        }
            
    
        id =  'selection_rivals_div'; success = false;
        try{
            // Data
            
            // Visualization
            
            // Mark complete
            success = true;
        }
        catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
        
        if(!success){
            $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
            report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
        }
            
        
        
        id = 'conf_seed_probabilities_div'; success = false;
        try{
            // Data
            
            // Visualization
            
            // Mark complete
            success = true;
        }
        catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
        
        if(!success){
            $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
            report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
        }

        id = 'bubble_watch_div'; success = false;
        try{
            // Data
            
            // Visualization
            
            // Mark complete
            success = true;
        }
        catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
        
        if(!success){
            $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
            report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
        }

        
    }
    
    function redraw(panel=null){
        on_mobile = $("#main_logo").css('display') == "none";
        
        if(typeof panel == "object"){ panel = null; }
        
        console_log.push({'msg': 'Check misc.data...'});
        if('data' in misc && [{}, null].indexOf(misc.data) == -1){
            console_log.push({'msg': 'next_game...'});
            display_next_game(panel);
            console_log.push({'msg': 'last_game...'});
            display_last_game(panel);
            console_log.push({'msg': 'post season...'});
            display_full_schedule(panel);
            
            
            
        }
        
    }
    
    // Select the appropriate panel to display
    if('active_element' in misc){ choose_left_menu_item(misc.active_element); }
    else{ choose_left_menu_item("next_game"); }
    
    console_log.push({'msg': 'Start finish load...'});
    finish_load(JSON.parse({{user_obj.notifications|to_json2}}));
    
    window.addEventListener("resize", redraw); 
    
    
</script>
{% endblock %}

