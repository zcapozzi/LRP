
{% extends "layout_main.html" %}


{% block body %}

        <div class='col-12 dtop flex menu-header-bar'>
            <div class='col-12'>
                <a href='/' class='menu-link'><span class='menu-link' style='padding-left:10px;'><span class='font-15'>Home</span></span></a>
                <a href='/team_my_schedule' class='menu-link active'><span class='menu-link' style='padding-left:10px;'><span class='active-link font-15'>My Schedule</span></span></a>
                <a href='/team_my_stats' class='menu-link'><span class='menu-link' style=''><span class='font-15'>My Stats</span></span></a>
                <a href='/team_my_rankings' class='menu-link'><span class='menu-link' style=''><span class='font-15'>My Rankings</span></span></a>
            </div>
        </div>

        <div class='col-12 centered' id='banner'></div>
        
        
        
        {% if misc.error %}
            <div class='col-12 error centered'><span class='error' >{{misc.error|safe}}</span></div>
        {% endif %}
        {% if misc.msg %}
            <div class='col-12 error centered'><span class='' >{{misc.msg}}</span></div>
        {% endif %}
        <div class=''>
            <div class='no-padding options-bar col-12 flex'>
                <div class='no-padding col-9'>
                {% if misc.breadcrumbs %}
                    <div class='breadcrumbs'>
                        {{misc.breadcrumbs|safe}}
                    </div>
                {% endif %}
                </div>
                <div class='no-padding col-3 right'>
                    <div class='no-padding col-12 right'>
                        <div class='gear-settings'>
                            <img onclick='toggle_settings_bar();' id='settings-icon' class='icon-15 settings' src='/static/img/blue_gear15.png' />
                        </div>
                    </div>
                </div>
                
            </div>
            <div class='settings-bar single-row not-shown no-padding right' id='settings-bar'>
                <div class='' style='padding-right:10px;'>
                    <span class='font-13' style='padding-right:10px;'>Year</span>
                    <select class='settings-bar' id='general_focus_year' onchange='update_settings(this.id, this.value);'>
                        <option value=2020>2020</option>
                        <option value=2019>2019</option>
                    </select>
                </div>
            </div>
            <div class='refreshing-bar not-shown no-padding right' id='refreshing-bar'>
                <div class='centered' style=''>
                    <span class='font-18 bold' style=''>Refreshing content...</span>
                </div>
            </div>
            
            
            <div id='' class='non-dashboard-landing'>
                <div class='col-12 mob centered no-padding'>
                    <select style='width:80%; margin: 0% 10%;' id='top_menu_select' onChange='choose_left_menu_item(this.value);'>
                        <option id='next_game_option' value='next_game'>Next Game</option>
                        <option id='last_game_option' value='last_game'>Last Game</option>
                        <option id='full_schedule_option' value='full_schedule'>Full Schedule</option>
                    </select>
                </div>
                <div class='flex col-12 no-padding'>
                    <div class='left-menu col-2-12 dtop'>
                        <div id='next_game_menu_item' onclick='choose_left_menu_item(this.id);' class='active left-menu-item'><span class='mouseover-link pointer font-15'>Next Game</span></div>
                        <div id='last_game_menu_item' onclick='choose_left_menu_item(this.id);' class='left-menu-item'><span class='mouseover-link pointer font-15'>Last Game</span></div>
                        <div id='full_schedule_menu_item' onclick='choose_left_menu_item(this.id);' class='left-menu-item'><span class='mouseover-link pointer font-15'>Full Schedule</span></div>
                    </div>
                    <div class='right-content col-10-12' id='right-content-panel'>
                        <div class='right-content-panel' id='next_game_panel'>
                            <div class='col-12 block no-padding'>
                                <div class='non-dashboard-section card col-12' id='film_guide_container_div'>
                                    <div class='non-dashboard-section-header'>
                                        <div class='col-11-10 no-padding non-dashboard-label'>Film Guide</div>
                                                    
                                        <div class='col-1 right no-padding dashboard-tile-help-icon' id='film_guide_helpicon' style='margin-top:2px;'><img class='icon-15 explanation' value="team_my_schedule.html|film_guide" src="static/img/Gray_Info150.png" /></div>
                                        <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='film_guide_img' class='icon-15 toggle' onclick='toggle_tile_visibility("film_guide");' src="static/img/Gray_Plus150.png" /></div>
                                                
                                                    
                                        
                                    </div>
                                    <div class='non-dashboard-tile-content' id='film_guide_div'>
                                        <div class='flex-block col-12'>
                                            <div class='col-6-12 non-dashboard-tile-section' style=''>
                                                <div class='col-12 no-padding'><span class='font-18'>Their Defense: film to learn from</span></div>
                                                <div class='col-12 no-padding' id='film_guide_defense'></div>
                                            </div>
                                            <div class='col-6-12 non-dashboard-tile-section' style=''>
                                                <div class='col-12 no-padding'><span class='font-18'>Their Offense: film to learn from</span> </div>
                                                <div class='col-12 no-padding' id='film_guide_offense'></div>
                                            </div>
                                        </div>
                                    
                                    </div>

                                </div>
                            </div>
                            <div class='col-12 block no-padding'>
                                <div class='non-dashboard-section card col-12' id='matchup_advantages_shooting_container_div'>
                                    <div class='non-dashboard-section-header'>
                                        <div class='col-11-10 no-padding non-dashboard-label'>Match-Up Advantages: Shot Clock Management</div>
                                                    
                                        <div class='col-1 right no-padding dashboard-tile-help-icon icon-visible' id='matchup_advantages_shooting_helpicon' style='margin-top:2px;'><img class='icon-15 explanation' value="team_my_schedule.html|matchup_advantages_shooting" src="static/img/Gray_Info150.png" /></div>
                                        <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='matchup_advantages_shooting_img' class='icon-15 toggle' onclick='toggle_tile_visibility("matchup_advantages_shooting");' src="static/img/Gray_Minus150.png" /></div>
                                                
                                                    
                                        
                                    </div>
                                    <div class='non-dashboard-tile-content visible bigger' id='matchup_advantages_shooting_div'>
                                        <div class='flex-block col-12'>
                                            <div class='col-6-12 non-dashboard-tile-section' style=''>
                                                <div class='col-12 no-padding'><span class='font-18'>Your Offense vs Their Defense </span></div>
                                                <div class='col-12 no-padding' id='matchup_advantages_shooting_offense'></div>
                                            </div>
                                            <div class='col-6-12 non-dashboard-tile-section' style=''>
                                                <div class='col-12 no-padding'><span class='font-18'>Their Offense vs Your Defense</span> </div>
                                                <div class='col-12 no-padding' id='matchup_advantages_shooting_defense'></div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                            <div class='col-12 block no-padding'>
                                <div class='non-dashboard-section card col-12' id='matchup_advantages_pacing_container_div'>
                                    <div class='non-dashboard-section-header'>
                                        <div class='col-11-10 no-padding non-dashboard-label'>Match-Up Advantages: Pacing</div>
                                                    
                                        <div class='col-1 right no-padding dashboard-tile-help-icon icon-visible' id='matchup_advantages_pacing_helpicon' style='margin-top:2px;'><img class='icon-15 explanation' value="team_my_schedule.html|matchup_advantages_pacing" src="static/img/Gray_Info150.png" /></div>
                                        <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='matchup_advantages_pacing_img' class='icon-15 toggle' onclick='toggle_tile_visibility("matchup_advantages_pacing");' src="static/img/Gray_Minus150.png" /></div>
                                                
                                                    
                                        
                                    </div>
                                    <div class='non-dashboard-tile-content visible bigger' id='matchup_advantages_pacing_div'>
                                        <div class='flex-block col-12'>
                                            <div class='col-6-12 non-dashboard-tile-section' style=''>
                                                <div class='col-12 no-padding'><span class='font-18'>Your Offense vs Their Defense </span></div>
                                                <div class='col-12 no-padding' id='matchup_advantages_pacing_offense'></div>
                                            </div>
                                            <div class='col-6-12 non-dashboard-tile-section' style=''>
                                                <div class='col-12 no-padding'><span class='font-18'>Their Offense vs Your Defense</span> </div>
                                                <div class='col-12 no-padding' id='matchup_advantages_pacing_defense'></div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                            <div class='col-12 flex-block no-padding'>
                                <div class='non-dashboard-section card col-12' id='matchup_history_container_div'>
                                    <div class='non-dashboard-section-header'>
                                        <div class='col-11-10 no-padding non-dashboard-label'>Match-Up History</div>
                                                    
                                        <div class='col-1 right no-padding dashboard-tile-help-icon icon-visible' id='matchup_history_helpicon' style='margin-top:2px;'><img class='icon-15 explanation' value="team_my_schedule.html|matchup_history" src="static/img/Gray_Info150.png" /></div>
                                        <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='matchup_history_img' class='icon-15 toggle' onclick='toggle_tile_visibility("matchup_history");' src="static/img/Gray_Minus150.png" /></div>
                                                
                                                    
                                        
                                    </div>
                                    <div class='non-dashboard-tile-content visible' id='matchup_history_div'>
                                        
                                    </div>

                                </div>
                            </div>
                            
                            
                        </div>
                        <div class='right-content-panel' id='last_game_panel'>
                            <div class='col-12 block no-padding'>
                            
                                <div class='non-dashboard-section card col-12' id='last_game_headline_container_div'>
                                
                                    <div class='non-dashboard-section-header'>
                                        <div class='col-11-10 no-padding non-dashboard-label'>{{misc.data.last_game.headline_result_str}} </div>
                                                    
                                        <div class='col-1 right no-padding dashboard-tile-help-icon' id='last_game_headline_helpicon' style='margin-top:2px;'><img class='icon-15 explanation' value="team_my_schedule.html|last_game_headline" src="static/img/Gray_Info150.png" /></div>
                                        <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='last_game_headline_img' class='icon-15 toggle' onclick='toggle_tile_visibility("last_game_headline");' src="static/img/Gray_Plus150.png" /></div>
                                                
                                                    
                                        
                                    </div>
                                    <div class='non-dashboard-tile-content' id='last_game_headline_div'></div>

                                </div>
                            
                            </div>
                            <div class='col-12 block no-padding'>
                                
                                <div class='non-dashboard-section card col-12' id='last_game_adjusted_performance_primary_container_div'>
                                    <div class='non-dashboard-section-header'>
                                        <div class='col-11-10 no-padding non-dashboard-label'>Opponent Adjusted Performance (Primary Units)</div>
                                                    
                                        <div class='col-1 right no-padding dashboard-tile-help-icon' id='last_game_adjusted_performance_primary_helpicon' style='margin-top:2px;'><img class='icon-15 explanation' value="team_my_schedule.html|last_game_adjusted_performance_primary" src="static/img/Gray_Info150.png" /></div>
                                        <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='last_game_adjusted_performance_primary_img' class='icon-15 toggle' onclick='toggle_tile_visibility("last_game_adjusted_performance_primary");' src="static/img/Gray_Plus150.png" /></div>
                                                
                                                    
                                        
                                    </div>
                                    <div class='non-dashboard-tile-content' id='last_game_adjusted_performance_primary_div'>
                                        <div class='flex-block col-12'>
                                            <div class='col-6-12 non-dashboard-tile-section' style=''>
                                                <div class='col-12 no-padding'><span class='font-18'>Your Offense</span></div>
                                                <div class='col-12 no-padding' id='last_game_adjusted_performance_primary_offense'></div>
                                            </div>
                                            <div class='col-6-12 non-dashboard-tile-section' style=''>
                                                <div class='col-12 no-padding'><span class='font-18'>Your Defense</span></div>
                                                <div class='col-12 no-padding' id='last_game_adjusted_performance_primary_defense'></div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>    
                            <div class='col-12 block no-padding'>
                                <div class='non-dashboard-section card col-12' id='last_game_adjusted_performance_specialty_container_div'>
                                    <div class='non-dashboard-section-header'>
                                        <div class='col-11-10 no-padding non-dashboard-label'>Opponent Adjusted Performance (FO/GK)</div>
                                                    
                                        <div class='col-1 right no-padding dashboard-tile-help-icon' id='last_game_adjusted_performance_specialty_helpicon' style='margin-top:2px;'><img class='icon-15 explanation' value="team_my_schedule.html|last_game_adjusted_performance_specialty" src="static/img/Gray_Info150.png" /></div>
                                        <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='last_game_adjusted_performance_specialty_img' class='icon-15 toggle' onclick='toggle_tile_visibility("last_game_adjusted_performance_specialty");' src="static/img/Gray_Plus150.png" /></div>
                                                
                                                    
                                        
                                    </div>
                                    <div class='non-dashboard-tile-content' id='last_game_adjusted_performance_specialty_div'>
                                        <div class='flex-block col-12'>
                                            <div class='col-6-12 non-dashboard-tile-section' style=''>
                                                <div class='col-12 no-padding'><span class='font-18'>Your Faceoff Unit</span></div>
                                                <div class='col-12 no-padding' id='last_game_adjusted_performance_specialty_faceoffs'></div>
                                            </div>
                                            <div class='col-6-12 non-dashboard-tile-section' style=''>
                                                <div class='col-12 no-padding'><span class='font-18'>Your Goalkeepers</span></div>
                                                <div class='col-12 no-padding' id='last_game_adjusted_performance_specialty_goalkeepers'></div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>   
                            <div class='col-12 flex-block no-padding'>
                                <div class='non-dashboard-section card col-6-12' id='last_game_positional_breakdown_container_div'>
                                    <div class='non-dashboard-section-header'>
                                        <div class='col-11-10 no-padding non-dashboard-label'>Positional Breakdown</div>
                                                    
                                        <div class='col-1 right no-padding dashboard-tile-help-icon' id='last_game_positional_breakdown_helpicon' style='margin-top:2px;'><img class='icon-15 explanation' value="team_my_schedule.html|last_game_positional_breakdown" src="static/img/Gray_Info150.png" /></div>
                                        <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='last_game_positional_breakdown_img' class='icon-15 toggle' onclick='toggle_tile_visibility("last_game_positional_breakdown");' src="static/img/Gray_Plus150.png" /></div>
                                                
                                                    
                                        
                                    </div>
                                    <div class='non-dashboard-tile-content' id='last_game_positional_breakdown_div'>
                                        
                                    </div>

                                </div>
                                <div class='non-dashboard-section card col-6-12' id='last_game_situation_splits_container_div'>
                                    <div class='non-dashboard-section-header'>
                                        <div class='col-11-10 no-padding non-dashboard-label'>Situational Splits</div>
                                                    
                                        <div class='col-1 right no-padding dashboard-tile-help-icon' id='last_game_situation_splits_helpicon' style='margin-top:2px;'><img class='icon-15 explanation' value="team_my_schedule.html|last_game_situation_splits" src="static/img/Gray_Info150.png" /></div>
                                        <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='last_game_situation_splits_img' class='icon-15 toggle' onclick='toggle_tile_visibility("last_game_situation_splits");' src="static/img/Gray_Plus150.png" /></div>
                                                
                                                    
                                        
                                    </div>
                                    <div class='non-dashboard-tile-content' id='last_game_situation_splits_div' style='padding-bottom: 10px;'>
                                        
                                    </div>

                                </div>
                            </div>    
                            <div class='col-12 block no-padding'>
                                <div class='non-dashboard-section card col-12' id='last_game_key_stretches_offense_container_div'>
                                    <div class='non-dashboard-section-header'>
                                        <div class='col-11-10 no-padding non-dashboard-label'>Game Stretches: Offensive Perspective</div>
                                                    
                                        <div class='col-1 right no-padding dashboard-tile-help-icon' id='last_game_key_stretches_offense_helpicon' style='margin-top:2px;'><img class='icon-15 explanation' value="team_my_schedule.html|last_game_key_stretches_offense" src="static/img/Gray_Info150.png" /></div>
                                        <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='last_game_key_stretches_offense_img' class='icon-15 toggle' onclick='toggle_tile_visibility("last_game_key_stretches_offense");' src="static/img/Gray_Plus150.png" /></div>
                                                
                                                    
                                        
                                    </div>
                                    <div class='non-dashboard-tile-content' id='last_game_key_stretches_offense_div'>
                                        
                                    </div>

                                </div>
                            </div>
                            <div class='col-12 block no-padding'>
                                <div class='non-dashboard-section card col-12' id='last_game_key_stretches_defense_container_div'>
                                    <div class='non-dashboard-section-header'>
                                        <div class='col-11-10 no-padding non-dashboard-label'>Game Stretches: Defensive Perspective</div>
                                                    
                                        <div class='col-1 right no-padding dashboard-tile-help-icon' id='last_game_key_stretches_defense_helpicon' style='margin-top:2px;'><img class='icon-15 explanation' value="team_my_schedule.html|last_game_key_stretches_defense" src="static/img/Gray_Info150.png" /></div>
                                        <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='last_game_key_stretches_defense_img' class='icon-15 toggle' onclick='toggle_tile_visibility("last_game_key_stretches_defense");' src="static/img/Gray_Plus150.png" /></div>
                                                
                                                    
                                        
                                    </div>
                                    <div class='non-dashboard-tile-content' id='last_game_key_stretches_defense_div'>
                                        
                                    </div>

                                </div>
                            </div>
                        </div>
                        <div class='right-content-panel' id='full_schedule_panel'>
                            <div class='col-12 flex-block no-padding'>
                            
                            </div>
                            <div class='col-12 flex-block no-padding'>
                            
                            </div>
                            
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
    

<script src="static/js/d3.v4.min.js"></script><script src="static/js/laxrefpro_graphing.js?dt=200"></script>
<script>
    var on_mobile = null;
    var console_log = []; var success = null;
    var time_log = JSON.parse({{misc.time_log|to_json2}});
    
    var single_stat = "<div class='col-12'><span class='lightish contents font-20'>[header]</span></div>";
    single_stat += "<div class='col-12 centered ' style='padding-top:65px;'><span class='tile-message font-18'>[stat]</span></div>";
    var misc = parse_misc({{misc|to_json2}});
    console_log.push({'msg': 'Loaded misc...'});
    var user_obj = {'settings': {{user_obj.settings|to_json2}}};
    console_log.push({'msg': 'Loaded user settings...'});
    //console.log(misc);
    var explanations = {{user_obj.explanations|to_json2}};

    if(misc.data.next_game == null){
        
        $("#next_game_panel").empty();
        $("#next_game_panel").append("<div class='col-12 centered no-padding'><span class='error font-18'>There is no \"next game\" to display yet.</span></div>");
        
    }

    if(misc.data.last_game == null){

        $("#last_game_panel").empty();
        $("#last_game_panel").append("<div class='col-12 centered no-padding'><span class='error font-18'>There is no \"last game\" to display yet.</span></div>");
    }
    
    function display_next_game(panel){ 
        if([null, 'next_game', 'matchup_advantages_shooting', 'film_guide', 'opp_profile_offense'].indexOf(panel) == -1){ return; }
    
        
        
        if(misc.data.next_game != null){
        
            cell_width = $("#matchup_advantages_shooting_container_div").width()/4/2;
            if(on_mobile){ cell_width *= 2; }
            
            id = 'film_guide_div'; success = false;
            try{
                // Data
                max_rows = Math.max(misc.data.next_game.film_guide.offense.key_stretches.length, misc.data.next_game.film_guide.defense.key_stretches.length);
                //console.log("misc.data.next_game.film_guide");
                //console.log(misc.data.next_game.film_guide);
                // Visualization
                for (tag in {'offense': 1, 'defense': 1}){
                    elem = $("#film_guide_" + tag); elem.empty();
                    html = "";
                    
                    html += "<div class='no-padding'>";
                    
                    html += "<div class='flex bbottom no-padding'>";
                    html += " <div class='col-4 no-padding'><span class='font-12 bold'>Opp</span></div>";
                    html += " <div class='col-2 no-padding'><span class='font-12 bold contents'>Start</span></div>";
                    html += " <div class='col-2 no-padding'><span class='font-12 bold contents'>End</span></div>";
                    html += " <div class='col-2 no-padding centered'><span class='font-12 bold contents'>Goals</span></div>";
                    html += " <div class='col-2 no-padding centered'><span class='font-12 bold contents'>Poss</span></div>";
                    html += "</div>";
                    printed = 0; show_last_year = false;
                    for(var a = 0;a<misc.data.next_game.film_guide[tag].key_stretches.length;a++){
                        bkt = misc.data.next_game.film_guide[tag].key_stretches[a];
                        if(bkt.last_year){ show_last_year = true; }
                        html += "<div class='flex table-row no-padding'>";
                        html += " <div class='col-4 no-padding'><span class='font-12'>" + bkt.opp_short_code + " (" + bkt.short_date_str + (bkt.last_year ? "*" : "") + ")</span></div>";
                        html += " <div class='col-2 no-padding'><span class='font-12 contents'>" + bkt.start_timestamp + "</span></div>";
                        html += " <div class='col-2 no-padding'><span class='font-12 contents'>" + bkt.end_timestamp + "</span></div>";
                        html += " <div class='col-2 no-padding centered'><span class='font-12 contents'>" + zFormat(bkt.goals, 0) + "</span></div>";
                        html += " <div class='col-2 no-padding centered'><span class='font-12 contents'>" + zFormat(bkt.possessions, 0) + "</span></div>";
                        html += "</div>";
                    }
                    elem.append(html); printed += 1;
                    while(printed < max_rows){
                        html += "<div class='flex no-padding'>";
                        html += " <div class='col-12 no-padding'><span class='font-12'>&nbsp;</span></div>";
                        html += "</div>";
                        printed += 1;
                    }
                    if(show_last_year){
                        html += "<div class='flex no-padding'>";
                        html += " <div class='col-12 right'><span class='font-12'>* Last Season</span></div>";
                        html += "</div>";
                    }
                }
                
                // Mark complete
                success = true;
            }
            catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
            
            if(!success){
                $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
                report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
            }
            id = 'matchup_advantages_shooting_div'; success = false;
            try{
                // Data
                
                tmp_data = {};
                tmp_data.shooting_offense = misc.data.full_shooting_profile_offense.this_year.filter(r=> r.tag == "shot_clock_remaining_bucket")[0];
                tmp_data.shooting_defense = misc.data.full_shooting_profile_defense.this_year.filter(r=> r.tag == "shot_clock_remaining_bucket")[0];
                //console.log(tmp_data);
                // Visualization
                for (tag in {'offense': 1, 'defense': 1}){
                    elem = $("#matchup_advantages_shooting_" + tag); elem.empty();
                    html = "";
                    
                    html += "<div class='no-padding'>";
                    
                    html += "<div class='flex bbottom'>";
                    html += " <div class='col-3'><span class='font-12 bold'>Clock Rem.</span></div>";
                    html += " <div class='col-3 centered'><span class='font-12 bold contents'>" + (tag=="offense" ? "Your": "Their") + " Share</span></div>";
                    html += " <div class='col-3 centered'><span class='font-12 bold contents'>Opportunity</span></div>";
                    html += " <div class='col-3 centered'><span class='font-12 bold contents'>Risk</span></div>";
                    html += "</div>";
                    
                    for(var a = 0;a<tmp_data['shooting_' + tag].buckets.length;a++){
                        bkt = tmp_data['shooting_' + tag].buckets[a];
                        bkt.label = (bkt.bucket) + (a < tmp_data['shooting_' + tag].buckets.length - 1 ? "-" + (bkt.bucket +9) + "s" : "+")
                        //console.log(bkt)
                        html += "<div class='flex table-row'>";
                        html += " <div class='col-3'><span class='font-12'>" + bkt.label + "</span></div>";
                        html += " <div class='col-3 centered'><span class='font-12 contents'>" + zFormat(100.0*bkt.share, 0) + "%</span></div>";
                        html += " <div class='col-3 centered' id='shotclock_pct" + a + "_" + tag + "'></div>";
                        html += " <div class='col-3 centered' id='shotclock_share" + a + "_" + tag + "'></div>";
                        html += "</div>";
                    }
                    elem.append(html);
                    for(var a = 0;a<tmp_data['shooting_' + tag].buckets.length;a++){
                        bkt = tmp_data['shooting_' + tag].buckets[a];
                        id = "shotclock_share" + a + "_" + tag;
                        
                        if(bkt.share_effect_weighted > .002){
                            dir = "up"; fill = '#282'; color = "#FFF";
                        }
                        else if(bkt.share_effect_weighted < -.002){
                            dir = "down"; fill = '#800'; color = "#FFF";
                        }
                        else{
                            dir = "sideways"; fill = '#EE1'; color = "#333";
                        }
                        
                        harvey_ball(id, {'width': cell_width, 'height':21, 'harvey_width': 18, 'chart_size': 'small', 'chart_type': 'harvey', 'fill': [fill, fill], color: color});
                        
                        id = "shotclock_pct" + a + "_" + tag;
                        
                        if(bkt.pct_effect_weighted > .02){
                            dir = "up"; fill = '#282'; color = "#FFF";
                        }
                        else if(bkt.pct_effect_weighted < -.02){
                            dir = "down"; fill = '#800'; color = "#FFF";
                        }
                        else{
                            dir = "sideways"; fill = '#EE1'; color = "#333";
                        }
                        
                        labeled_arrow(id, {'width': cell_width, 'height':21, 'dir': dir, 'arrow_width': 33, 'chart_size': 'small', 'chart_type': 'arrow', 'fill': fill, color: color, 'label': zFormat(100.0*bkt.pct_effect_weighted, 1) + "%"});
                    }
                }
                // Mark complete
                success = true;
            }
            catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
            
            if(!success){
                $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
                report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
            }
            
            id = 'matchup_advantages_pacing_div'; success = false;
            try{
                // Data

                
                
                tmp_data = {};
                tmp_data.pacing_offense = {'tag': 'poss_length', 'buckets': misc.data.offensive_pace_profile.length_data};
                tmp_data.pacing_defense = {'tag': 'poss_length', 'buckets': misc.data.defensive_pace_profile.length_data};
                //console.log(tmp_data);
                // Visualization
                for (tag in {'offense': 1, 'defense': 1}){
                    elem = $("#matchup_advantages_pacing_" + tag); elem.empty();
                    html = "";
                    
                    html += "<div class='no-padding'>";
                    
                    html += "<div class='flex bbottom'>";
                    html += " <div class='col-3'><span class='font-12 bold'>Poss. Length</span></div>";
                    html += " <div class='col-3 centered'><span class='font-12 bold contents'>" + (tag=="offense" ? "Your": "Their") + " Share</span></div>";
                    html += " <div class='col-3 centered'><span class='font-12 bold contents'>Opportunity</span></div>";
                    html += " <div class='col-3 centered'><span class='font-12 bold contents'>Risk</span></div>";
                    html += "</div>";
                    
                    for(var a = 0;a<tmp_data['pacing_' + tag].buckets.length;a++){
                        bkt = tmp_data['pacing_' + tag].buckets[a];
                        bkt.label = (bkt.min_t) + (a < tmp_data['pacing_' + tag].buckets.length - 1 ? "-" + (bkt.max_t - 1) + "s" : "+")
                        //console.log(bkt)
                        html += "<div class='flex table-row'>";
                        html += " <div class='col-3'><span class='font-12'>" + bkt.label + "</span></div>";
                        html += " <div class='col-3 centered'><span class='font-12 contents'>" + zFormat(100.0*bkt.share_this_year, 0) + "%</span></div>";
                        html += " <div class='col-3 centered' id='pacing_pct" + a + "_" + tag + "'></div>";
                        html += " <div class='col-3 centered' id='pacing_share" + a + "_" + tag + "'></div>";
                        html += "</div>";
                    }
                    elem.append(html);
                    for(var a = 0;a<tmp_data['pacing_' + tag].buckets.length;a++){
                        bkt = tmp_data['pacing_' + tag].buckets[a];
                        id = "pacing_share" + a + "_" + tag;
                        
                        if(bkt.share_effect > .002){
                            dir = "up"; fill = '#282'; color = "#FFF";
                        }
                        else if(bkt.share_effect < -.002){
                            dir = "down"; fill = '#800'; color = "#FFF";
                        }
                        else{
                            dir = "sideways"; fill = '#EE1'; color = "#333";
                        }
                        
                        harvey_ball(id, {'width': cell_width, 'height':21, 'harvey_width': 18, 'chart_size': 'small', 'chart_type': 'harvey', 'fill': [fill, fill], color: color});
                        
                        id = "pacing_pct" + a + "_" + tag;
                        
                        if(bkt.pct_effect > .02){
                            dir = "up"; fill = '#282'; color = "#FFF";
                        }
                        else if(bkt.pct_effect < -.02){
                            dir = "down"; fill = '#800'; color = "#FFF";
                        }
                        else{
                            dir = "sideways"; fill = '#EE1'; color = "#333";
                        }
                        
                        labeled_arrow(id, {'width': cell_width, 'height':21, 'dir': dir, 'arrow_width': 33, 'chart_size': 'small', 'chart_type': 'arrow', 'fill': fill, color: color, 'label': zFormat(100.0*bkt.pct_effect, 1) + "%"});
                    }
                }
                // Mark complete
                success = true;
            }
            catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
            
            if(!success){
                $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
                report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
            }
        }
        
        id = 'matchup_history_div'; success = false;
        try{
            // Data
            console.log("misc.data.matchup_history");
            console.log(misc.data.matchup_history);
            // Visualization
            elem = $("#" + id); elem.empty();
            html = "";
            
            tags = []
            tags.push({'class': '', 'label': 'Adj Off.', 'tag': 'adj_efficiency_offense', 'fmt': '%'})
            tags.push({'class': '', 'label': 'Adj Def.', 'tag': 'adj_efficiency_defense', 'fmt': '%'})
            tags.push({'class': '', 'label': 'FO %', 'tag': 'fo_win_rate', 'fmt': '%'})
            tags.push({'class': '', 'label': 'Save %', 'tag': 'save_pct', 'fmt': '%'})
            tags.push({'class': '', 'label': 'GB %', 'tag': 'gb_win_rate', 'fmt': '%'})
            tags.push({'class': 'dtop', 'label': 'Man-Up Off.', 'tag': 'man_up_offense', 'fmt': ""})
            tags.push({'class': 'dtop', 'label': 'Total Poss.', 'tag': 'total_possessions', 'fmt': 0})
            html += "<div class='no-padding'>";
            
            html += "<div class='flex bbottom'>";
            html += " <div class='col-2'><span class='font-12 bold'>Date</span></div>";
            html += " <div class='col-1'><span class='font-12 bold contents'>Result</span></div>";
            html += " <div class='col-9'><ul class='table-ul left' style='background-color:inherit;'>";
            for(var a = 0;a<tags.length;a++){ tag = tags[a];
            
                html += " <li style='' class='" + tag.class + " table-li no-padding centered'><div class='cell-holder no-padding'><span class='font-12 bold contents'>" + tag.label + "</span></div></li>";
            }
            html += "</ul></div>";
            html += "</div>";
            
            for(var a = 0;a<misc.data.matchup_history.length;a++){
                gm = misc.data.matchup_history[a];
               
                html += "<div class='flex table-row'>";
                html += " <div class='col-2'><span class='font-12'>" + gm.game_date_str + "</span></div>";
                html += " <div class='col-1'><span class='font-12 contents'>" + gm.result_str + "</span></div>";
                html += " <div class='col-9'><ul class='table-ul left' style='background-color:inherit;'>";
                for(var b = 0;b<tags.length;b++){ tag = tags[b];
                    if([null, ''].indexOf(gm[tag.tag]) > -1){ txt = ""; }
                    else if(tag.fmt == "%"){ txt = zFormat(100.0*gm[tag.tag], 1) + "%"; }
                    else if(tag.fmt == ""){ txt = gm[tag.tag]; }
                    else{ txt = zFormat(gm[tag.tag], tag.fmt); }
                    
                    html += " <li style='' class='" + tag.class + " table-li no-padding centered'><div class='cell-holder no-padding'><span class='font-12 contents'>" + txt + "</span></div></li>";
                }
                html += "</ul></div>";
                html += "</div>";
            }
            elem.append(html);
    
            // Mark complete
            success = true;
        }
        catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
        
        if(!success){
            $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
            report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
        }
    }
    
    
    function display_last_game(panel){
        //console.log("display_last_game: " + panel);
        if([null, 'last_game', 'last_game_history', 'last_game_game_results', 'last_game_movement'].indexOf(panel) == -1){ return; }
        
        if(misc.data.last_game == null){
        
        }
        else{
            id = 'last_game_headline_div'; success = false;
            try{
                // Data
                stats = misc.last_game_headline_stats.split("|");
                for(var a = 0;a<stats.length;a++){ stats[a] = {'unit': stats[a].split("~")[0], 'tag': stats[a].split("~")[1] }; }
                
                console.log("misc.data.last_game");
                console.log(misc.data.last_game);
                
                
                console.log("misc.extra_data.db_statistics");
                console.log(misc.extra_data.db_statistics);
                
                data = misc.extra_data.db_team_game_summaries;
                console.log("misc.extra_data.db_team_game_summaries");
                console.log(data);
                game_summaries = misc.data.last_game.summaries.filter(r=> r.team_ID==misc.data.ID && r.filter == null);
                
                headline_options = [];
                // Visualization
                html = ""
                elem = $("#" + id); elem.empty();
                
                console.log("game_summaries");
                console.log(game_summaries);
                
                
                html += "<div class='flex-block col-12'>"
                for(var a = 0;a<stats.length;a++){ stat = stats[a];
                    unit_summary = game_summaries.filter(r=> r.data_type==stat.unit)[0];
                    db_stat = misc.extra_data.db_statistics.filter(r=> r.stat == stat.tag)[0];
                    stat.reverse=db_stat.reverse;
                    stat.js_fmt=db_stat.js_fmt;
                    adjustment = unit_summary.game_stat_adjustments.filter(r=> r.stat_ID==db_stat.ID);
                    adjustment_value = null;
                    if(adjustment.length > 0 && adjustment != []){
                        adjustment_value = adjustment[0].adjustment;
                    }
                    label = db_stat.description;
                    if(db_stat.both_units == 1){ label += " (" + title(stat.unit) + ")"; }
                    html += "<div class='col-3-12 non-dashboard-tile-section' style=''>";
                    html += "<div class='col-12 no-padding'><span class='font-15 bold'>" + label + "</span></div>";
                    
                    html += "<div class='col-12 no-padding' style='padding-top:10px;'><span class='light font-14'>vs " + misc.data.last_game.opponent_display + "</span></div>";
                    if(adjustment_value != null){
                        html += "<div class='flex bbottom no-padding'>"
                        html += "<div class='col-6 no-padding centered'><span class='font-12 light'>Raw</span></div>"
                        html += "<div class='col-6 no-padding centered'><span class='font-12 light'>Adj</span></div>"
                        html +="</div>";
                        
                        raw_val = (1) ? jsformat(unit_summary[stat.tag], db_stat.js_fmt) : "";
                        adj_val = (1) ? jsformat(unit_summary[stat.tag] + adjustment_value, db_stat.js_fmt) : "";
                        html += "<div class='flex no-padding' style='padding-top:15px;'>"
                        html += "<div class='col-6 no-padding centered'><span class='font-18 bold'>" + raw_val + "</span></div>"
                        html += "<div class='col-6 no-padding centered'><span class='font-18 bold'>" + adj_val + "</span></div>"
                        html +="</div>";
                    }
                    else{
                        html += "<div class='flex no-padding'>"
                        html += "<div class='col-12 no-padding centered'><span class='font-12 light'>&nbsp;</span></div>"
                        html +="</div>";
                        
                        raw_val = (1) ? jsformat(unit_summary[stat.tag], db_stat.js_fmt) : "";
                        html += "<div class='flex no-padding' style='padding-top:15px;'>"
                        html += "<div class='col-12 no-padding centered'><span class='font-18 bold'>" + raw_val + "</span></div>"
                        html +="</div>";
                    }
                    
                   
                    html += "<div class='col-12 no-padding' style='padding-top:20px;' id='seasontrend" + a + "'></div>";
                    
                    
                    html += "</div>";
                }
                html += "</div>";
                
                
                                                
                                               
                                    
                elem.append(html);
                season_summaries = data.filter(r=> r.team_ID==misc.data.ID && r.filter == null);
                console.log("Found " + season_summaries.length + " season summaries.");
                if(season_summaries.length > 2){
                    for(var a = 0;a<stats.length;a++){ stat = stats[a];
                        specs = {'margin_left': 30, 'margin_right': 10, 'margin_top': 2, 'margin_bottom': 5, 'chart_size': 'small', 'flip': db_stat.reverse };
                        unit_summaries = season_summaries.filter(r=> r.data_type==stat.unit);
                        console.log("unit_summaries")
                        console.log(unit_summaries)
                        
                        data = {'axis_labels': {'y': 'Season Trend (Raw)', 'x': 'Games'}, 'data': []};
                        tmp = {'stroke-dasharray': '3-3', 'stroke-width': 2.5, 'stroke': "#33F", 'points': []}
                        for(var b = 0;b<unit_summaries.length;b++){
                            gm = unit_summaries[b];
                            tmp.points.push({'x': unit_summaries.length - b, 'y':  gm[stat.tag]});
                        }
                        data.data.push(tmp)
                        
                        x_ticks = create_game_x_ticks(data.data);
                        data['x_ticks'] = x_ticks.ticks; data['max_x'] = x_ticks.max; data['min_x'] = x_ticks.min;
                        
                        y_ticks = (stat.js_fmt.indexOf("%") > -1) ? create_pct_y_ticks(data.data, {}) : create_numeric_y_ticks(data.data)
                        data['y_ticks'] = y_ticks.ticks;
                        data['max_y'] = y_ticks.max;  data['min_y'] = y_ticks.min;
                            
                        if(on_mobile){
                            specs.width = $('#last_game_headline_container_div').width() * .95;    
                        }
                        else{
                            specs.width = $('#last_game_headline_container_div').width() * .23;   
                        }
                        
                        specs.height = 120;
                        horizontal_line(data, "seasontrend" + a, specs);
                    }
                }
                // Mark complete
                success = true;
            }
            catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
            
            if(!success){
                $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
                report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
            }
                    
            
            id = "last_game_adjusted_performance_primary_div"; success = false;
            try{
                // Data
                
                units = [{'div': 'last_game_adjusted_performance_primary_offense', 'tag': 'offense'}, {'div': 'last_game_adjusted_performance_primary_defense', 'tag': 'defense'}];
                // Visualization
                
                for(var a = 0;a<units.length;a++){ unit = units[a];
                    //console.log("misc.data.last_game.adjusted_performance." + unit.tag);
                    //console.log(misc.data.last_game.adjusted_performance[unit.tag]);
                
                    elem = $("#" + unit.div); elem.empty();
                    html = "";
                    
                    html += "<div class='no-padding'>";
                    
                    html += "<div class='flex bbottom no-padding'>";
                    html += " <div class='col-4 no-padding'><span class='font-12 bold'>Metric</span></div>";
                    html += " <div class='col-2 no-padding centered'><span class='font-12 bold contents'>Raw</span></div>";
                    html += " <div class='col-2 no-padding centered'><span class='font-12 bold contents'>Adj.</span></div>";
                    html += " <div class='col-2 no-padding centered'><span class='font-12 bold contents'>Final</span></div>";
                    html += " <div class='col-2 no-padding centered'><span class='font-12 bold contents'>Trend</span></div>";
                    html += "</div>";
    
                    for(var b = 0;b<misc.data.last_game.adjusted_performance[unit.tag].length;b++){
                        stat = misc.data.last_game.adjusted_performance[unit.tag][b];
                        //console.log(stat);
                        
                        if(stat.reverse){
                            if(stat.offensive){
                                adj_text_class = (stat.adjustment <= 0 ? "green-text" : "red-text")
                            }
                            else{
                                adj_text_class = (stat.adjustment >= 0 ? "green-text" : "red-text")
                            }
                        }
                        else{
                            if(stat.offensive){
                                adj_text_class = (stat.adjustment >= 0 ? "green-text" : "red-text")
                            }
                            else{
                                adj_text_class = (stat.adjustment <= 0 ? "green-text" : "red-text")
                            }
                        }
             
                        html += "<div class='flex table-row no-padding'>";
                        html += " <div class='col-4 no-padding'><span class='font-12'>" + stat.label + "</span></div>";
                        html += " <div class='col-2 no-padding centered'><span class='font-12 contents'>" + jsformat(stat.raw, stat.js_fmt) + "</span></div>";
                        html += " <div class='col-2 no-padding centered'><span class='font-12 contents " + adj_text_class + "'>" + (stat.adjustment > 0 ? "+" : "") + jsformat(stat.adjustment, stat.js_fmt) + "</span></div>";
                        html += " <div class='col-2 no-padding centered'><span class='font-12 contents'>" + jsformat(stat.final, stat.js_fmt) + "</span></div>";
                        html += " <div class='col-2 no-padding centered'><span class='font-12 contents'>" + jsformat(stat.trend, stat.js_fmt) + "</span></div>";
                        html += "</div>";
                    }
                    elem.append(html);
                    
                }
                // Mark complete
                success = true;
            }
            catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
            
            if(!success){
                $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
                report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
            }
                
                
            id = "last_game_adjusted_performance_specialty_div"; success = false;
            try{
                // Data
                
                // Visualization
                units = [{'div': 'last_game_adjusted_performance_specialty_goalkeepers', 'tag': 'goalkeepers'}, {'div': 'last_game_adjusted_performance_specialty_faceoffs', 'tag': 'faceoffs'}];
                // Visualization
                
                for(var a = 0;a<units.length;a++){ unit = units[a];
                    //console.log("misc.data.last_game.adjusted_performance." + unit.tag);
                    //console.log(misc.data.last_game.adjusted_performance[unit.tag]);
                
                    elem = $("#" + unit.div); elem.empty();
                    html = "";
                    
                    html += "<div class='no-padding'>";
                    
                    html += "<div class='flex bbottom no-padding'>";
                    html += " <div class='col-4 no-padding'><span class='font-12 bold'>Metric</span></div>";
                    html += " <div class='col-2 no-padding centered'><span class='font-12 bold contents'>Raw</span></div>";
                    html += " <div class='col-2 no-padding centered'><span class='font-12 bold contents'>Adj.</span></div>";
                    html += " <div class='col-2 no-padding centered'><span class='font-12 bold contents'>Final</span></div>";
                    html += " <div class='col-2 no-padding centered'><span class='font-12 bold contents'>Trend</span></div>";
                    html += "</div>";
    
                    for(var b = 0;b<misc.data.last_game.adjusted_performance[unit.tag].length;b++){
                        stat = misc.data.last_game.adjusted_performance[unit.tag][b];
                        //console.log(stat);
                        
                        if(stat.reverse){
                            if(stat.offensive){
                                adj_text_class = (stat.adjustment <= 0 ? "green-text" : "red-text")
                            }
                            else{
                                adj_text_class = (stat.adjustment >= 0 ? "green-text" : "red-text")
                            }
                        }
                        else{
                            if(stat.offensive){
                                adj_text_class = (stat.adjustment >= 0 ? "green-text" : "red-text")
                            }
                            else{
                                adj_text_class = (stat.adjustment <= 0 ? "green-text" : "red-text")
                            }
                        }
             
                        html += "<div class='flex table-row no-padding'>";
                        html += " <div class='col-4 no-padding'><span class='font-12'>" + stat.label + "</span></div>";
                        html += " <div class='col-2 no-padding centered'><span class='font-12 contents'>" + jsformat(stat.raw, stat.js_fmt) + "</span></div>";
                        html += " <div class='col-2 no-padding centered'><span class='font-12 contents " + adj_text_class + "'>" + (stat.adjustment > 0 && stat.stat != "possession_margin" ? "+" : "") + jsformat(stat.adjustment, stat.js_fmt) + "</span></div>";
                        html += " <div class='col-2 no-padding centered'><span class='font-12 contents'>" + jsformat(stat.final, stat.js_fmt) + "</span></div>";
                        html += " <div class='col-2 no-padding centered'><span class='font-12 contents'>" + jsformat(stat.trend, stat.js_fmt) + "</span></div>";
                        html += "</div>";
                    }
                    elem.append(html);
                    
                }
                // Mark complete
                success = true;
            }
            catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
            
            if(!success){
                $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
                report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
            }
            
            id = "last_game_positional_breakdown_div"; success = false;
            try{
                // Data
                //console.log("misc.data.last_game.positional_breakdown");
                //console.log(misc.data.last_game.positional_breakdown);
                // Visualization
                
                units = []
                units.push({'desc': 'Attack', 'tag': 'A'})
                units.push({'desc': 'Midfield/FO', 'tag': 'M'})
                units.push({'desc': 'Defense/GK', 'tag': 'D'})
                
                
                // Visualization
                elem = $("#" + id); elem.empty();
                html = "";
                    
                html += "<div class='no-padding'>";
                
                html += "<div class='flex bbottom no-padding'>";
                html += " <div class='col-3 no-padding'><span class='font-12 bold'>Metric</span></div>";
                for(var b = 0;b<units.length;b++){ unit = units[b];
                    html += " <div class='col-3 no-padding centered'><span class='font-12 bold contents'>" + unit.desc + "</span></div>";
                }
                html += "</div>";

                for(var b = 0;b<misc.data.last_game.positional_breakdown.length;b++){
                    stat = misc.data.last_game.positional_breakdown[b];
                    //console.log(stat);
                    
                    html += "<div class='flex table-row no-padding'>";
                    html += " <div class='col-3 no-padding'><span class='font-12'>" + stat.label + "</span></div>";
                    for(var c = 0;c<units.length;c++){ unit = units[c];
                        val = stat.values.filter(r=> r.tag == unit.tag)[0];
                        /*value_share = stat.value_share.filter(r=> r.tag == unit.tag)[0];
                        share_str = (['', 'N/A', 'n/a/', null].indexOf(value_share.value) > -1) ?  "N/A" : (zFormat(100.0*value_share.value, 0) + "%");
                        html += " <div class='col-3 no-padding centered'><span class='font-12 contents'>" + share_str + " (" +
                        jsformat(val.value, stat.js_fmt) + ")" + "</span></div>";*/
                    }
                    html += "</div>";
                }

                elem.append(html);
             
                
                // Mark complete
                success = true;
            }
            catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
            
            if(!success){
                $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
                report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
            }
            
            id = "last_game_situation_splits_div"; success = false;
            try{
                // Data
                //console.log("misc.data.last_game.situational_splits");
                //console.log(misc.data.last_game.situational_splits);
                // Visualization
                
                units = [{'desc': 'Offense', 'tag': 'offense'}, {'desc': 'Defense', 'tag': 'defense'}, {'desc': 'Faceoff Unit', 'tag': 'faceoffs'}, {'desc': 'Goalkeepers', 'tag': 'goalkeepers'}];
                
                situations = [{'tag': 'all', 'label': 'All'}, {'tag': 'garbage_time', 'label': 'Garbage'}, {'tag': 'competitive', 'label': 'In-Doubt'}]
                // Visualization
                elem = $("#" + id); elem.empty();
                html = "";
                    
                html += "<div class='no-padding'>";
                
                html += "<div class='flex bbottom no-padding'>";
                html += " <div class='col-6 no-padding'><span class='font-12 bold'>Metric</span></div>";
                for(var b = 0;b<situations.length;b++){ sit = situations[b];
                    html += " <div class='col-2 no-padding centered'><span class='font-12 bold contents'>" + sit.label + "</span></div>";
                }
                html += "</div>";
                elem.append(html);
                for(var a = 0;a<units.length;a++){ unit = units[a];
                    //console.log("misc.data.last_game.situational_splits." + unit.tag);
                    //console.log(misc.data.last_game.situational_splits[unit.tag]);
                
                    if(misc.data.last_game.situational_splits[unit.tag].length > 0){
                        html = "";

                        html += " <div class='col-12 no-padding bbottom light'><span class='font-13 bold' style='font-style:italic;'>" + unit.desc + "</span></div>";
            
                        
                        html += " <div class='no-padding'>";
                        for(var b = 0;b<misc.data.last_game.situational_splits[unit.tag].length;b++){
                            stat = misc.data.last_game.situational_splits[unit.tag][b];
                            console.log(stat);
                            
                            
                 
                            html += "<div class='flex table-row no-padding'>";
                            html += " <div class='col-6 no-padding'><span class='font-12' style='padding-left:15px;'>" + stat.label + "</span></div>";
                            for(var c = 0;c<situations.length;c++){ sit = situations[c];
                                val = stat.values.filter(r=> r.tag == sit.tag)[0];
                                html += " <div class='col-2 no-padding centered'><span class='font-12 contents'>" + jsformat(val.value, stat.js_fmt) + "</span></div>";
                            }
                            html += "</div>";
                        }
                        html += "</div>";
                        elem.append(html);
                    }
                }
                
                
                // Mark complete
                success = true;
            }
            catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
            
            if(!success){
                $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
                report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
            }
            
            
            units = [{'alt_tag': 'mine', 'tag': 'offense'}, {'alt_tag': 'theirs', 'tag': 'defense'}];
            for(var ab = 0;ab<units.length;ab++){
                unit = units[ab];
                id = "last_game_key_stretches_" + unit.tag + "_div"; success = false;
                try{
                    // Data
                    tags = []

                    tags.push({'shown': [], 'excluded': [], 'class': '', 'label': 'G', 'tag': 'goals', 'fmt': '0'})
                    tags.push({'shown': [], 'excluded': [], 'class': '', 'label': 'Shots', 'tag': 'shots', 'fmt': '0'})
                    tags.push({'shown': [], 'excluded': [], 'class': '', 'label': 'SOG', 'tag': 'sog', 'fmt': '0'})
                    tags.push({'shown': [], 'excluded': [], 'class': '', 'label': '# Poss.', 'tag': 'n', 'fmt': '0'})
                    tags.push({'shown': [], 'excluded': [], 'class': '', 'label': 'GBs', 'tag': 'gbs', 'fmt': '0'})
                    
                    tags.push({'shown': [], 'excluded': [], 'class': 'dtop', 'label': '% Poss', 'tag': 'possession_pct', 'fmt': "0%"})
                    
                    //console.log("misc.data.last_game.stretches");
                    //console.log(misc.data.last_game.stretches);
                    // Visualization
                    elem = $("#" + id); elem.empty();
                    html = "";
                    
                    
                    html += "<div class='no-padding'>";
                    
                    html += "<div class='flex bbottom'>";
                    html += " <div class='col-1-2'><span class='font-12 bold'>Start</span></div>";
                    html += " <div class='col-1-2'><span class='font-12 bold contents'>End</span></div>";
                    html += " <div class='col-10-8'><ul class='table-ul left' style='background-color:inherit;'>";
                    for(var a = 0;a<tags.length;a++){ tag = tags[a];
                    
                        html += " <li style='' class='" + tag.class + " table-li no-padding centered'><div class='cell-holder no-padding'><span class='font-12 bold contents'>" + tag.label + "</span></div></li>";
                    }
                    html += "</ul></div>";
                    html += "</div>";
                    elem.append(html);
                    
                    for(var b = 0;b<misc.data.last_game.stretches.length;b++){ stretch = misc.data.last_game.stretches[b];
                        //console.log(stretch);
                        split = stretch.splits[unit.alt_tag];
                        html = "";
                        html += "<div class='flex table-row'>";
                        html += " <div class='col-1-2'><span class='font-12'>" + stretch.start_clock + "</span></div>";
                        html += " <div class='col-1-2'><span class='font-12 contents'>" + stretch.end_clock + "</span></div>";
                        html += " <div class='col-10-8'><ul class='table-ul left' style='background-color:inherit;'>";
                        for(var a = 0;a<tags.length;a++){ tag = tags[a];
                        
                            html += " <li style='' class='" + tag.class + " table-li no-padding centered'><div class='cell-holder no-padding'><span class='font-12 contents'>" + jsformat(split[tag.tag], tag.fmt) + "</span></div></li>";
                        }
                        html += "</ul></div>";
                        html += "</div>";
                        elem.append(html);
                    }
                    // Mark complete
                    success = true;
                }
                catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
                
                if(!success){
                    $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
                    report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
                }
            }
        }
    }
    
    function display_full_schedule(panel){
        if([null, 'full_schedule', 'record_scenarios', 'bubble_watch', 'conf_seed_probabilities', 'selection_rivals'].indexOf(panel) == -1){ return; }
        
        id = 'record_scenarios'; success = false;
        try{
            // Data
            
            // Visualization
            
            // Mark complete
            success = true;
        }
        catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
        
        if(!success){
            $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
            report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
        }
            
    
        id =  'selection_rivals_div'; success = false;
        try{
            // Data
            
            // Visualization
            
            // Mark complete
            success = true;
        }
        catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
        
        if(!success){
            $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
            report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
        }
            
        
        
        id = 'conf_seed_probabilities_div'; success = false;
        try{
            // Data
            
            // Visualization
            
            // Mark complete
            success = true;
        }
        catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
        
        if(!success){
            $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
            report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
        }

        id = 'bubble_watch_div'; success = false;
        try{
            // Data
            
            // Visualization
            
            // Mark complete
            success = true;
        }
        catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
        
        if(!success){
            $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
            report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
        }

        
    }
    
    function redraw(panel=null){
        on_mobile = $("#main_logo").css('display') == "none";
        
        if(typeof panel == "object"){ panel = null; }
        
        console_log.push({'msg': 'Check misc.data...'});
        if('data' in misc && [{}, null].indexOf(misc.data) == -1){
            console_log.push({'msg': 'next_game...'});
            display_next_game(panel);
            console_log.push({'msg': 'last_game...'});
            display_last_game(panel);
            console_log.push({'msg': 'post season...'});
            display_full_schedule(panel);
            
            
            
        }
        
    }
    
    // Select the appropriate panel to display
    if('active_element' in misc){ choose_left_menu_item(misc.active_element); }
    else{ choose_left_menu_item("next_game"); }
    
    console_log.push({'msg': 'Start finish load...'});
    finish_load(JSON.parse({{user_obj.notifications|to_json2}}));
    
    window.addEventListener("resize", redraw); 
    
    
</script>
{% endblock %}

