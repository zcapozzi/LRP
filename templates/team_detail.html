
{% extends "layout_main.html" %}


{% block body %}

        <div class='col-12 dtop flex menu-header-bar'>
            <div class='col-12'>
                <a href='/' class='menu-link'><span class='menu-link' style='padding-left:10px;'><span class='font-15'>Home</span></span></a>
                <a href='/team_my_schedule' class='menu-link'><span class='menu-link' style='padding-left:10px;'><span class='font-15'>My Schedule</span></span></a>
                <a href='/team_my_stats' class='menu-link'><span class='menu-link' style=''><span class='font-15'>My Stats</span></span></a>
                <a href='/team_my_rankings' class='menu-link'><span class='menu-link' style=''><span class='font-15'>My Rankings</span></span></a>
            </div>
        </div>

        <div class='col-12 centered' id='banner'></div>
        
        
        
        {% if misc.error %}
            <div class='col-12 error centered'><span class='error' >{{misc.error|safe}}</span></div>
        {% endif %}
        {% if misc.msg %}
            <div class='col-12 error centered'><span class='' >{{misc.msg}}</span></div>
        {% endif %}
        <div class=''>
            <div class='no-padding options-bar col-12 flex'>
                <div class='no-padding col-9'>
                {% if misc.breadcrumbs %}
                    <div class='breadcrumbs'>
                        {{misc.breadcrumbs|safe}}
                    </div>
                {% endif %}
                </div>
                <div class='no-padding col-3 right'>
                    <div class='no-padding col-12 right'>
                        <div class='gear-settings'>
                            <img onclick='toggle_settings_bar("settings-bar");' id='settings-icon' class='icon-15 settings' src='/static/img/blue_gear15.png' />
                        </div>
                    </div>
                </div>
                
            </div>
            <div class='settings-bar single-row not-shown no-padding right' id='settings-bar'>
                <div class='' style='padding-right:10px;'>
                    <span class='font-13' style='padding-right:10px;'>Year</span>
                    <select class='settings-bar' id='general_focus_year' onchange='update_settings(this.id, this.value);'>
                        <option value=2020>2020</option>
                        <option value=2019>2019</option>
                    </select>
                </div>
            </div>
            <div class='refreshing-bar not-shown no-padding right' id='refreshing-bar'>
                <div class='centered' style=''>
                    <span class='font-18 bold' style=''>Refreshing content...</span>
                </div>
            </div>
            
            
            <div id='' class='non-dashboard-landing'>
                <div class='col-12 mob centered no-padding'>
                    <select style='width:80%; margin: 0% 10%;' id='top_menu_select' onChange='choose_left_menu_item(this.value);'>
                        <option id='overview_option' value='overview'>{{misc.data.display_name}}</option>
                        <option id='roster_option' value='roster'>Roster</option>
                        <option id='stats_option' value='stats'>Stats</option>
                        <option id='schedule_option' value='schedule'>Schedule</option>
                    </select>
                </div>
                <div class='flex col-12 no-padding'>
                    <div class='left-menu col-2-12 dtop'>
                        <div id='overview_menu_item' onclick='choose_left_menu_item(this.id);' class='active left-menu-item'><span class='mouseover-link pointer font-15'>{{misc.data.display_name}}</span></div>
                        <div id='roster_menu_item' onclick='choose_left_menu_item(this.id);' class='left-menu-item'><span class='mouseover-link pointer font-15'>Roster</span></div>
                        <div id='stats_menu_item' onclick='choose_left_menu_item(this.id);' class='left-menu-item'><span class='mouseover-link pointer font-15'>Stats</span></div>
                        <div id='schedule_menu_item' onclick='choose_left_menu_item(this.id);' class='left-menu-item'><span class='mouseover-link pointer font-15'>Schedule</span></div>
                    </div>
                    <div class='right-content col-10-12' id='right-content-panel'>
                        <div class='right-content-panel' id='overview_panel'>
                                <div class='flex-block'>
                            <div class='col-4-12 no-padding'>
                                <div class='col-12 flex-block no-padding vertical-fill'>
                                    <div class='non-dashboard-section card col-12' style='margin-right:5px;' id='overview_schedule_container_div'>
                                        <div class='non-dashboard-section-header'>
                                            <div onclick='drill_down_header(this.id, 1);' id='overview_schedule_label' route="|overview_schedule" class='col-11-10 no-padding non-dashboard-label'>Schedule</div>
                                                        
                                            <div class='col-1 right no-padding dashboard-tile-help-icon icon-visible' style='margin-top:2px;'><img id='overview_schedule_helpicon' class='icon-15' onclick="" src="static/img/Gray_Info150.png" /></div>
                                            <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='overview_schedule_img' class='icon-15 toggle' onclick='toggle_tile_visibility("overview_schedule");' src="static/img/Gray_Minus150.png" /></div>
                                                    
                                                        
                                            
                                        </div>
                                        <div class='non-dashboard-tile-content visible' id='overview_schedule_div'>
                                            
                                        </div>

                                    </div>
                                </div>
                            </div>
                            
                            <div class='col-8-12 no-padding'>
                                <div class='col-12 flex-block no-padding'>
                                    <div class='non-dashboard-section card col-12' style='margin-left:5px;' id='overview_stats_container_div'>
                                        <div class='non-dashboard-section-header'>
                                            <div onclick='drill_down_header(this.id, 1);' id='overview_stats_label' route="|overview_stats" class='col-11-10 no-padding non-dashboard-label'>Lifetime History</div>
                                                        
                                            <div class='col-1 right no-padding dashboard-tile-help-icon' style='margin-top:2px;'><img id='overview_stats_helpicon' class='icon-15 explanation' value="team_my_rankings.html|overview_stats" src="static/img/Gray_Info150.png" /></div>
                                            <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='overview_stats_img' class='icon-15 toggle' onclick='toggle_tile_visibility("overview_stats");' src="static/img/Gray_Plus150.png" /></div>
                                                    
                                                        
                                            
                                        </div>
                                        <div class='non-dashboard-tile-content' id='overview_stats_div'>
                                            
                                        </div>

                                    </div>
                                </div>
                                <div class='col-12 no-padding flex-block'>
                                    <div class='non-dashboard-section card col-12' id='overview_projections_container_div'>
                                        <div class='non-dashboard-section-header'>
                                            <div onclick='drill_down_header(this.id, 1);' id='overview_projections_label' route="|overview_projections" class='col-11-10 no-padding non-dashboard-label'>Lax-ELO Movement</div>
                                                        
                                            <div class='col-1 right no-padding dashboard-tile-help-icon' style='margin-top:2px;'><img id='overview_projections_helpicon' class='icon-15 explanation' value="team_my_rankings.html|overview_projections" src="static/img/Gray_Info150.png" /></div>
                                            <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='overview_projections_img' class='icon-15 toggle' onclick='toggle_tile_visibility("overview_projections");' src="static/img/Gray_Plus150.png" /></div>
                                                    
                                                        
                                            
                                        </div>
                                        <div class='non-dashboard-tile-content' id='overview_projections_div'>
                                            
                                        </div>

                                    </div>
                                </div>
                               
                           </div>
                            
                            </div>
                        
                        
                        </div>
                        <div class='right-content-panel' id='roster_panel'>
                            <div class='col-12 no-padding flex-block'>
                                <div class='non-dashboard-section card col-12' id='roster_full_container_div'>
                                    <div class='non-dashboard-section-header'>
                                        <div onclick='drill_down_header(this.id, 1);' id='roster_full_label' route="|roster_full" class='col-11-10 no-padding non-dashboard-label'>{{misc.data.display_name}} Roster</div>
                                                    
                                        <div class='col-1 right no-padding dashboard-tile-help-icon' style='margin-top:2px;'><img id='roster_full_helpicon' class='icon-15 explanation' value="team_my_rankings.html|roster_full" src="static/img/Gray_Info150.png" /></div>
                                        <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='roster_full_img' class='icon-15 toggle' onclick='toggle_tile_visibility("roster_full");' src="static/img/Gray_Plus150.png" /></div>
                                                
                                                    
                                        
                                    </div>
                                    <div class='non-dashboard-tile-content' id='roster_full_div'>
                                        
                                    </div>

                                </div>
                            </div>
                            
                            
                        </div>
                        <div class='right-content-panel' id='stats_panel'>
                            <div class='col-12'>
                                <div class='non-dashboard-section card col-12' id='stats_ranks_container_div'>
                                    <div class='non-dashboard-section-header'>
                                        <div onclick='drill_down_header(this.id, 1);' id='stats_ranks_label' route="|stats_ranks" class='col-11-9 no-padding non-dashboard-label'>Statistical Ranks</div>
                                                    
                                        <div class='col-1 right no-padding dashboard-tile-help-icon icon-visible mob' id='stats_ranks_filtericon' style='margin-top:2px;'><img onclick='toggle_settings_bar("offensive-ranks-settings-bar");' class='icon-15 settings'  src="static/img/gray_Filter150.png" /></div>
                                        <div class='col-1 right no-padding dashboard-tile-help-icon icon-visible' style='margin-top:2px;'><img id='stats_ranks_helpicon' class='icon-15 explanation' value="team_my_stats.html|stats_ranks" src="static/img/Gray_Info150.png" /></div>
                                        <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='stats_ranks_img' class='icon-15 toggle' onclick='toggle_tile_visibility("stats_ranks");' src="static/img/Gray_Minus150.png" /></div>
                                                
                                                    
                                        
                                    </div>
                                    <div class='non-dashboard-tile-content bigger visible' id='stats_ranks_div'>
                                        <div class='no-padding'>
                                            <div class='mob no-padding' style=''>
                                                <div class='settings-bar rounded not-shown no-padding' id='offensive-ranks-settings-bar'>
                                                    <div class='' style='margin-bottom:25px;'>
                                                        <div class='no-padding col-12 flex'>
                                                            <div class='col-4 margin white'>
                                                                <div class='light col-12 no-padding'><span class=' no-padding font-15'>Metric</span></div>
                                                                <div id='stats_ranks_stat_select_mob' class='stat-select'> </div>
                                                            </div>
                                                            <div class='col-4 margin white'>
                                                                <div class='light col-12 no-padding'><span class=' no-padding font-15'>Comparison</span></div>
                                                                <div class='col-12 flex no-padding' id='stats_ranks_mob_peers'></div>
                                                                
                                                            </div>
                                                            <div class='col-4 margin white'>
                                                                <div class='light col-12 no-padding'><span class=' no-padding font-15'>Calculation</span></div>
                                                                <div class='col-12 flex no-padding' id='stats_ranks_mob_calculation'></div>
                                                                
                                                            </div>
                                                        </div>
                                                        
                                                        <div class='margin white no-padding'>
                                                            <div class='light no-padding'><span class='font-15'>Filters</span></div>
                                                            <div id='stats_ranks_filter_options_ranks_mob' class='block-flex filter-options'></div>
                                                        </div>
                                                        
                                                    
                                                    </div>
                                                </div>
                                                
                                            </div>
                                            <div class='flex no-padding'>
                                                <div class='col-8-12 non-dashboard-tile-section' id='stats_ranks_graph_div' style=''>
                                                
                                                </div>
                                            
                                              
                                                <div class='col-2 dtop non-dashboard-tile-section' style=''>
                                                    <div class='col-12 no-padding'><span class='no-padding font-15 bold'>Select a Stat</span></div>
                                                    <div id='stats_ranks_stat_tags_dtop' class='stat-tags'> </div>
                                                    <div class='no-padding centered'><span class='font-12'>- OR -</span></div>
                                                    <div id='stats_ranks_stat_select_dtop' class='stat-select'> </div>
                                                    <div class='col-12 no-padding' style='padding-top:10px;'><span class='no-padding font-15 bold'>Calculation</span></div>
                                                    <div class='col-12 flex no-padding'>
                    
                                                    <div class='col-10 no-padding' style='padding-left:10px;'><span class='contents font-11'>Raw</span></div>
                                                    <div class='col-2 no-padding right'><input value='offensive_calculation_raw' type=radio name='radio1' class='offensive_calculation_radio' onclick='toggler(this);'></div>
                                                    </div>
                                                    <div class='col-12 flex no-padding'>
                    
                                                    <div class='col-10 no-padding' style='padding-left:10px;'><span class='contents font-11'>Adjusted</span></div>
                                                    <div class='col-2 no-padding right'><input value='offensive_calculation_adjusted'  class='offensive_calculation_radio' type=radio name='radio2' onclick='toggler(this);'></div>
                                                    </div>
                                                </div>
                                            
                                              
                                                <div class='col-2 dtop non-dashboard-tile-section'>
                                                    <div class='col-12 no-padding'><span class='no-padding font-15 bold'>Filter</span></div>
                                                    <div id='stats_ranks_filter_options_dtop' class='filter-options'></div>
                                                    
                                                    {% if misc.data.conference_ID %}
                                                    <div class='col-12 no-padding' style='padding-top:10px;'><span class='no-padding font-15 bold'>Comparison</span></div>
                                                    <div class='col-12 flex no-padding'>
                    
                                                    <div class='col-10 no-padding' style='padding-left:5px;'><span class='contents font-11'>League-wide</span></div>
                                                    <div class='col-2 no-padding right'><input value='offensive_peers_league' type=radio name='radio3' class='offensive_peers_radio' onclick='toggler(this);'></div>
                                                    </div>
                                                    <div class='col-12 flex no-padding'>
                    
                                                    <div class='col-10 no-padding' style='padding-left:5px;'><span class='contents font-11'>Conference</span></div>
                                                    <div class='col-2 no-padding right'><input value='offensive_peers_conference' class='offensive_peers_radio' type=radio name='radio4' onclick='toggler(this);'></div>
                                                    </div>
                                                {% endif %}
                                                </div>
                                                
                                                
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                            <div class='col-12'>
                                <div class='non-dashboard-section card col-12' id='stats_game_breakdown_container_div'>
                                    <div class='non-dashboard-section-header'>
                                        <div onclick='drill_down_header(this.id, 1);' id='stats_game_breakdown_label' route="|stats_game_breakdown" class='col-11-10 no-padding non-dashboard-label'>Record Scenarios</div>
                                                    
                                        <div class='col-1 right no-padding dashboard-tile-help-icon' style='margin-top:2px;'><img  id='stats_game_breakdown_helpicon' class='icon-15 explanation'  value="team_detail.html|stats_game_breakdown" src="static/img/Gray_Info150.png" /></div>
                                        <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='stats_game_breakdown_img' class='icon-15 toggle' onclick='toggle_tile_visibility("stats_game_breakdown");' src="static/img/Gray_Plus150.png" /></div>
                                                
                                                    
                                        
                                    </div>
                                    <div class='non-dashboard-tile-content' id='stats_game_breakdown_div'>
                                        
                                    </div>

                                </div>
                            </div>

                        <div class='right-content-panel' id='schedule_panel'>
              
                            <div class='non-dashboard-section card col-12' id='schedule_games_container_div'>
                                <div class='non-dashboard-section-header'>
                                    <div onclick='drill_down_header(this.id, 1);' id='schedule_games_label' route="|schedule_games" class='col-11-10 no-padding non-dashboard-label'>Conference Seed Probabilities</div>
                                                
                                    <div class='col-1 right no-padding dashboard-tile-help-icon icon-visible' id='schedule_games_helpicon' style='margin-top:2px;'><img class='icon-15 explanation' value="team_my_rankings.html|schedule_games" src="static/img/Gray_Info150.png" /></div>
                                    <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='schedule_games_img' class='icon-15 toggle' onclick='toggle_tile_visibility("schedule_games");' src="static/img/Gray_Minus150.png" /></div>
                                            
                                                
                                    
                                </div>
                                <div class='non-dashboard-tile-content visible' id='schedule_games_div'>
                                    
                                </div>

                            </div>
                       
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
    

<script src="static/js/d3.v4.min.js"></script><script src="static/js/laxrefpro_graphing.js?dt=200"></script>
<script>
    var on_mobile = null;
    var console_log = []; var success = null;
    var time_log = JSON.parse({{misc.time_log|to_json2}});
    
    function process_roster_history(misc){
        raw = misc.extra_data.all_teams_roster_history;
        start_x = misc.roster_movement_start_date;
        
        time_log.push({'tag': "process_roster_history", 'start': new Date().getTime()});
        var history = [];
        var change_history = [];
        var conf_ID = null;
        var team_entry = null;
        var conf = {'add': 1, 'stroke': "maroon", 'stroke-dasharray': null, 'stroke-width': 1, 't': {'display_name': 'Conf Avg'}, 'n': 0.0};
        var rows = []
        for(var a = 0;a<raw.length;a++){
            var row = JSON.parse(JSON.stringify(raw[a]));
            row.add = 0; row.team = 0;
            
            row.conf_agg = false;
            tokens = row.t.split("|")
                
            row.t = {'years': [], 'change_years': [], 'team_ID': parseInt(tokens[0]), 'conf_ID': parseInt(tokens[1]), 'display_name': tokens[2]}
            years = row.d.split("*");
            for(var b = 0;b<years.length;b++){
                yr = {};
                year_value = parseInt(years[b].substring(0,4));
                yr.points = years[b].substring(4).split("~");
                for(var c = 0;c<yr.points.length;c++){
                    tokens = yr.points[c].split("|")
                    yr.points[c] = {'label': tokens[0], 'x': parseInt(tokens[1]), 'y': parseInt(tokens[2]), 'dt': parseInt(tokens[3])};
                    //if(row.t.team_ID == 1){ console.log(  yr.points[c].dt , start_x, yr.points[c].dt == start_x ); }
                    if(yr.points[c].dt == start_x){
                        row.start_y = yr.points[c].y;
                    }
                }
                row.t.years.push(yr);
            }
            for(var b = 0;b<years.length;b++){
                change_yr = {};
                year_value = parseInt(years[b].substring(0,4));
                change_yr.points = years[b].substring(4).split("~");
                for(var c = 0;c<change_yr.points.length;c++){
                    tokens = change_yr.points[c].split("|")
                    change_yr.points[c] = {'label': tokens[0], 'x': parseInt(tokens[1]), 'y': (parseInt(tokens[2])/row.start_y)* 100.0, 'dt': parseInt(tokens[3])};
                }
                change_yr.points = change_yr.points.filter( d => d.dt >= start_x);
                row.t.change_years.push(change_yr);
            }
            //console.log(row.t.display_name, row.start_y);
            if(row.t.team_ID == misc.active_team_ID){
                row.stroke = "#77F"; row['stroke-dasharray'] = null; row['stroke-width'] = 2; 
                conf_ID = row.t.conf_ID;
                conf.n = 1.0;
                conf.t.years = JSON.parse(JSON.stringify(row.t.years));
                conf.t.change_years = JSON.parse(JSON.stringify(row.t.change_years));
                row.team = 1;
                team_entry = row;
            }
            rows.push(row);
        }
        
        
        for(var a = 0;a<rows.length;a++){
            var row = rows[a];
            if(row.t.team_ID != misc.active_team_ID && row.t.conf_ID == conf_ID){
                row.stroke = "#DDD"; row['stroke-width'] = 1; row['stroke-dasharray'] = null; row.add = 1;
                //history.push(row)
                conf.n += 1.0;
                
                for(var c = 0;c<conf.t.years.length;c++){
                    for(var b = 0;b<conf.t.years[c].points.length;b++){
                        conf.t.years[c].points[b].y += row.t.years[c].points[b].y;
                    }
                }
                for(var c = 0;c<conf.t.change_years.length;c++){
                    for(var b = 0;b<conf.t.change_years[c].points.length;b++){
                        conf.t.change_years[c].points[b].y += row.t.change_years[c].points[b].y;
                    }
                }
            }
        }
        for(var c = 0;c<conf.t.years.length;c++){
            for(var b = 0;b<conf.t.years[c].points.length;b++){
                conf.t.years[c].points[b].y /= conf.n;
            }
        }
        for(var c = 0;c<conf.t.change_years.length;c++){
            for(var b = 0;b<conf.t.change_years[c].points.length;b++){
                conf.t.change_years[c].points[b].y /= conf.n;
            }
        }
        rows.push(conf);
        for(var a = 0;a<rows.length;a++){
            var row = rows[a];
            if(row.add){
                for(var b = 0;b<row.t.years.length;b++){
                    yr = row.t.years[b];
                    d = {'stroke': row.stroke, 'stroke-width': row['stroke-width'], 'stroke-dasharray': row['stroke-dasharray'], 'display_name': row.display_name, 'points': yr.points}
                    history.push(d);
                    
                    change_yr = row.t.change_years[b];
                    change_d = {'stroke': row.stroke, 'stroke-width': row['stroke-width'], 'stroke-dasharray': row['stroke-dasharray'], 'display_name': row.display_name, 'points': change_yr.points}
                    change_history.push(change_d);
                }
            }
        }
        for(var a = 0;a<rows.length;a++){
            var row = rows[a];
            if(row.team){
                for(var b = 0;b<row.t.years.length;b++){
                    yr = row.t.years[b];
                    d = {'stroke': row.stroke, 'stroke-width': row['stroke-width'], 'stroke-dasharray': row['stroke-dasharray'], 'display_name': row.display_name, 'points': yr.points}
                    history.push(d);
                    
                    change_yr = row.t.change_years[b];
                    change_d = {'stroke': row.stroke, 'stroke-width': row['stroke-width'], 'stroke-dasharray': row['stroke-dasharray'], 'display_name': row.display_name, 'points': change_yr.points}
                    change_history.push(change_d);
                }
            }
        }
        
        time_log[time_log.length-1].end = new Date().getTime();
        misc.all_teams_roster_history = history;
        misc.all_teams_roster_change_history = change_history;
        return misc;
    }
    
    var single_stat = "<div class='col-12'><span class='lightish contents font-20'>[header]</span></div>";
    single_stat += "<div class='col-12 centered ' style='padding-top:65px;'><span class='tile-message font-18'>[stat]</span></div>";
    var misc = parse_misc({{misc|to_json2}});
    console_log.push({'msg': 'Loaded misc...'});
    var user_obj = {'settings': {{user_obj.settings|to_json2}}};
    console_log.push({'msg': 'Loaded user settings...'});
    //console.log(misc);
    var explanations = {{user_obj.explanations|to_json2}};
    
    function display_overview(panel){ 
        if([null, 'overview', 'conditional_rpi', 'rpi_distribution', 'deconstructed_rpi'].indexOf(panel) == -1){ return; }
    
        id = 'rpi_distribution_div'; success = false;
        try{
            if(typeof misc.data.RPI_ranks_histogram != "undefined" && misc.data.RPI_ranks_histogram.length > 0){
                specs = {'margin_left': 30, 'chart_size': 'small', 'flip': 0};
                
                data = {'axis_labels': {'y': '% of Simulations', 'x': 'Final RPI Rank'}, 'data': []};
                tmp = {'stroke-dasharray': '3-3', 'stroke': "#666", 'points': []}
                tmp.points = misc.data.RPI_ranks_histogram;
                data.data.push(tmp)
                
                x_ticks = create_game_x_ticks(data.data);
                data['x_ticks'] = x_ticks.ticks; data['max_x'] = x_ticks.max; data['min_x'] = x_ticks.min;
                y_ticks = create_pct_y_ticks(data.data, {})
                data['y_ticks'] = y_ticks.ticks;
                data['max_y'] = y_ticks.max;  data['min_y'] = 0;
                specs.width = $('#rpi_distribution_container_div').width()-20;
                
                vertical_bars(data, id, specs);
                
            }
            else{
                $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Could not calculate RPI distribution."));
            }
            success = true;
        }
        catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
        
        if(!success){
            $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
            report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
        }
        
        id = 'conditional_rpi_div'; success = false;
        try{
            if(typeof misc.data.future_games != "undefined" && misc.data.future_games != null && misc.data.future_games.length > 0){
                custom_specs = {'chart_size': 'small', 'margin_top': 0, 'margin_right': 0, 'margin_bottom': 0, 'margin_left': 0};
                custom_specs.width = $('#conditional_rpi_container_div').width() - 20;
                custom_conditional_RPI_tile(misc, id, custom_specs);
            }
            else{
                $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "No scheduled games"));
            }
            success = true;
        }
        catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
        
        if(!success){
            $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
            report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
        }
        
        id = 'deconstructed_rpi_div'; success = false;
        try{
            if(typeof misc.data.RPI_factors != "undefined" && misc.data.RPI_factors.length > 0){
                generic_create_table(JSON.parse(misc.data.RPI_factors), {'id': id, 'target_elem': id});
            }
            else{
                $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Could not calculate deconstructed RPI."));
            }
            success = true;
        }
        catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
        
        if(!success){
            $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
            report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
        }
    }
    
    var roster = misc.data.roster;
    //misc = process_roster_history(misc);
    var roster_dates = []
    function display_roster(panel){
        //console.log("display_roster: " + panel);
        if([null, 'roster', 'roster_history', 'roster_game_results', 'roster_movement'].indexOf(panel) == -1){ return; }
        
        func = 'roster'
        id = 'roster_full'; success = false;
        try{
            
            // Data
            
            console.log("misc.data.roster")
            console.log(roster);
            roles = [];
            roles.push({'desc': 'Field', 'tag':  'field', 'role_tags': ['O', 'D']});
            roles.push({'desc': 'FOGO', 'tag': 'fogo', 'role_tags': ['F']});
            roles.push({'desc': 'Goalkeepers', 'tag': 'goalkeepers', 'role_tags': ['G']});
            

            for(var a = 0;a<roster.length;a++){ p = roster[a];
                p.role = null;
                if(p.player == "Charles Leonard"){ p.role = "F"; }
                if(p.player == "Matt Schmidt"){ p.role = "G"; }
                p.team_play_shares = .1+ a/100;
                p.seq = a;
                p.faceoff_record = p.faceoff_wins + " - " + p.faceoff_losses;
                p.save_pct = p.shots_faced > 0 ? 1.0 - (p.goals_allowed / p.shots_faced) : null;
                p.excess_saves = p.expected_goals_allowed - p.goals_allowed;
            }
            
            for(var b = 0;b<roles.length;b++){ 
                role_players = roster.filter(r=> roles[b].role_tags.indexOf(r.role) > -1 || (b==0 && r.role == null));
                js_data = {'no_row_count': 1, 'data': [], 'row_style_class': 'bottom light'}
                js_data.fields = [{'sort_by': 'player', 'tag': 'player', 'display': 'Player'}];


                if(roles[b].tag == "field"){
                    js_data.classes = [{'class': 'col-2-4 mouseover-link'}, {'outer_class': 'col-10-8', 'classes': [{'class': 'centered'}, {'class': 'centered'}, {'class': 'right'}]}];
                    js_data.fmt = [{'fmt': ""}, {'fmt': "2"}, {'fmt': "1%"}, {'fmt': ""}];
                    js_data.fields.push({'sort_by': 'EGA', 'tag': 'EGA', 'display': 'EGA'});
                    js_data.fields.push({'sort_by': 'team_play_shares', 'tag': 'team_play_shares', 'display': 'Play Shares'});
                }
                else if(roles[b].tag == "fogo"){
                    js_data.classes = [{'class': 'col-2-4 mouseover-link cursor'}, {'outer_class': 'col-10-8', 'classes': [{'class': 'centered'}, {'class': 'centered'}, {'class': 'right'}]}];
                    js_data.fmt = [{'fmt': ""}, {'fmt': "1%"}, {'fmt': ""}, {'fmt': ""}];
                    js_data.fields.push({'sort_by': 'faceoff_pct', 'tag': 'faceoff_pct', 'display': 'FO Win Rate'});
                    js_data.fields.push({'sort_by': 'faceoff_pct', 'tag': 'faceoff_record', 'display': 'FO Record'});
                }
                else if(roles[b].tag == "goalkeepers"){
                    js_data.classes = [{'class': 'col-2-4 mouseover-link'}, {'outer_class': 'col-10-8', 'classes': [{'class': 'centered'}, {'class': 'centered'}, {'class': 'centered'}, {'class': 'centered'}, {'class': 'centered'}, {'class': 'right'}]}];
                    js_data.fmt = [{'fmt': ""}, {'fmt': "0%"}, {'fmt': "0"}, {'fmt': "0"}, {'fmt': ".1"}, {'fmt': ".1"}, {'fmt': ""}];
                    js_data.fields.push({'sort_by': 'save_pct', 'tag': 'save_pct', 'display': 'Save Pct'});
                    js_data.fields.push({'sort_by': 'shots_faced', 'tag': 'shots_faced', 'display': 'Shots Faced'});
                    js_data.fields.push({'sort_by': 'goals_allowed', 'tag': 'goals_allowed', 'display': 'Goals Allowed'});
                    js_data.fields.push({'sort_by': 'expected_goals_allowed', 'tag': 'expected_goals_allowed', 'display': 'Expected GA'});
                    js_data.fields.push({'sort_by': 'excess_saves', 'tag': 'excess_saves', 'display': 'Excess Saves'});
                }
                js_data.fields.push({'tag': 'expand', 'display': ''});
                
                for(var a = 0;a<role_players.length;a++){
                    p = role_players[a];
                    d = {'team_play_shares': p.team_play_shares};
                    d.player = "<FORM id='player" + p.ID + "form' action='/team_player_detail' method=POST><input type=hidden name='ID' value='" + p.ID + "'><input type=hidden name='came_from' value='{{misc.came_from}}'><span onclick=\"document.getElementById(\'player" + p.ID + "form\').submit();\" class='no-padding'>" + p.player+ "</span></FORM>";
                    d.expand = "<img id='player" + p.seq + "_imgicon' class='icon-15 row-toggle' onclick='display_player(" + p.seq + ");' src='static/img/Gray_Plus_Skinny150.png' />";
                    js_data.data.push(d);
                }
                roles[b].js_data = js_data;
            }
            
            
                
                
            // Visualization
            elem = $("#" + id + "_div"); elem.empty();
            for(var b = 0;b<roles.length;b++){role = roles[b];
                html = "<div class='col-12 bbottom'><span class='font-18 bold'>" + role.desc + "</span></div>";
                elem.append(html);  
                
                html = "<div id='role" + b + "_div' class='no-padding' style='padding-bottom:20px;'></div>";
                elem.append(html);  
                
                if(role.js_data.data.length == 0){
                    //$("#role" + b + "_div").empty(); 
                    $("#role" + b + "_div").append("<div class='col-12'><span class='font-12 error'>There are no players to display.</span></div>");
                }
                else{
                    generic_create_table(role.js_data, {'id': 'role' + b + '_div', 'target_elem': 'role' + b + '_div'});
                }
            }
            
            html = "";
            html += "<div class='col-12 right no-padding' style='padding-top:5px;'><span class='contents font-12'>Note: the roster includes only those players who have appeared in the box score during the season in question.</div>";
            elem.append(html);
            
            // Mark Success
            success = true;
        }
        catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
        
        if(!success){
            $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
            report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
        }
                
        
    }
    
    
    function display_player(seq){
    
        console.log("Seq: " + seq);
        console.log(roster);
      
        p = roster.filter(r=> r.seq == seq)
        if(p.length == 0){
            // Fail
            report_js_visualization_issue(misc.target_template + "|display_player teamID=" + misc.data.ID + " seq=" + seq + "|" + misc.nhca);
            player_html = "";
        }
        else{
            p = p[0];
            console.log("Display player")
            console.log(p)
            
            loops = [{'tag': 'rate', 'div_style': 'padding-top:20px; padding-bottom:30px;', 'id': 'player_overlay_rate_stats'}, {'tag': 'cnt', 'div_style': '', 'id': 'player_overlay_cnt_stats'}];
            roles = []
            
            tmp = {'tag': 'O', 'desc': 'Offense', 'fields': []};
            tmp.fields.push({'type': 'rate', 'tag': 'EGA_per_game', 'label': 'EGA/gm', 'jsfmt': "2"})
            tmp.fields.push({'type': 'rate', 'tag': 'EGA_per_game_rank_str', 'label': 'EGA Rank', 'jsfmt': ""})
            tmp.fields.push({'type': 'rate', 'tag': 'play_shares_rank_str', 'label': 'Team Play Share Rank', 'jsfmt': ""})
            tmp.fields.push({'type': 'rate', 'tag': 'shooting_pct', 'label': 'Shooting Pct', 'jsfmt': "1%"})
            
            tmp.fields.push({'type': 'cnt', 'tag': 'goals', 'label': 'Goals', 'jsfmt': "0"})
            tmp.fields.push({'type': 'cnt', 'tag': 'assists', 'label': 'Assists', 'jsfmt': "0"})
            tmp.fields.push({'type': 'cnt', 'tag': 'shots_taken', 'label': 'Shots Taken', 'jsfmt': "0"})
            tmp.fields.push({'type': 'cnt', 'tag': 'turnovers', 'label': 'Turnovers', 'jsfmt': "0"})
            roles.push(tmp);
            
            tmp = {'tag': 'D', 'desc': 'Defense', 'fields': []};
            tmp.fields.push({'type': 'rate', 'tag': 'EGA_per_game', 'label': 'EGA/gm', 'jsfmt': "2"})
            tmp.fields.push({'type': 'rate', 'tag': 'defensive_EGA_per_game_rank_str', 'label': 'Def EGA Rank', 'jsfmt': ""})
            tmp.fields.push({'type': 'rate', 'tag': 'penalties_per_game', 'label': 'Penalties/gm', 'jsfmt': ""})
            tmp.fields.push({'type': 'rate', 'tag': 'caused_turnover_share', 'label': 'Share of Team CTs', 'jsfmt': "0%"})
            
            tmp.fields.push({'type': 'cnt', 'tag': 'caused_turnovers', 'label': 'Caused Turnovers', 'jsfmt': "0"})
            tmp.fields.push({'type': 'cnt', 'tag': 'gbs', 'label': 'Ground balls', 'jsfmt': "0"})
            tmp.fields.push({'type': 'cnt', 'tag': 'goals', 'label': 'Goals', 'jsfmt': "0"})
            tmp.fields.push({'type': 'cnt', 'tag': 'assists', 'label': 'Assists', 'jsfmt': "0"})
            roles.push(tmp);
            
            tmp = {'tag': 'F', 'desc': 'Faceoff', 'fields': []};
            tmp.fields.push({'type': 'rate', 'tag': 'EGA_per_game', 'label': 'EGA/gm', 'jsfmt': "2"})
            tmp.fields.push({'type': 'rate', 'tag': 'faceoff_EGA_per_game_rank_str', 'label': 'FO EGA Rank', 'jsfmt': ""})
            tmp.fields.push({'type': 'rate', 'tag': 'faceoff_elo_rank_str', 'label': 'FO ELO Rank', 'jsfmt': ""})
            tmp.fields.push({'type': 'rate', 'tag': 'faceoff_win_rate', 'label': 'Faceoff Win Rate', 'jsfmt': "1%"})
            
            tmp.fields.push({'type': 'cnt', 'tag': 'faceoff_record', 'label': 'Caused Turnovers', 'jsfmt': "0"})
            tmp.fields.push({'type': 'cnt', 'tag': 'gbs', 'label': 'Ground balls', 'jsfmt': "0"})
            tmp.fields.push({'type': 'cnt', 'tag': 'goals', 'label': 'Goals', 'jsfmt': "0"})
            tmp.fields.push({'type': 'cnt', 'tag': 'assists', 'label': 'Assists', 'jsfmt': "0"})
            roles.push(tmp);
            
            tmp = {'tag': 'G', 'desc': 'Goalkeeper', 'fields': []};
            tmp.fields.push({'type': 'rate', 'tag': 'excess_saves_per_game', 'label': 'Excess Saves/gm', 'jsfmt': "2"})
            tmp.fields.push({'type': 'rate', 'tag': 'excess_saves_per_game_rank_str', 'label': 'Excess Saves Rank', 'jsfmt': ""})
            tmp.fields.push({'type': 'rate', 'tag': 'save_pct', 'label': 'Save Pct', 'jsfmt': "1%"})
            
            tmp.fields.push({'type': 'cnt', 'tag': 'shots_faced', 'label': 'Shots Faced', 'jsfmt': "0"})
            tmp.fields.push({'type': 'cnt', 'tag': 'saves', 'label': 'Saves', 'jsfmt': "0"})
            tmp.fields.push({'type': 'cnt', 'tag': 'goals_allowed', 'label': 'Goals Allowed', 'jsfmt': "0"})
            roles.push(tmp);
            
            role = roles.filter(r=> r.tag == p.role || (r.tag == "O" && p.role == null))[0];
            
            player_content = "";
            for(var b = 0;b<loops.length;b++){ loop = loops[b];
                
                player_content += "<div class='no-padding' id='" + loop.id + "' style='" + loop.div_style + "'>";
                
                loop_fields = role.fields.filter(r=> r.type == loop.tag);
                // Add rate/EGA data
                for(var a = 0;a<loop_fields.length;a++){
                    f = loop_fields[a];
                    if(a % 4 == 0){
                        player_content += "<div class='no-padding flex-block'>";
                    }
                    val = f.tag in p ? (p[f.tag] == null ? "N/A": p[f.tag]) : "N/A";
                    
                    player_content += "<div class='no-padding col-3-12'>";
                    player_content += "<div class='no-padding'><span class='light font-15'>" + f.label + "</span></div>";
                    player_content += "<div class='no-padding'><span class='bold font-24'>" + jsformat(val, f.jsfmt) + "</span></div>";
                    player_content += "</div>";
                    
                    if(a % 4 == 3 || a == role.fields.length-1){
                        player_content += "</div>";
                    }
                }
                
                // Wrap-up
                player_content += "</div>";
            }    
                

            
            
            
            player_html = "<div class='col-12 flex'><div class='col-10 inline-flex'><span class='font-36 bold contents'>" + p.player + "</span><FORM id='player_detail_form" + p.ID + "' action='/team_player_detail' method=POST><input type=hidden name='ID' value='" + p.ID + "' /><input type=hidden name='came_from' value='{{misc.came_from}}' /><img style='padding-left:15px; padding-top:9px;' onclick=\"document.getElementById('player_detail_form" + p.ID + "').submit();\" src=\"static/img/popout25.png\" /></FORM></div>";
            player_html += "<div class='col-2 right'><img onclick='hide_overlay();' src='/static/img/Close24.png' /></div></div>";
            player_html += "<div class='col-12 exp-scroll'>" + player_content + "</div>";
            
            
        }
       
    var logger_str = null;
 
        
    
    
    html = '';
        html += '<div class="flex" style="max-height:450px; margin:5px;">';
            html += '<div class="col-1"></div>';
            html += '<div class="col-10 popup-content">';
            html += player_html;
           

            
            //html += '<div class="col-12 centered" style="padding-top:15px;"><button class="action-button" onclick="hide_overlay();" class="close"><span class="">Close</span></button></div>    ';
            html += '</div>';
            html += '<div class="col-1"></div>';
        html += '</div>';
    
    
            $("#fullscreen_overlay_panel").empty(); $("#fullscreen_overlay_panel").append(html); $("#fullscreen_overlay_panel").addClass("shown");



    }

    
    
    function display_post_season_odds(panel){
        if([null, 'schedule', 'record_scenarios', 'bubble_watch', 'conf_seed_probabilities', 'selection_rivals'].indexOf(panel) == -1){ return; }
        
        id = 'record_scenarios'; success = false;
        try{
            var cur_wins = parseInt(misc.data.record.split("-")[0].trim());
            var cur_losses = parseInt(misc.data.record.split("-")[1].trim());
            
            var likely = misc.data.win_loss_records.filter(gm => gm.frequency > 0);
            n_likely = likely.length;
            if(n_likely <= 8){ // Just show the win-loss scenarios
            
                document.getElementById('record_scenarios_helpicon').setAttribute( "onclick", "show_explanation('team_my_rankings.html|record_scenarios_records')");
                    
                    
                likely.sort(function(first, second) {
                        return second.pct_in - first.pct_in;
                });
                likely = likely.slice(0,8);
                var js_data = {'no_row_count': 1}
                js_data.classes = [{'class': 'col-4'}, {'class': 'col-4 centered'}, {'class': 'col-4 centered'}];
                js_data.fmt = [{'fmt': ""}, {'fmt': "0%"}, {'fmt': "0%"}];
                js_data.fields = [{'sort_by': 'win_pct', 'tag': 'rec', 'display': 'Final Record'}
                , {'sort_by': 'frequency', 'tag': 'frequency', 'display': 'Likelihood'}
                , {'sort_by': 'pct_in', 'tag': 'pct_in', 'display': 'NCAA %'}
                ];
                
                
                js_data.data = likely;
                generic_create_table(js_data, {'id': 'record_scenarios', 'target_elem': 'record_scenarios_div'});
            }
            else{ // Show the overall win total scenarios
                document.getElementById('record_scenarios_helpicon').setAttribute( "onclick", "show_explanation('team_my_rankings.html|record_scenarios_wins')");
                
                misc.data.future_wins.sort(function(first, second) {
                    return first.future_wins - second.future_wins;
                });
                wins = misc.data.future_wins;
                
                last_zero_index = null; last_zero_wins = null;
                first_100_index = null; first_100_wins = null;
                for(var a = 0;a<wins.length;a++){
                    var rec = wins[a];
                    if(rec.pct_in == 0){ last_zero_index = a; last_zero_wins = rec.future_wins; }
                    if(rec.pct_in == 1 && first_100_index == null){ first_100_index = a; first_100_wins = rec.future_wins; }
                }
                var cum_0 = 0; var cum_100 = 0;
                for(var a = 0;a<=last_zero_index;a++){ 
                    cum_0 += wins[a].frequency;
                }
                if(first_100_index != null){
                    for(var a = first_100_index;a<wins.length;a++){
                        cum_100 += wins[a].frequency;
                    }
                }
                else{
                    first_100_index = wins.length;
                    cum_100 = null;
                }
                
                //console.log("First non zero: " + last_zero_wins);
                //console.log("Last sub 100: " + first_100_wins);
                table_data = [];
                table_data.push({'wins_str': (cur_wins + last_zero_wins) + " or less", 'wins': cur_wins + last_zero_wins, 'frequency': cum_0, 'pct_in': 0.0});
                for(var a =last_zero_index + 1;a<first_100_index;a++){
                    var rec = wins[a];
                    table_data.push({'wins_str': cur_wins + rec.future_wins, 'wins': cur_wins + rec.future_wins, 'frequency': rec.frequency, 'pct_in': rec.pct_in});
                }
                if(cum_100 != null){
                    table_data.push({'wins_str': (cur_wins + first_100_wins) + " or more", 'wins': cur_wins + first_100_wins, 'frequency': cum_100, 'pct_in': 1.0});
                }
                
                var js_data = {'no_row_count': 1}
                js_data.classes = [{'class': 'col-4'}, {'class': 'col-4 centered'}, {'class': 'col-4 centered'}];
                js_data.fmt = [{'fmt': ""}, {'fmt': "0%"}, {'fmt': "0%"}];
                js_data.fields = [{'sort_by': 'wins', 'tag': 'wins_str', 'display': 'Final Wins'}
                , {'sort_by': 'frequency', 'tag': 'frequency', 'display': 'Likelihood'}
                , {'sort_by': 'pct_in', 'tag': 'pct_in', 'display': 'NCAA %'}
                ];
                
                
                js_data.data = table_data;
                generic_create_table(js_data, {'id': 'record_scenarios', 'target_elem': 'record_scenarios_div'});

            }
            success = true;
        }
        catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
        
        if(!success){
            $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
            report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
        }
            
    
        id =  'selection_rivals_div'; success = false;
        try{
            misc.data.selection_rivals.bubble_rivals.sort(function(first, second) {
                return -(first.diff - second.diff);
            });
            rivals = misc.data.selection_rivals.bubble_rivals.slice(0, 8);
        
            var js_data = {'no_row_count': 1}
            js_data.classes = [{'class': 'col-4'}, {'outer_class': 'col-8', 'classes': [{'class': 'col-3 centered'}, {'class': 'col-3 centered'}, {'class': 'col-3 centered'}]}];
            js_data.fmt = [{'fmt': ""}, {'fmt': "0%"}, {'fmt': "0%"}, {'fmt': "0%"}];
            js_data.fields = [{'sort_by': 'display_name', 'tag': 'display_name', 'display': 'Team'}
            , {'sort_by': 'in_pct_val', 'tag': 'in_pct_val', 'display': 'In when In'}
            , {'sort_by': 'out_pct_val', 'tag': 'out_pct_val', 'display': 'In when Out'}
            , {'sort_by': 'diff', 'tag': 'diff', 'display': 'Net'}
            ];
            
            js_data.data = rivals;
            generic_create_table(js_data, {'id':id, 'target_elem': 'selection_rivals_div'});
            
            success = true;
        }
        catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
        
        if(!success){
            $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
            report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
        }
            
        
        
        id = 'conf_seed_probabilities_div'; success = false;
        try{
            misc.data.seed_instances;
            seed_data = []
            
            var total = 0; var total_positive = 0;
            si = misc.data.seed_instances
            for(var a = 0;a<si.length;a++){
                var seed = si[a];
                if(typeof seed == "number"){
                    total += seed;
                    if(seed > 0){ total_positive += 1; }
                }
            }
            si = si.slice(0, misc.data.num_conf_tournament_teams);
            if(total_positive == 1){ // Just tell them what they've won
                var seed = null;
                for(var b = 0;b<si.length;b++){ if(si[b] > 0){ seed = b + 1; } }
                
                var msg = "<div class='centered' style='padding-top:30px;'><span class='font-18 contents'>You are locked in as the #" + seed + " seed.</span></div>";
                $("#" + id).empty(); $("#" + id).append(msg);
            }
            else if(total_positive > 1){ // Show the graph of the remaining possibilities
                if(total > 0){
                    for(var a = 0;a<si.length;a++){
                        var seed = si[a];
                        
                        d = {'label': (a+1), 'x': a, 'y': seed/total};
                        
                        seed_data.push(d);
                    }
                    specs = {'chart_size': 'small', 'flip': 0, 'margin_right': 20};
                        
                    data = {'axis_labels': {'y': 'Chance of each seed in Conf. Tournament', 'x': 'Conference Tournament Seed'}, 'data': []};
                    tmp = {'stroke-dasharray': '3-3', 'stroke': "#666", 'points': []}
                    tmp.points = seed_data;
                    data.data.push(tmp)
                    
                    x_ticks = create_game_x_ticks(data.data);
                    data['x_ticks'] = x_ticks.ticks; data['max_x'] = x_ticks.max; data['min_x'] = x_ticks.min;
                    y_ticks = create_pct_y_ticks(data.data,{})
                    data['y_ticks'] = y_ticks.ticks;
                    data['max_y'] = y_ticks.max;  data['min_y'] = 0;
                    specs.width = $('#conf_seed_probabilities_container_div').width() - 20;
                    
                    vertical_bars(data, id, specs);
                }
            }
            else{
                $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Could not calculate seed distribution."));

            }  
            success = true;
        }
        catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
        
        if(!success){
            $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
            report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
        }

        id = 'bubble_watch_div'; success = false;
        try{
            if(typeof misc.data.bubble_watch_games != "undefined" && misc.data.bubble_watch_games.length > 0){
                specs = {'margin_left': 30, 'chart_size': 'small', 'flip': 0};
                
                data = {'axis_labels': {'y': '% of Simulations', 'x': 'Final RPI Rank'}, 'data': []};
                tmp = {'stroke-dasharray': '3-3', 'stroke': "#666", 'points': []}
                tmp.points = misc.data.RPI_ranks_histogram;
                data.data.push(tmp)
                
                x_ticks = create_game_x_ticks(data.data);
                data['x_ticks'] = x_ticks.ticks; data['max_x'] = x_ticks.max; data['min_x'] = x_ticks.min;
                y_ticks = create_pct_y_ticks(data.data,{})
                data['y_ticks'] = y_ticks.ticks;
                data['max_y'] = y_ticks.max;  data['min_y'] = 0;
                specs.width = $('#bubble_watch_container_div').width() - 20;
                
                vertical_bars(data, id, specs);
                
            }
            else{
                $("#" + id).empty();
                $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "No relevant (to you) bubble watch games have been identified."));
            }
            success = true;
        }
        catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
        
        if(!success){
            $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
            report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
        }

        
    }
    
    function redraw(panel=null){
        on_mobile = $("#main_logo").css('display') == "none";
        
        if(typeof panel == "object"){ panel = null; }
        
        console_log.push({'msg': 'Check misc.data...'});
        if('data' in misc && [{}, null].indexOf(misc.data) == -1){
            console_log.push({'msg': 'projected rpi...'});
            display_overview(panel);
            console_log.push({'msg': 'projected roster...'});
            display_roster(panel);
            console_log.push({'msg': 'post season...'});
            display_post_season_odds(panel);
            
        }
        
    }
    console.log(misc.active_element);
    // Select the appropriate panel to display
    if('active_element' in misc && [null,''].indexOf(misc.active_element) == -1 ){ choose_left_menu_item(misc.active_element); }
    else{ choose_left_menu_item("roster"); }
    
    console_log.push({'msg': 'Start finish load...'});
    finish_load(JSON.parse({{user_obj.notifications|to_json2}}));
    
    window.addEventListener("resize", redraw); 
    
    display_player(0);
</script>
{% endblock %}

