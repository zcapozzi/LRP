
{% extends "layout_main.html" %}


{% block body %}

        <div class='col-12 dtop flex menu-header-bar'>
            <div class='col-12 inline-flex'>
                <div class='no-padding'> <a href='/' class='menu-link'><span class='menu-link font-15'>Home</span></span></a></div>
                <div class='no-padding'> <a href='/team_my_schedule' class='menu-link'><span class='menu-link font-15'><span class='no-padding dtop'>My </span>Schedule</span></a></div>
                <div class='no-padding'> <a href='/team_my_stats' class='menu-link'><span class='menu-link font-15'><span class='no-padding dtop'>My </span>Stats</span></a></div>
                <div class='no-padding'> <a href='/team_my_rankings' class='menu-link'><span class='menu-link font-15'><span class='no-padding dtop'>My </span>Rankings</span></a></div>
                <div class='no-padding' id='explore_menu_item'><div class='no-padding'><a class='menu-link'><span class='menu-link font-15 pointer'>Explore</span></a></div></div>
            </div>
        </div>

        <div class='col-12 centered' id='banner'></div>
        
        
        
        {% if misc.error %}
            <div class='col-12 error centered'><span class='error' >{{misc.error|safe}}</span></div>
        {% endif %}
        {% if misc.msg %}
            <div class='col-12 error centered'><span class='' >{{misc.msg}}</span></div>
        {% endif %}
        <div class=''>
            <div class='no-padding options-bar col-12 flex'>
                <div class='no-padding col-9'>
                {% if misc.breadcrumbs %}
                    <div class='breadcrumbs'>
                        {{misc.breadcrumbs|safe}}
                    </div>
                {% endif %}
                </div>
                <div class='no-padding col-3 right'>
                    <div class='no-padding col-12 right'>
                        <div class='gear-settings'>
                            <img onclick='toggle_settings_bar("settings-bar");' id='settings-icon' class='icon-15 settings' src='/static/img/blue_gear15.png' />
                        </div>
                    </div>
                </div>
                
            </div>
            <div style='display:none'>
                <FORM action='/team_detail' id='settings_form' method=POST>
                    <input type=hidden id='settings_form_detail_team_ID' name='detail_team_ID' value='' />
                    <input type=hidden name='came_from' value='{{misc.came_from}}' />
                </FORM>
            </div>
            <div class='settings-bar single-row not-shown no-padding right' id='settings-bar'>
                <div class='' style='padding-right:10px;'>
                    <span class='font-13' style='padding-right:10px;'>Year</span>
                    <select class='settings-bar' id='general_focus_year' onchange='update_settings(this.id, this.value, "detail_team_ID~{{misc.data.ID}}");'>
                        {% for y in misc.year_select_options %}
                            <option value={{y.year}}>{{y.year}}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class='refreshing-bar not-shown no-padding right' id='refreshing-bar'>
                <div class='centered' style=''>
                    <span class='font-18 bold' style=''>Refreshing content...</span>
                </div>
            </div>
            
            
            <div id='' class='non-dashboard-landing'>
                <div class='col-12 mob centered no-padding'>
                    <select style='width:80%; margin: 0% 10%;' id='top_menu_select' onChange='choose_left_menu_item(this.value);'>
                        <option id='offensive_ranks_option' value='offensive_ranks'>Stats: Offense</option>
                        <option id='stats_defensive_option' value='stats_defensive'>Stats: Defense</option>
                        <option id='faceoffs_ranks_option' value='faceoffs_ranks'>Stats: Faceoffs</option>
                        <option id='goalkeepers_ranks_option' value='goalkeepers_ranks'>Stats: Goalkeepers</option>
                        <option id='schedule_option' value='schedule'>Schedule</option>
                        <option id='roster_option' value='roster'>Roster</option>
                        <option id='rankings_option' value='rankings'>Rankings</option>
                        
                    </select>
                </div>
                <div class='flex col-12 no-padding'>
                    <div class='left-menu col-2-12 dtop'>
                        <div id='stats_menu_item' class='left-menu-item'><span class='pointer font-15'>Stats</span></div>
                        <div id='offense_menu_item' onclick='choose_left_menu_item(this.id);' class='left-menu-item child'><span class='mouseover-link pointer font-15'>Offense</span></div>
                        <div id='defense_menu_item' onclick='choose_left_menu_item(this.id);' class='left-menu-item child'><span class='mouseover-link pointer font-15'>Defense</span></div>
                        <div id='faceoffs_menu_item' onclick='choose_left_menu_item(this.id);' class='left-menu-item child'><span class='mouseover-link pointer font-15'>Faceoffs</span></div>
                        <div id='goalkeepers_menu_item' onclick='choose_left_menu_item(this.id);' class='left-menu-item child'><span class='mouseover-link pointer font-15'>Goalkeepers</span></div>
                        <div id='schedule_menu_item' onclick='choose_left_menu_item(this.id);' class='left-menu-item'><span class='mouseover-link pointer font-15'>Schedule</span></div>
                        <div id='roster_menu_item' onclick='choose_left_menu_item(this.id);' class='left-menu-item'><span class='mouseover-link pointer font-15'>Roster</span></div>
                        <div id='rankings_menu_item' onclick='choose_left_menu_item(this.id);' class='left-menu-item'><span class='mouseover-link pointer font-15'>Rankings</span></div>
                    </div>
                    <div class='right-content col-10-12' id='right-content-panel'>
                        <div class='right-content-panel' id='schedule_panel'>
                            <div class='non-dashboard-section card col-12' style='margin-right:5px;' id='schedule_overview_container_div'>
                                <div class='non-dashboard-section-header'>
                                    <div onclick='drill_down_header(this.id, 1);' id='schedule_label' route="|schedule_overview" class='col-11-10 no-padding non-dashboard-label'>{{misc.data.display_name}}: Schedule</div>
                                                
                                    <div class='col-1 right no-padding dashboard-tile-help-icon icon-visible' style='margin-top:2px;'><img id='schedule_helpicon' class='icon-15' onclick="" src="static/img/Gray_Info150.png" /></div>
                                    <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='schedule_img' class='icon-15 toggle' onclick='toggle_tile_visibility("schedule_overview");' src="static/img/Gray_Minus150.png" /></div>
                                            
                                                
                                    
                                </div>
                                <div class='non-dashboard-tile-content visible' id='schedule_overview_div'>
                                    
                                </div>
                            </div>
                        </div>
                        <div class='right-content-panel' id='rankings_panel'>
                            <div class='non-dashboard-section card col-12' style='margin-right:5px;' id='rankings_overview_container_div'>
                                <div class='non-dashboard-section-header'>
                                    <div onclick='drill_down_header(this.id, 1);' id='rankings_label' route="|rankings_overview" class='col-11-10 no-padding non-dashboard-label'>{{misc.data.display_name}}: Rankings</div>
                                                
                                    <div class='col-1 right no-padding dashboard-tile-help-icon icon-visible' style='margin-top:2px;'><img id='rankings_helpicon' class='icon-15' onclick="" src="static/img/Gray_Info150.png" /></div>
                                    <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='rankings_img' class='icon-15 toggle' onclick='toggle_tile_visibility("rankings_overview");' src="static/img/Gray_Minus150.png" /></div>
                                            
                                                
                                    
                                </div>
                                <div class='non-dashboard-tile-content bigger visible' id='rankings_overview_div'>
                                    
                                </div>
                            </div>
                        </div>
                        <div class='right-content-panel' id='roster_panel'>
                            <div class='non-dashboard-section card col-12' style='margin-right:5px;' id='roster_overview_container_div'>
                                <div class='non-dashboard-section-header'>
                                    <div onclick='drill_down_header(this.id, 1);' id='roster_label' route="|roster_overview" class='col-11-10 no-padding non-dashboard-label'>{{misc.data.display_name}}: Roster</div>
                                                
                                    <div class='col-1 right no-padding dashboard-tile-help-icon icon-visible' style='margin-top:2px;'><img id='roster_helpicon' class='icon-15' onclick="" src="static/img/Gray_Info150.png" /></div>
                                    <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='roster_img' class='icon-15 toggle' onclick='toggle_tile_visibility("roster_overview");' src="static/img/Gray_Minus150.png" /></div>
                                            
                                                
                                    
                                </div>
                                <div class='non-dashboard-tile-content visible' id='roster_overview_div'>
                                    
                                </div>
                            </div>
                        </div>
                        <div class='right-content-panel' id='offense_panel'>
                            <div class='non-dashboard-section card col-12' style='margin-right:5px;' id='offensive_ranks_container_div'>
                                <div class='non-dashboard-section-header'>
                                    <div onclick='drill_down_header(this.id, 1);' id='offensive_ranks_label' route="|offensive_ranks" class='col-11-9 no-padding non-dashboard-label'>{{misc.data.display_name}}: Offense</div>
                                                
                                    <div class='col-1 right no-padding dashboard-tile-help-icon icon-visible mob' id='offensive_ranks_filtericon' style='margin-top:2px;'><img onclick='toggle_settings_bar("offensive-ranks-settings-bar");' class='icon-15 settings'  src="static/img/gray_Filter150.png" /></div>
                                    <div class='col-1 right no-padding dashboard-tile-help-icon icon-visible' style='margin-top:2px;'><img id='offensive_ranks_helpicon' class='icon-15' onclick="" src="static/img/Gray_Info150.png" /></div>
                                    <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='offensive_ranks_img' class='icon-15 toggle' onclick='toggle_tile_visibility("offensive_ranks");' src="static/img/Gray_Minus150.png" /></div>
                                            
                                                
                                    
                                </div>
                                <div class='non-dashboard-tile-content bigger visible' id='offensive_ranks_div'>
                                        <div class='no-padding'>
                                            <div class='mob no-padding' style=''>
                                                <div class='settings-bar rounded not-shown no-padding' id='offensive-ranks-settings-bar'>
                                                    <div class='' style='margin-bottom:25px;'>
                                                        <div class='no-padding col-12 flex'>
                                                            <div class='col-4 margin white'>
                                                                <div class='light col-12 no-padding'><span class=' no-padding font-15'>Metric</span></div>
                                                                <div id='offensive_ranks_stat_select_mob' class='stat-select'> </div>
                                                            </div>
                                                            <div class='col-4 margin white'>
                                                                <div class='light col-12 no-padding'><span class=' no-padding font-15'>Comparison</span></div>
                                                                <div class='col-12 flex no-padding' id='offensive_ranks_mob_peers'></div>
                                                                
                                                            </div>
                                                            <div class='col-4 margin white'>
                                                                <div class='light col-12 no-padding'><span class=' no-padding font-15'>Calculation</span></div>
                                                                <div class='col-12 flex no-padding' id='offensive_ranks_mob_calculation'></div>
                                                                
                                                            </div>
                                                        </div>
                                                        
                                                        <div class='margin white no-padding'>
                                                            <div class='light no-padding'><span class='font-15'>Filters</span></div>
                                                            <div id='offensive_ranks_filter_options_ranks_mob' class='block-flex filter-options'></div>
                                                        </div>
                                                        
                                                    
                                                    </div>
                                                </div>
                                                
                                            </div>
                                            <div class='flex no-padding'>
                                                <div class='col-8-12 non-dashboard-tile-section' id='offensive_ranks_graph_div' style=''>
                                                
                                                </div>
                                            
                                              
                                                <div class='col-2 dtop non-dashboard-tile-section' style=''>
                                                    <div class='col-12 no-padding'><span class='no-padding font-15 bold'>Select a Stat</span></div>
                                                    <div id='offensive_ranks_stat_tags_dtop' class='stat-tags'> </div>
                                                    <div class='no-padding centered'><span class='font-12'>- OR -</span></div>
                                                    <div id='offensive_ranks_stat_select_dtop' class='stat-select'> </div>
                                                    <div class='col-12 no-padding' style='padding-top:10px;'><span class='no-padding font-15 bold'>Calculation</span></div>
                                                    <div class='col-12 flex no-padding'>
                    
                                                    <div class='col-10 no-padding' style='padding-left:10px;'><span class='contents font-11'>Raw</span></div>
                                                    <div class='col-2 no-padding right'><input value='offensive_calculation_raw' type=radio name='radio1' class='offensive_calculation_radio' onclick='toggler(this);'></div>
                                                    </div>
                                                    <div class='col-12 flex no-padding'>
                    
                                                    <div class='col-10 no-padding' style='padding-left:10px;'><span class='contents font-11'>Adjusted</span></div>
                                                    <div class='col-2 no-padding right'><input value='offensive_calculation_adjusted'  class='offensive_calculation_radio' type=radio name='radio2' onclick='toggler(this);'></div>
                                                    </div>
                                                </div>
                                            
                                              
                                                <div class='col-2 dtop non-dashboard-tile-section'>
                                                    <div class='col-12 no-padding'><span class='no-padding font-15 bold'>Filter</span></div>
                                                    <div id='offensive_ranks_filter_options_dtop' class='filter-options'></div>
                                                    
                                                    {% if misc.data.conference_ID %}
                                                    <div class='col-12 no-padding' style='padding-top:10px;'><span class='no-padding font-15 bold'>Comparison</span></div>
                                                    <div class='col-12 flex no-padding'>
                    
                                                    <div class='col-10 no-padding' style='padding-left:5px;'><span class='contents font-11'>League-wide</span></div>
                                                    <div class='col-2 no-padding right'><input value='offensive_peers_league' type=radio name='radio3' class='offensive_peers_radio' onclick='toggler(this);'></div>
                                                    </div>
                                                    <div class='col-12 flex no-padding'>
                    
                                                    <div class='col-10 no-padding' style='padding-left:5px;'><span class='contents font-11'>Conference</span></div>
                                                    <div class='col-2 no-padding right'><input value='offensive_peers_conference' class='offensive_peers_radio' type=radio name='radio4' onclick='toggler(this);'></div>
                                                    </div>
                                                {% endif %}
                                                </div>
                                                
                                                
                                            </div>
                                        </div>
                                    
                                </div>
                            </div>
                        </div>
                        <div class='right-content-panel' id='defense_panel'>
                            <div class='non-dashboard-section card col-12' style='margin-right:5px;' id='defensive_ranks_container_div'>
                                <div class='non-dashboard-section-header'>
                                    <div onclick='drill_down_header(this.id, 1);' id='defensive_ranks_label' route="|defensive_ranks" class='col-11-9 no-padding non-dashboard-label'>{{misc.data.display_name}}: Defense</div>
                                                
                                    <div class='col-1 right no-padding dashboard-tile-help-icon icon-visible mob' id='defensive_ranks_filtericon' style='margin-top:2px;'><img onclick='toggle_settings_bar("defensive-ranks-settings-bar");' class='icon-15 settings'  src="static/img/gray_Filter150.png" /></div>
                                    <div class='col-1 right no-padding dashboard-tile-help-icon icon-visible' style='margin-top:2px;'><img id='defensive_ranks_helpicon' class='icon-15' onclick="" src="static/img/Gray_Info150.png" /></div>
                                    <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='defensive_ranks_img' class='icon-15 toggle' onclick='toggle_tile_visibility("defensive_ranks");' src="static/img/Gray_Minus150.png" /></div>
                                            
                                                
                                    
                                </div>
                                <div class='non-dashboard-tile-content bigger visible' id='defensive_ranks_div'>
                                        <div class='no-padding'>
                                            <div class='mob no-padding' style=''>
                                                <div class='settings-bar rounded not-shown no-padding' id='defensive-ranks-settings-bar'>
                                                    <div class='' style='margin-bottom:25px;'>
                                                        <div class='no-padding col-12 flex'>
                                                            <div class='col-4 margin white'>
                                                                <div class='light col-12 no-padding'><span class=' no-padding font-15'>Metric</span></div>
                                                                <div id='defensive_ranks_stat_select_mob' class='stat-select'> </div>
                                                            </div>
                                                            <div class='col-4 margin white'>
                                                                <div class='light col-12 no-padding'><span class=' no-padding font-15'>Comparison</span></div>
                                                                <div class='col-12 flex no-padding' id='defensive_ranks_mob_peers'></div>
                                                                
                                                            </div>
                                                            <div class='col-4 margin white'>
                                                                <div class='light col-12 no-padding'><span class=' no-padding font-15'>Calculation</span></div>
                                                                <div class='col-12 flex no-padding' id='defensive_ranks_mob_calculation'></div>
                                                                
                                                            </div>
                                                        </div>
                                                        
                                                        <div class='margin white no-padding'>
                                                            <div class='light no-padding'><span class='font-15'>Filters</span></div>
                                                            <div id='defensive_ranks_filter_options_ranks_mob' class='block-flex filter-options'></div>
                                                        </div>
                                                        
                                                    
                                                    </div>
                                                </div>
                                                
                                            </div>
                                            <div class='flex no-padding'>
                                                <div class='col-8-12 non-dashboard-tile-section' id='defensive_ranks_graph_div' style=''>
                                                
                                                </div>
                                            
                                              
                                                <div class='col-2 dtop non-dashboard-tile-section' style=''>
                                                    <div class='col-12 no-padding'><span class='no-padding font-15 bold'>Select a Stat</span></div>
                                                    <div id='defensive_ranks_stat_tags_dtop' class='stat-tags'> </div>
                                                    <div class='no-padding centered'><span class='font-12'>- OR -</span></div>
                                                    <div id='defensive_ranks_stat_select_dtop' class='stat-select'> </div>
                                                    <div class='col-12 no-padding' style='padding-top:10px;'><span class='no-padding font-15 bold'>Calculation</span></div>
                                                    <div class='col-12 flex no-padding'>
                    
                                                    <div class='col-10 no-padding' style='padding-left:10px;'><span class='contents font-11'>Raw</span></div>
                                                    <div class='col-2 no-padding right'><input value='defensive_calculation_raw' type=radio name='radio1' class='defensive_calculation_radio' onclick='toggler(this);'></div>
                                                    </div>
                                                    <div class='col-12 flex no-padding'>
                    
                                                    <div class='col-10 no-padding' style='padding-left:10px;'><span class='contents font-11'>Adjusted</span></div>
                                                    <div class='col-2 no-padding right'><input value='defensive_calculation_adjusted'  class='defensive_calculation_radio' type=radio name='radio2' onclick='toggler(this);'></div>
                                                    </div>
                                                </div>
                                            
                                              
                                                <div class='col-2 dtop non-dashboard-tile-section'>
                                                    <div class='col-12 no-padding'><span class='no-padding font-15 bold'>Filter</span></div>
                                                    <div id='defensive_ranks_filter_options_dtop' class='filter-options'></div>
                                                    
                                                    {% if misc.data.conference_ID %}
                                                    <div class='col-12 no-padding' style='padding-top:10px;'><span class='no-padding font-15 bold'>Comparison</span></div>
                                                    <div class='col-12 flex no-padding'>
                    
                                                    <div class='col-10 no-padding' style='padding-left:5px;'><span class='contents font-11'>League-wide</span></div>
                                                    <div class='col-2 no-padding right'><input value='defensive_peers_league' type=radio name='radio3' class='defensive_peers_radio' onclick='toggler(this);'></div>
                                                    </div>
                                                    <div class='col-12 flex no-padding'>
                    
                                                    <div class='col-10 no-padding' style='padding-left:5px;'><span class='contents font-11'>Conference</span></div>
                                                    <div class='col-2 no-padding right'><input value='defensive_peers_conference' class='defensive_peers_radio' type=radio name='radio4' onclick='toggler(this);'></div>
                                                    </div>
                                                {% endif %}
                                                </div>
                                                
                                                
                                            </div>
                                        </div>
                                    
                                </div>
                            </div>
                        </div>
                        <div class='right-content-panel' id='faceoffs_panel'>
                            <div class='non-dashboard-section card col-12' style='margin-right:5px;' id='faceoffs_ranks_container_div'>
                                <div class='non-dashboard-section-header'>
                                    <div onclick='drill_down_header(this.id, 1);' id='faceoffs_ranks_label' route="|faceoffs_ranks_overview" class='col-11-10 no-padding non-dashboard-label'>{{misc.data.display_name}}: Faceoffs</div>
                                                
                                    <div class='col-1 right no-padding dashboard-tile-help-icon icon-visible' style='margin-top:2px;'><img id='faceoffs_ranks_helpicon' class='icon-15' onclick="" src="static/img/Gray_Info150.png" /></div>
                                    <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='faceoffs_ranks_img' class='icon-15 toggle' onclick='toggle_tile_visibility("faceoffs_ranks_overview");' src="static/img/Gray_Minus150.png" /></div>
                                            
                                                
                                    
                                </div>
                                <div class='non-dashboard-tile-content bigger visible' id='faceoffs_ranks_div'>
                                        <div class='no-padding'>
                                            <div class='mob no-padding' style=''>
                                                <div class='settings-bar rounded not-shown no-padding' id='faceoffs-ranks-settings-bar'>
                                                    <div class='' style='margin-bottom:25px;'>
                                                        <div class='no-padding col-12 flex'>
                                                            <div class='col-6 margin white'>
                                                                <div class='light col-12 no-padding'><span class=' no-padding font-15'>Comparison</span></div>
                                                                <div class='col-12 flex no-padding' id='faceoffs_ranks_mob_peers'></div>
                                                                
                                                            </div>
                                                            <div class='col-6 margin white'>
                                                                <div class='light col-12 no-padding'><span class=' no-padding font-15'>Calculation</span></div>
                                                                <div class='col-12 flex no-padding' id='faceoffs_ranks_mob_calculation'></div>
                                                                
                                                            </div>
                                                        </div>
                                                        
                                                        <div class='margin white no-padding'>
                                                            <div class='light no-padding'><span class='font-15'>Filters</span></div>
                                                            <div id='faceoffs_ranks_filter_options_ranks_mob' class='block-flex filter-options'></div>
                                                        </div>
                                                        
                                                    
                                                    </div>
                                                </div>
                                                
                                            </div>
                                            <div class='flex no-padding'>
                                                <div class='col-8-12 non-dashboard-tile-section' id='faceoffs_ranks_graph_div' style=''>
                                                
                                                </div>
                                            
                                              
                                                <div class='col-2 dtop non-dashboard-tile-section' style=''>
                                                    
                                                    <div class='col-12 no-padding'><span class='no-padding font-15 bold'>Calculation</span></div>
                                                    <div class='col-12 flex no-padding'>
                    
                                                    <div class='col-10 no-padding' style='padding-left:10px;'><span class='contents font-11'>Raw</span></div>
                                                    <div class='col-2 no-padding right'><input value='faceoffs_calculation_raw' type=radio name='radio13' class='faceoffs_calculation_radio' onclick='toggler(this);'></div>
                                                    </div>
                                                    <div class='col-12 flex no-padding'>
                    
                                                    <div class='col-10 no-padding' style='padding-left:10px;'><span class='contents font-11'>Adjusted</span></div>
                                                    <div class='col-2 no-padding right'><input value='faceoffs_calculation_adjusted'  class='faceoffs_calculation_radio' type=radio name='radio14' onclick='toggler(this);'></div>
                                                    </div>
                                                </div>
                                            
                                              
                                                <div class='col-2 dtop non-dashboard-tile-section'>
                                                    <div class='col-12 no-padding'><span class='no-padding font-15 bold'>Filter</span></div>
                                                    <div id='faceoffs_ranks_filter_options_dtop' class='filter-options'></div>
                                                    
                                                    {% if misc.data.conference_ID %}
                                                    <div class='col-12 no-padding' style='padding-top:10px;'><span class='no-padding font-15 bold'>Comparison</span></div>
                                                    <div class='col-12 flex no-padding'>
                    
                                                    <div class='col-10 no-padding' style='padding-left:5px;'><span class='contents font-11'>League-wide</span></div>
                                                    <div class='col-2 no-padding right'><input value='faceoffs_peers_league' type=radio name='radio15' class='faceoffs_peers_radio' onclick='toggler(this);'></div>
                                                    </div>
                                                    <div class='col-12 flex no-padding'>
                    
                                                    <div class='col-10 no-padding' style='padding-left:5px;'><span class='contents font-11'>Conference</span></div>
                                                    <div class='col-2 no-padding right'><input value='faceoffs_peers_conference' class='faceoffs_peers_radio' type=radio name='radio16' onclick='toggler(this);'></div>
                                                    </div>
                                                {% endif %}
                                                </div>
                                                
                                                
                                            </div>
                                        </div>
                                    </div>

                                </div>
                        </div>
                        <div class='right-content-panel' id='goalkeepers_panel'>
                            <div class='non-dashboard-section card col-12' style='margin-right:5px;' id='goalkeepers_ranks_container_div'>
                                <div class='non-dashboard-section-header'>
                                    <div onclick='drill_down_header(this.id, 1);' id='goalkeepers_ranks_label' route="|goalkeepers_ranks_overview" class='col-11-10 no-padding non-dashboard-label'>{{misc.data.display_name}}: Goalkeepers</div>
                                                
                                    <div class='col-1 right no-padding dashboard-tile-help-icon icon-visible' style='margin-top:2px;'><img id='goalkeepers_ranks_helpicon' class='icon-15' onclick="" src="static/img/Gray_Info150.png" /></div>
                                    <div class='col-1 mob right no-padding' style='margin-top:2px;'><img id='goalkeepers_ranks_img' class='icon-15 toggle' onclick='toggle_tile_visibility("goalkeepers_ranks_overview");' src="static/img/Gray_Minus150.png" /></div>
                                            
                                                
                                    
                                </div>
                                <div class='non-dashboard-tile-content bigger visible' id='goalkeepers_ranks_div'>
                                        <div class='no-padding'>
                                            <div class='mob no-padding' style=''>
                                                <div class='settings-bar rounded not-shown no-padding' id='goalkeepers-ranks-settings-bar'>
                                                    <div class='' style='margin-bottom:25px;'>
                                                        <div class='no-padding col-12 flex'>
                                                            <div class='col-6 margin white'>
                                                                <div class='light col-12 no-padding'><span class=' no-padding font-15'>Comparison</span></div>
                                                                <div class='col-12 flex no-padding' id='goalkeepers_ranks_mob_peers'></div>
                                                                
                                                            </div>
                                                            <div class='col-6 margin white'>
                                                                <div class='light col-12 no-padding'><span class=' no-padding font-15'>Calculation</span></div>
                                                                <div class='col-12 flex no-padding' id='goalkeepers_ranks_mob_calculation'></div>
                                                                
                                                            </div>
                                                        </div>
                                                        
                                                        <div class='margin white no-padding'>
                                                            <div class='light no-padding'><span class='font-15'>Filters</span></div>
                                                            <div id='goalkeepers_ranks_filter_options_ranks_mob' class='block-flex filter-options'></div>
                                                        </div>
                                                        
                                                    
                                                    </div>
                                                </div>
                                                
                                            </div>
                                            <div class='flex no-padding'>
                                                <div class='col-8-12 non-dashboard-tile-section' id='goalkeepers_ranks_graph_div' style=''>
                                                
                                                </div>
                                            
                                              
                                                <div class='col-2 dtop non-dashboard-tile-section' style=''>
                                                    
                                                    <div class='col-12 no-padding'><span class='no-padding font-15 bold'>Calculation</span></div>
                                                    <div class='col-12 flex no-padding'>
                    
                                                    <div class='col-10 no-padding' style='padding-left:10px;'><span class='contents font-11'>Raw</span></div>
                                                    <div class='col-2 no-padding right'><input value='goalkeepers_calculation_raw' type=radio name='radio19' class='goalkeepers_calculation_radio' onclick='toggler(this);'></div>
                                                    </div>
                                                    <div class='col-12 flex no-padding'>
                    
                                                    <div class='col-10 no-padding' style='padding-left:10px;'><span class='contents font-11'>Adjusted</span></div>
                                                    <div class='col-2 no-padding right'><input value='goalkeepers_calculation_adjusted'  class='goalkeepers_calculation_radio' type=radio name='radio20' onclick='toggler(this);'></div>
                                                    </div>
                                                </div>
                                            
                                              
                                                <div class='col-2 dtop non-dashboard-tile-section'>
                                                    <div class='col-12 no-padding'><span class='no-padding font-15 bold'>Filter</span></div>
                                                    <div id='goalkeepers_ranks_filter_options_dtop' class='filter-options'></div>
                                                    
                                                    {% if misc.data.conference_ID %}
                                                    <div class='col-12 no-padding' style='padding-top:10px;'><span class='no-padding font-15 bold'>Comparison</span></div>
                                                    <div class='col-12 flex no-padding'>
                    
                                                    <div class='col-10 no-padding' style='padding-left:5px;'><span class='contents font-11'>League-wide</span></div>
                                                    <div class='col-2 no-padding right'><input value='goalkeepers_peers_league' type=radio name='radio21' class='goalkeepers_peers_radio' onclick='toggler(this);'></div>
                                                    </div>
                                                    <div class='col-12 flex no-padding'>
                    
                                                    <div class='col-10 no-padding' style='padding-left:5px;'><span class='contents font-11'>Conference</span></div>
                                                    <div class='col-2 no-padding right'><input value='goalkeepers_peers_conference' class='goalkeepers_peers_radio' type=radio name='radio22' onclick='toggler(this);'></div>
                                                    </div>
                                                {% endif %}
                                                </div>
                                                
                                                
                                            </div>
                                        </div>
                                    </div>

                                </div>
                        </div>
                </div>
            </div>
            
        </div>
    

<script src="static/js/d3.v4.min.js"></script><script src="static/js/laxrefpro_graphing.js?dt=203"></script>
<script>
    var on_mobile = null;
    var console_log = []; var success = null;
    var time_log = JSON.parse({{misc.time_log|to_json2}});
    
    var single_stat = "<div class='col-12'><span class='lightish contents font-20'>[header]</span></div>";
    single_stat += "<div class='col-12 centered ' style='padding-top:65px;'><span class='tile-message font-18'>[stat]</span></div>";
    var misc = parse_misc({{misc|to_json2}});
    console_log.push({'msg': 'Loaded misc...'});
    var user_obj = {'settings': {{user_obj.settings|to_json2}}};
    console_log.push({'msg': 'Loaded user settings...'});
    //console.log(misc);
    var explanations = {{user_obj.explanations|to_json2}};
    
    var ranks_stat_tag = {'offense': "efficiency", 'defense': "efficiency", 'faceoffs': 'faceoff_win_rate', 'goalkeepers': 'save_pct'}; var filters = {'offense': [], 'defense': [], 'faceoffs': [], 'goalkeepers': []};
    var calc_specs = {'offense': null, 'defense': null, 'faceoffs': null, 'goalkeepers': null}
    filters.offense.options = [{'tag': 'WinProb', 'desc': 'Game Situation', 'choices': [{'desc': 'Garbage Time', 'val': 'NonCompetitive'}, {'desc': 'Competitive', 'val': 'Competitive'}]}];
    filters.defense.options = [{'tag': 'WinProb', 'desc': 'Game Situation', 'choices': [{'desc': 'Garbage Time', 'val': 'NonCompetitive'}, {'desc': 'Competitive', 'val': 'Competitive'}]}];
    filters.faceoffs.options = [{'tag': 'WinProb', 'desc': 'Game Situation', 'choices': [{'desc': 'Garbage Time', 'val': 'NonCompetitive'}, {'desc': 'Competitive', 'val': 'Competitive'}]}];
    filters.goalkeepers.options = [{'tag': 'WinProb', 'desc': 'Game Situation', 'choices': [{'desc': 'Garbage Time', 'val': 'NonCompetitive'}, {'desc': 'Competitive', 'val': 'Competitive'}]}];
    
    
    var default_settings = {};
    tmp_tags = {'offensive': 1, 'defensive': 1, 'faceoffs': 1, 'goalkeepers': 1}
    for(tmp in tmp_tags){
        if((tmp + '_ranks_calculation') in user_obj.settings){ default_settings[tmp + '_ranks_calculation'] = user_obj.settings[tmp + '_ranks_calculation'].val; }
        else{ default_settings[tmp + '_ranks_calculation'] = "raw"; }
        
        if((tmp + '_ranks_peers') in user_obj.settings){ default_settings[tmp + '_ranks_peers'] = user_obj.settings[tmp + '_ranks_peers'].val; }
        else{ default_settings[tmp + '_ranks_peers'] = "league"; }
    }
    /*if('defensive_ranks_calculation' in user_obj.settings){ default_settings.defensive_ranks_calculation = user_obj.settings.defensive_ranks_calculation.val; }
    else{ default_settings.defensive_ranks_calculation = "raw"; }
    
    if('defensive_ranks_peers' in user_obj.settings){ default_settings.defensive_ranks_peers = user_obj.settings.defensive_ranks_peers.val; }
    else{ default_settings.defensive_ranks_peers = "league"; }
    */
    
    for(k in filters){
        unit_desc = "";
        if(k == "offense"){ unit_desc = "offensive"; data_type = "offense"; }
        else if(k == "defense"){ unit_desc = "defensive"; data_type = "defense"; }
        else if(k == "faceoffs"){ unit_desc = "faceoffs"; data_type = "offense"; }
        else if(k == "goalkeepers"){ unit_desc = "goalkeepers"; data_type = "defense"; }

        calc_specs[k] = {'overlap_solved': 0, 'peers': default_settings[unit_desc + '_ranks_peers'], 'calculation': default_settings[unit_desc + '_ranks_calculation'], 'data_type': data_type, 'filters': [{'filter': null, 'includes': [null]}]};
        if('options' in filters[k]){
            for(var a = 0;a<filters[k].options.length;a++){
                for(var b = 0;b<filters[k].options[a].choices.length;b++){
                    filters[k].options[a].choices[b].selected = 1;
                }
            }
        }
    }
    console.log(calc_specs.faceoffs);
    console.log("Set true: input[value='faceoffs_calculation_" + calc_specs.faceoffs.calculation + "']");
    
    $("input[value='offensive_peers_" + calc_specs.offense.peers + "']").prop("checked", true);
    $("input[value='offensive_calculation_" + calc_specs.offense.calculation + "']").prop("checked", true);
    $("input[value='defensive_peers_" + calc_specs.defense.peers + "']").prop("checked", true);
    $("input[value='defensive_calculation_" + calc_specs.defense.calculation + "']").prop("checked", true);
    $("input[value='faceoffs_peers_" + calc_specs.faceoffs.peers + "']").prop("checked", true);
    $("input[value='faceoffs_calculation_" + calc_specs.faceoffs.calculation + "']").prop("checked", true);
    $("input[value='goalkeepers_peers_" + calc_specs.goalkeepers.peers + "']").prop("checked", true);
    $("input[value='goalkeepers_calculation_" + calc_specs.goalkeepers.calculation + "']").prop("checked", true);
    
    function toggle_rank_filter(id, s, checked){
        
        id_tokens = id.split("|");
        tokens = s.split("|");
        filter_list = tokens[0];
        tag = tokens[1];
        val = tokens[2];
        
        fltr = filters[id_tokens[0]].options.filter(d => d.tag == id_tokens[1])[0]
        
        for(var b = 0;b<fltr.choices.length;b++){
            if(val == fltr.choices[b].val){ fltr.choices[b].selected = (checked) ? 1: 0; }
        }
        
        filter_settings = []
        for(var a = 0;a<filters[id_tokens[0]].options.length;a++){
            all_selected = true;
            none_selected = true;
            f = {'filter': tag, 'includes': []}
            for(var b = 0;b<filters[id_tokens[0]].options[a].choices.length;b++){
                if(filters[id_tokens[0]].options[a].choices[b].selected){
                    none_selected = false;
                    f.includes.push(filters[id_tokens[0]].options[a].choices[b].val);
                }
                else{
                    all_selected = false;
                }
            }
            if(!none_selected && !all_selected){
                filter_settings.push(f);
            }
        }
        if(filter_settings.length == 0){
            filter_settings.push({'filter': null, 'includes': [null]});
        }
        

        
        calc_specs[id_tokens[0]].data_type = null;
        if(['offense', 'faceoffs'].indexOf(id_tokens[0]) > -1){ calc_specs[id_tokens[0]].data_type ="offense"; }
        else{ calc_specs[id_tokens[0]].data_type ="defense"; }
        calc_specs[id_tokens[0]].filters = filter_settings;
        
        if(id_tokens[0] == "offense"){ display_primary_unit("offense", "offensive_ranks"); }  
        if(id_tokens[0] == "defense"){ display_primary_unit("defense", "defensive_ranks"); } 
        if(id_tokens[0] == "faceoffs"){ display_faceoffs("faceoffs", "faceoffs_ranks"); }    
        if(id_tokens[0] == "goalkeepers"){ display_goalkeepers("goalkeepers", "goalkeepers_ranks"); }    
        if(id_tokens[0] == "roster"){ display_roster("roster", "roster"); }    
        
    }
    
    
    function calculate_ranks(raw_data, teams, data_keys, specs, tag){

        time_log.push({'tag': "calculate_ranks", 'start': new Date().getTime()});
        
        data = JSON.parse(JSON.stringify(raw_data));
        data = data.filter(r => r.data_type == specs.data_type);

        for(var a = 0;a<specs.filters.length;a++){
            var flt = specs.filters[a];
            data = data.filter(r => r.filter == flt.filter && flt.includes.indexOf(r.filter_val) > -1);
        }
        
        stat_key = misc.data.ranks.stat_keys.filter( r => r.tag == tag)[0];
        adj_tag = 'adj_' + stat_key.tag
        adj = (specs.calculation == "raw") ? 0 : 1;
        game_results = [];
        adj_game_results = [];
        
        for(var a = 0;a<teams.length;a++){
            team = teams[a];
            team.radius = 10;
            team_data = data.filter(r => r.team_ID == team.ID);
            if(team.ID == 62){  console.log(team_data);   }
            sum = 0.0; n = 0.0;
            if(stat_key.calc.operation == "divide"){
                sum1 = 0.0; sum2 = 0.0; adj_val = 0.0;
                if('val3' in stat_key.calc){
                    for(var b = 0;b<team_data.length;b++){ r = team_data[b];
                        sum1 += r[stat_key.calc.val1]; sum2 += r[stat_key.calc.val2] + r[stat_key.calc.val3];
                        if(adj_tag in r){ 
                            adj_val += (r[stat_key.calc.val2] + r[stat_key.calc.val3]) * r[adj_tag]; 
                        }
                        
                        if(misc.data.ID == team.ID){
                            game_val = (r[stat_key.calc.val2] + r[stat_key.calc.val3] > 0) ?  r[stat_key.calc.val1]/(r[stat_key.calc.val2] + r[stat_key.calc.val3]) : null;
                            game_results.push({'x': game_results.length + 1, 'y': game_val});
                            
                            if(adj_tag in r){ 
                                adj_game_val = game_val + r[adj_tag]; 
                                adj_game_results.push({'x': adj_game_results.length + 1, 'y': adj_game_val});
                            }
                            
                        }
                    }
                }
                else{
                    for(var b = 0;b<team_data.length;b++){ r = team_data[b];
                        sum1 += r[stat_key.calc.val1]; sum2 += r[stat_key.calc.val2];
                        if(adj_tag in r){ adj_val += r[stat_key.calc.val2] * r[adj_tag];  }
                        
                        
                        if(misc.data.ID == team.ID){
                            game_val = (r[stat_key.calc.val2] > 0) ? r[stat_key.calc.val1]/(r[stat_key.calc.val2]) : null;
                            game_results.push({'x': game_results.length + 1, 'y': game_val});
                            
               
                            if(adj_tag in r){ 
                                adj_game_val = game_val + r[adj_tag]; 
                                adj_game_results.push({'x': adj_game_results.length + 1, 'y': adj_game_val});
                            }
                        }
                    }
                }
                
                if(adj){
                    //if(misc.data.ID==team.ID){ console.log("Final", adj_val, sum1,  sum2, ((adj_val + sum1) / sum2)); }
                    val = (sum2 > 0) ? ((adj_val + sum1) / sum2) : null;
                }
                else{
                    val = (sum2 > 0) ? (sum1 / sum2) : null;
                }
            }
            if(stat_key.calc.operation == "weighted"){
                sum1 = 0.0; sum2 = 0.0; adj_val = 0.0;
                for(var b = 0;b<team_data.length;b++){ r = team_data[b];
                    sum1 += r[stat_key.calc.val1] * r[stat_key.calc.val2]; sum2 += r[stat_key.calc.val2];
                    if(adj_tag in r){ adj_val += r[adj_tag]; }
                    
                    game_val = r[stat_key.calc.val1];
                    if(misc.data.ID == team.ID){ 
                        game_results.push({'x': game_results.length + 1, 'y': game_val}); 
                    
                        if(adj_tag in r){ 
                            adj += r[adj_tag];
                            adj_game_val = game_val + r[adj_tag]; 
                            adj_game_results.push({'x': adj_game_results.length + 1, 'y': adj_game_val});
                        }
                    }
                }
                
                if(adj){
                    val = (sum2 > 0) ? ((adj_val + sum1) / sum2) : null;
                
                }
                else{
                    val = (sum2 > 0) ? (sum1 / sum2) : null;
                }
            }
            if(stat_key.calc.operation == "average"){
                sum1 = 0.0; sum2 = 0.0; adj_val = 0.0;
                for(var b = 0;b<team_data.length;b++){ r = team_data[b];
                    sum1 += r[tag]; sum2 += 1.0;
                    if(adj_tag in r){ adj_val += r[adj_tag]; }
                    
                    game_val = r[tag];
                    if(misc.data.ID == team.ID){ 
                        game_results.push({'x': game_results.length + 1, 'y': game_val}); 
                    
                        if(adj_tag in r){ 
                            adj_game_val = game_val + r[adj_tag]; 
                            adj_game_results.push({'x': adj_game_results.length + 1, 'y': adj_game_val});
                        }
                    }
                }
                
                if(adj){
                    val = (sum2 > 0) ? ((adj_val + sum1) / sum2) : null;
                }
                else{
                    val = (sum2 > 0) ? (sum1 / sum2) : null;
                }
            }
            
            val_str = "N/A";
            if(val != null){ val_str = jsformat(val, stat_key.jsfmt) }
            team.rank = {'display': team.display_name, 'short_code': team.short_code, 'highlight': (misc.data.ID == team.ID) ? 1 : 0, 'conference_ID': team.conference_ID, 'radius': team.radius, 'x': val, 'team_ID': team.ID, 'val': val, 'val_str': val_str};
        }
        
        min_val = null; max_val = null; 
        for(var a = 0;a<teams.length;a++){
            team = teams[a];
            if(team.rank.val != null){
                if(["offense", "faceoffs"].indexOf(specs.data_type) > -1){
                    if(stat_key.reverse == 0){
                        team.rank.rank = teams.filter( r => r.rank.val != null && r.rank.val < team.rank.val ).length + 1;
                        team.rank.conf_rank = teams.filter( r => team.conference_ID==r.conference_ID && r.rank.val != null && r.rank.val < team.rank.val ).length + 1;
                    }
                    else{
                        team.rank.rank = teams.filter( r => r.rank.val != null && r.rank.val > team.rank.val ).length + 1;
                        team.rank.conf_rank = teams.filter( r => team.conference_ID==r.conference_ID && r.rank.val != null && r.rank.val > team.rank.val ).length + 1;
                    }
                }
                else if(["defense", "goalkeepers"].indexOf(specs.data_type) > -1){
                    if(stat_key.reverse == 0){
                        team.rank.rank = teams.filter( r => r.rank.val != null && r.rank.val > team.rank.val ).length + 1;
                        team.rank.conf_rank = teams.filter( r => team.conference_ID==r.conference_ID && r.rank.val != null && r.rank.val > team.rank.val ).length + 1;
                    }
                    else{
                        team.rank.rank = teams.filter( r => r.rank.val != null && r.rank.val < team.rank.val ).length + 1;
                        team.rank.conf_rank = teams.filter( r => team.conference_ID==r.conference_ID && r.rank.val != null && r.rank.val < team.rank.val ).length + 1;
                    }
                }
                if(min_val == null || team.rank.val < min_val){ min_val = team.rank.val; }
                if(max_val == null || team.rank.val > max_val){ max_val = team.rank.val; }
            }
            else{ team.rank.rank = "N/A"; team.rank.conf_rank = "N/A"; }
            
            
        }
        
        teams.sort(function(first, second) {
            if(stat_key.reverse){
                return !(second.rank.val - first.rank.val);
            }
            else{
                return second.rank.val - first.rank.val;
            }
        });
        
        var me = teams.filter(r => misc.data.ID == r.ID)[0];
        me_str = me.display_name + ": " + jsformat(me.rank.val, stat_key.jsfmt ) + " (rank: " + add_suffix(me.rank.rank) + ")";
        me_conf_str = me.display_name + ": " + jsformat(me.rank.val, stat_key.jsfmt ) + " (conf. rank: " + add_suffix(me.rank.conf_rank) + ")";
        me_mob_str = me.short_code + ": " + jsformat(me.rank.val, stat_key.jsfmt ) + " (rank: " + me.rank.rank + ")";
        me_mob_conf_str = me.short_code + ": " + jsformat(me.rank.val, stat_key.jsfmt ) + " (conf. rank: " + me.rank.conf_rank + ")";
        diff = max_val - min_val; inc = diff / stat_key.nbuckets;
        
        var buckets = [];
        for(var a = 0;a<stat_key.nbuckets;a++){
            var bucket = {'x': a, 'min_x': min_val + a*inc, 'max_x': min_val + (a+1)*inc, 'label': jsformat((min_val + (a+.5)*inc), stat_key.bucket_fmt )};
            //console.log((min_val + a*inc), stat_key.jsfmt , jsformat((min_val + a*inc), stat_key.jsfmt ));
            
            if(a < stat_key.nbuckets - 1){ 
                bucket.y = teams.filter(r => bucket.min_x <= r.rank.val && bucket.max_x > r.rank.val).length;
                bucket.highlight = bucket.min_x <= me.rank.val && bucket.max_x > me.rank.val ? 1 : 0;
            }
            else{
                bucket.y = teams.filter(r => bucket.min_x <= r.rank.val && bucket.max_x >= r.rank.val).length;
                bucket.highlight = bucket.min_x <= me.rank.val && bucket.max_x >= me.rank.val ? 1 : 0;
            }
            
            buckets.push(bucket);
        }
        
        
        time_log[time_log.length-1].end = new Date().getTime();
        var team_ranks = []
        for(var a = 0;a<teams.length;a++){
            team_ranks.push(teams[a].rank);
        }
        for(var a = 0;a<game_results.length;a++){
            if(game_results.length > 10){
                if(a % 2 == 0){ game_results[a].label = a+1; }
            }
            else{
                game_results[a].label = a+1;
            }
        }
        
        return {'buckets': buckets, 'teams': team_ranks, 'me_str': me_str, 'me_conf_str': me_conf_str, 'me_mob_str': me_mob_str, 'me_mob_conf_str': me_mob_conf_str, 'game_results': game_results, 'adj_game_results': adj_game_results};
    }
    function click_tag(panel, tag){ 
        console.log(panel, tag);
        if(panel == "offense"){ ranks_stat_tag[panel] = tag; display_primary_unit(panel, panel); }
        if(panel == "defense"){ ranks_stat_tag[panel] = tag; display_primary_unit(panel, panel); }
    }
     
    
    
    function display_schedule(panel){ 
        if([null, 'schedule', '', '', ''].indexOf(panel) == -1){ return; }
    
        id = 'schedule_overview'; success = false;
        try{
            // Data
            console.log("misc.data.season_games")
            console.log(misc.data.season_games)
            gms = misc.data.season_games.sort(function(first, second) {
                    return first.game_epoch - second.game_epoch;
            });
            
            
            // Visualization
            elem = $("#" + id + "_div"); elem.empty();
            for(var a = 0;a<gms.length;a++){
                gm = gms[a];
                gm.class = gm.status.indexOf("complete") > -1 ? "complete":"scheduled";
                gm.summary_detail1 = gm.class == "complete" ? gm.score_str_html : (gm.opp_short_code + " Rankings - " + gm.opp_rankings_summary_str);
                
                gm.seq = a;
            }
            
            for(var a = 0;a<gms.length;a++){
                gm = gms[a];
                html = "";
                html += "<div class='schedule-game " + gm.class + "'>";

                    // Summary
                    html += "<div class='flex' id='game" + gm.seq + "_summary'>";
                    
                        // Date
                        html += "<div class='col-1'>";
                        if(gm.class == "complete"){
                            html += "<FORM id='schedule_game_form" + gm.seq + "' action='/team_game_detail' method=POST><input type=hidden name='ID' value='" + gm.ID + "'><input type=hidden name='came_from' value='{{misc.came_from}}' />";
                            html += "<span class='mouseover-link pointer font-15' onclick=\"document.getElementById('schedule_game_form" + gm.seq + "').submit();\">" + gm.date_mmmdd + "</span>";
                            html += "</FORM>";
                        }
                        else{
                            html += "<span class='font-15'>" + gm.date_mmmdd + "</span>";
                        }   
                        html += "</div>";
                    
                        // Opponent    
                        html += "<div class='col-3'>";
                        html += "<FORM id='schedule_opp_form" + gm.seq + "' action='/team_detail' style='padding: 0px 5px;' method=POST><input type=hidden name='detail_team_ID' value='" + gm.opponentID + "'><input type=hidden name='came_from' value='{{misc.came_from}}' /><span class='mouseover-link pointer font-15 contents' onclick=\"document.getElementById('schedule_opp_form" + gm.seq + "').submit();\">" + gm.opponent_display + "</span></FORM>";
                        html += "</div>";
                    
                        // Result    
                        html += "<div class='col-7'>";
                        html += "<span class='font-15'>" + (gm.class=="complete" ? gm.summary_detail1 : "") + "</span>";
                        html += "</div>";
                    
                    
                        // Expand    
                        html += "<div class='col-1 right'>";
                        html += "<!--img id='game" + gm.seq + "_imgicon' class='icon-15 row-toggle' onclick='expand_game(" + gm.seq + ");' src='static/img/Gray_Plus_Skinny150.png' /-->";
                        html += "</div>";
                    
                    html += "</div>";
                    
                    
                    // Expansion
                    html += "<div class='no-padding expanded' id='game" + gm.seq + "_expansion'>";
                    
                        // Date
                        html += "<div class='col-1'>";
                        html += "<span class='font-15'>" + gm.date_mmmdd + "</span>";
                        html += "</div>";
                    
                        // Opponent    
                        html += "<div class='col-3'>";
                        html += "<span class='font-15'>" + gm.opponent_display + "</span>";
                        html += "</div>";
                    
                        
                    html += "</div>";
                
                html += "</div>";
                elem.append(html);
            }
            
            // Mark Complete
            success = true;
        }
        catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
        
        if(!success){
            $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
            report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
        }
    }
    
    function display_roster(panel){ 
        if([null, 'roster', '', '', ''].indexOf(panel) == -1){ return; }
    
        id = 'roster_overview'; success = false;
        try{
            
            // Data
            console.log("misc.data.roster");
            roster = misc.data.roster;
            console.log(roster);
       
            display_roster_list("roster_overview_div", roster)
            
            // Mark Complete
            success = true;
        }
        catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
        
        if(!success){
            $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
            report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
        }
    }
    
    var laxelo_dates = []
    function process_laxelo_history(misc){
        raw = misc.extra_data.all_teams_laxelo_history;
        start_x = misc.laxelo_movement_start_date;
        
        time_log.push({'tag': "process_laxelo_history", 'start': new Date().getTime()});
        var history = [];
        var change_history = [];
        var conf_ID = null;
        var team_entry = null;
        var conf = {'add': 1, 'stroke': "maroon", 'stroke-dasharray': null, 'stroke-width': 1, 't': {'display_name': 'Conf Avg'}, 'n': 0.0};
        var rows = []
        for(var a = 0;a<raw.length;a++){
            var row = JSON.parse(JSON.stringify(raw[a]));
            row.add = 0; row.team = 0;
            
            row.conf_agg = false;
            tokens = row.t.split("|")
                
            row.t = {'years': [], 'change_years': [], 'team_ID': parseInt(tokens[0]), 'conf_ID': parseInt(tokens[1]), 'display_name': tokens[2]}
            years = row.d.split("*");
            for(var b = 0;b<years.length;b++){
                yr = {};
                year_value = parseInt(years[b].substring(0,4));
                yr.points = years[b].substring(4).split("~");
                for(var c = 0;c<yr.points.length;c++){
                    tokens = yr.points[c].split("|")
                    yr.points[c] = {'label': tokens[0], 'x': parseInt(tokens[1]), 'y': parseInt(tokens[2]), 'dt': parseInt(tokens[3])};
                    //if(row.t.team_ID == 1){ console.log(  yr.points[c].dt , start_x, yr.points[c].dt == start_x ); }
                    if(yr.points[c].dt == start_x){
                        row.start_y = yr.points[c].y;
                    }
                }
                row.t.years.push(yr);
            }
            for(var b = 0;b<years.length;b++){
                change_yr = {};
                year_value = parseInt(years[b].substring(0,4));
                change_yr.points = years[b].substring(4).split("~");
                for(var c = 0;c<change_yr.points.length;c++){
                    tokens = change_yr.points[c].split("|")
                    change_yr.points[c] = {'label': tokens[0], 'x': parseInt(tokens[1]), 'y': (parseInt(tokens[2])/row.start_y)* 100.0, 'dt': parseInt(tokens[3])};
                }
                change_yr.points = change_yr.points.filter( d => d.dt >= start_x);
                row.t.change_years.push(change_yr);
            }
            //console.log(row.t.team_ID == misc.data.ID, row.t.team_ID, misc.data.ID);
            if(row.t.team_ID == misc.data.ID){
                row['stroke'] = "#77F"; row['stroke-dasharray'] = null; row['stroke-width'] = 2;                    
                conf_ID = row.t.conf_ID;
                conf.n = 1.0;
                conf.t.years = JSON.parse(JSON.stringify(row.t.years));
                conf.t.change_years = JSON.parse(JSON.stringify(row.t.change_years));
                row.team = 1;
                team_entry = row;
                
            }
            rows.push(row);
        }
        
        
        for(var a = 0;a<rows.length;a++){
            var row = rows[a];
            if(row.t.team_ID != misc.data.ID && row.t.conf_ID == conf_ID){
                row.stroke = "#DDD"; row['stroke-width'] = 1; row['stroke-dasharray'] = null; row.add = 1;
                //history.push(row)
                conf.n += 1.0;
                
                for(var c = 0;c<conf.t.years.length;c++){
                    for(var b = 0;b<conf.t.years[c].points.length;b++){
                        conf.t.years[c].points[b].y += row.t.years[c].points[b].y;
                    }
                }
                for(var c = 0;c<conf.t.change_years.length;c++){
                    for(var b = 0;b<conf.t.change_years[c].points.length;b++){
                        conf.t.change_years[c].points[b].y += row.t.change_years[c].points[b].y;
                    }
                }
            }
        }
        for(var c = 0;c<conf.t.years.length;c++){
            for(var b = 0;b<conf.t.years[c].points.length;b++){
                conf.t.years[c].points[b].y /= conf.n;
            }
        }
        for(var c = 0;c<conf.t.change_years.length;c++){
            for(var b = 0;b<conf.t.change_years[c].points.length;b++){
                conf.t.change_years[c].points[b].y /= conf.n;
            }
        }
        rows.push(conf);
        for(var a = 0;a<rows.length;a++){
            var row = rows[a];
            if(row.add){
                for(var b = 0;b<row.t.years.length;b++){
                    yr = row.t.years[b];
                    d = {'stroke': row.stroke, 'stroke-width': row['stroke-width'], 'stroke-dasharray': row['stroke-dasharray'], 'display_name': row.display_name, 'points': yr.points}
                    history.push(d);
                    
                    change_yr = row.t.change_years[b];
                    change_d = {'stroke': row.stroke, 'stroke-width': row['stroke-width'], 'stroke-dasharray': row['stroke-dasharray'], 'display_name': row.display_name, 'points': change_yr.points}
                    change_history.push(change_d);
                }
            }
        }
        for(var a = 0;a<rows.length;a++){
            var row = rows[a];
            if(row.team){
                for(var b = 0;b<row.t.years.length;b++){
                    yr = row.t.years[b];
                    d = {'stroke': row.stroke, 'stroke-width': row['stroke-width'], 'stroke-dasharray': row['stroke-dasharray'], 'display_name': row.display_name, 'points': yr.points}
                    history.push(d);
                    
                    change_yr = row.t.change_years[b];
                    change_d = {'stroke': row.stroke, 'stroke-width': row['stroke-width'], 'stroke-dasharray': row['stroke-dasharray'], 'display_name': row.display_name, 'points': change_yr.points}
                    change_history.push(change_d);
                }
            }
        }
        
        time_log[time_log.length-1].end = new Date().getTime();
        misc.all_teams_laxelo_history = history;
        misc.all_teams_laxelo_change_history = change_history;
        return misc;
    }
    
    
    function display_rankings(panel){ 
        if([null, 'rankings', '', '', ''].indexOf(panel) == -1){ return; }
    
        id = 'rankings_overview_div'; success = false;
        try{
            // Data
            
            misc = process_laxelo_history(misc);
            data = {'axis_labels': {'y': 'Lax-ELO Rating', 'x': ''}, 'data': []};
            data.data = misc.all_teams_laxelo_history;

            // Visualization
            specs = {'margin_bottom': 40, 'chart_size': 'small', 'flip': 0};
            x_ticks = create_game_x_ticks(data.data);
            data['x_ticks'] = x_ticks.ticks; data['max_x'] = x_ticks.max; data['min_x'] = x_ticks.min;
            
            for(var a = 0;a<misc.all_teams_laxelo_history.length;a++){
                var tmp_data = data.data[a];
                
                for(var c = 0;c<tmp_data.points.length;c++){
                    pt = tmp_data.points[c];
                    if(laxelo_dates.indexOf(pt.dt) == -1){
                        laxelo_dates.push(pt.dt);
                    }
                    
                }
            }
        
            laxelo_dates = laxelo_dates.sort(function(first, second) {
                    return first - second;
            });
            var slider_start = null;
            for(var a = 0;a<laxelo_dates.length;a++){
                
                if(laxelo_dates[a] >= misc.laxelo_movement_start_date){
                    
                    slider_start = a/laxelo_dates.length;
                    break;
                }
            }
            if(slider_start == null){ slider_start = 1; }
            
            
            y_ticks = create_numeric_y_ticks(data.data)
            
            data['y_ticks'] = y_ticks.ticks;
            data['max_y'] = y_ticks.max;  data['min_y'] = y_ticks.min;
            
            specs.width = $('#rankings_overview_container_div').width() - 20;
            specs.height = 300;
            data['legend'] = {'items': [], 'layout': 'horizontal'}
            data.legend.items.push({'stroke-dasharray': null, 'icon_type': 'line', 'stroke-width': 2, 'color': '#88F', 'label': misc.data.display_name + ' Rating'})
            data.legend.items.push({'stroke-dasharray': null, 'icon_type': 'line', 'stroke-width': 2, 'color': 'maroon', 'label': 'Conf Avg.'})
            data.legend.items.push({'stroke-dasharray': null, 'icon_type': 'line', 'stroke-width': 2, 'color': '#DDD', 'label': 'Conf Team'}) 
            
            console.log(data)
            horizontal_line(data, id, specs);
            
            // Mark Complete
            success = true;
        }
        catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
        
        if(!success){
            $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
            report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
        }
    }
    
    function display_primary_unit(unit, panel){ 
        unit_desc = (unit=="offense") ? "offensive" : "defensive";
        if([null, unit, unit_desc + '_ranks', unit_desc + '_movement', unit_desc + '_profile', ''].indexOf(panel) == -1){ return; }
        
        id = unit_desc + '_ranks'; success = false;
        ranks = calculate_ranks(misc.extra_data.db_team_game_summaries, misc.extra_data.db_teams, misc.data.ranks.keys, calc_specs[unit], ranks_stat_tag[unit]);
        
        id = ''; success = false;
        try{
            // Data
            stat_key = misc.data.ranks.stat_keys.filter( r => r.tag == ranks_stat_tag[unit])[0];
        
    
            /* visualization */
            if(calc_specs[unit].peers == "league"){
                specs = {'highlight': 1, 'margin_left': 25, 'chart_size': 'bigger', 'flip': 0};
            
                data = {'axis_labels': {'y': 'Number of teams grouped by ' + stat_key.desc, 'x': stat_key.desc}, 'data': []};
                tmp = {'stroke-dasharray': '3-3', 'stroke': "#666", 'points': []}

                tmp.points = ranks.buckets;
                data.data.push(tmp)
                
                x_ticks = create_game_x_ticks(data.data);
                data['x_ticks'] = x_ticks.ticks; data['max_x'] = x_ticks.max; data['min_x'] = x_ticks.min;
                y_ticks = create_numeric_y_ticks(data.data)
                data['y_ticks'] = y_ticks.ticks;
                data['max_y'] = y_ticks.max;  data['min_y'] = 0;
                if(on_mobile){
                    specs.width = $('#' + unit_desc + '_ranks_container_div').width()-20;
                }
                else{
                    specs.width = $('#' + unit_desc + '_ranks_container_div').width()*.66667-20;
                }
                data.text = [{'x': specs.width-35, 'y': on_mobile ? 15 : -15, 'align': 'end', 'text': on_mobile ? ranks.me_mob_str : ranks.me_str}];
                
                data['legend'] = {'items': [], 'layout': 'horizontal'}
                data.legend.items.push({'icon_type': 'rect', 'fill': 'orange', 'label': misc.data.short_code + " Bucket"})
                
                vertical_bars(data, unit_desc + '_ranks_graph_div', specs);
            }
            else{ // Show the conference line bubbles
                specs = {'highlight': 1, 'margin_left': 60, 'margin-right': 60, 'chart_size': 'bigger', 'flip': 0};
            
                data = {'show-data-labels': 'short_code', 'axis_labels': {'y': 'Conf teams; axis = ' + stat_key.desc, 'x': stat_key.desc}, 'data': []};
                tmp = {'stroke-dasharray': '3-3', 'stroke': "#666", 'points': []}
                tmp.points = ranks.teams.filter(r => r.conference_ID == misc.data.conference_ID);
                data.data.push(tmp)
                
                x_ticks = create_game_x_ticks(data.data);
                data['x_ticks'] = x_ticks.ticks; data['max_x'] = x_ticks.max; data['min_x'] = x_ticks.min;
                y_ticks = create_numeric_y_ticks(data.data)
                data['y_ticks'] = y_ticks.ticks;
                data['max_y'] = y_ticks.max;  data['min_y'] = 0;
                if(on_mobile){
                    specs.width = $('#' + unit_desc + '_ranks_container_div').width()-20;
                }
                else{
                    specs.width = $('#' + unit_desc + '_ranks_container_div').width()*.66667-20;
                }
                data.text = [{'x': specs.width-65, 'y': on_mobile ? 15 : -15, 'align': 'end', 'text': on_mobile ? ranks.me_mob_conf_str : ranks.me_conf_str}];
                
                data['legend'] = {'items': [], 'layout': 'horizontal'}
                data.legend.items.push({'icon_type': 'rect', 'fill': 'orange', 'label': misc.data.short_code + " Bucket"})
                
                horizontal_trainmap(data, unit_desc + '_ranks_graph_div', specs);
                
            }
            // Add the stat labels
            
            stat_tags_ranks = $("#" + unit_desc + "_ranks_stat_tags_dtop"); stat_tags_ranks.empty();
            stat_tags_movement = $("#" + unit_desc + "_movement_stat_tags_dtop"); stat_tags_movement.empty();
            html = "";
            
            misc.data.ranks.stat_keys.sort(function(first, second) {
                return !(second.seq - first.seq);
            });
            
            filtered_stats = misc.data.ranks.stat_keys.filter(r => !('exclude' in r) || r.exclude.indexOf(unit) == -1);
            
            subset = filtered_stats.slice(0,6);
            active_tag = false;
            for(var a = 0 ;a<subset.length;a++){
                var key = subset[a];
                
                html += "<div onclick='click_tag(\"" + unit + "\", \"" + key.tag + "\");' class='tag" + ((key.tag == ranks_stat_tag[unit]) ? " active" : "") + "'>";
                html += "<span class='no-padding font-11'>" + key.short + "</span>";
                html += "</div>"
                if(key.tag == ranks_stat_tag[unit]){ active_tag = true; }
            }
            stat_tags_ranks.append(html); stat_tags_movement.append(html);
            
            
            stat_select_ranks_dtop = $("#" + unit_desc + "_ranks_stat_select_dtop"); stat_select_ranks_dtop.empty();
            stat_select_ranks_mob = $("#" + unit_desc + "_ranks_stat_select_mob"); stat_select_ranks_mob.empty();
            stat_select_movement_dtop = $("#" + unit_desc + "_movement_stat_select_dtop"); stat_select_movement_dtop.empty();
            stat_select_movement_mob = $("#" + unit_desc + "_movement_stat_select_mob"); stat_select_movement_mob.empty();
            
            
            html = "";
            html += "<select onchange='click_tag(\"" + unit + "\",this.value);' class='stat-select font-12'>";
            html += "<option ></option>";
            
            for(var a = 0 ;a<filtered_stats.length;a++){
                var key = filtered_stats[a];
                html += "<option " + ((key.tag == ranks_stat_tag[unit] && (on_mobile || !active_tag)) ? " selected" : "") + " value='" + key.tag + "'>" + key.display + "</option>";
            }
            html += "</select>";
            stat_select_ranks_dtop.append(html); stat_select_ranks_mob.append(html);
            stat_select_movement_dtop.append(html); stat_select_movement_mob.append(html);
            
            filter_options_ranks_dtop = $("#" + unit_desc + "_ranks_filter_options_dtop"); filter_options_ranks_dtop.empty();
            filter_options_ranks_mob = $("#" + unit_desc + "_ranks_filter_options_ranks_mob"); filter_options_ranks_mob.empty();
            filter_options_movement_dtop = $("#" + unit_desc + "_movement_filter_options_dtop"); filter_options_movement_dtop.empty();
            filter_options_movement_mob = $("#" + unit_desc + "_movement_filter_options_movement_mob"); filter_options_movement_mob.empty();
           
            
            
            for(var a = 0 ;a<filters[unit].options.length;a++){
                var fltr = filters[unit].options[a];
                html = "";
                html += "<div class='col-12-4 no-padding'>";
                html += "<div class='col-12 no-padding'><span class=' font-11 light'>" + fltr.desc + "</span></div>";
                
                for(var b = 0;b<fltr.choices.length;b++){
                    choice = fltr.choices[b];
                    html += "<div class='flex no-padding'>";
                    
                    html += "<div class='col-10 no-padding' style='padding-left:10px;'><span class='no-padding font-11'>" + choice.desc + "</span></div>";
                    html += "<div class='col-2 no-padding'><input id=\'" + [unit, fltr.tag].join("|") + "' " + (choice.selected ? " checked" : "") + " value='" + [unit, fltr.tag, choice.val].join("|") + "' type=checkbox onclick='toggle_rank_filter(this.id, this.value, this.checked);'></div>";
                    html += "</div>";
                    
                    
                }
                html += "</div>";
                filter_options_ranks_dtop.append(html); filter_options_ranks_mob.append(html);
                filter_options_movement_dtop.append(html); filter_options_movement_mob.append(html);
            }
            
            
            // Mark Complete
            success = true;
        }
        catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
        
        if(!success){
            $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
            report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
        }
    }
    
    function display_faceoffs(panel){
        unit = "faceoffs"; unit_desc = unit;
        if([null, 'faceoffs', '', '', '', ''].indexOf(panel) == -1){ return; }

        id = 'faceoff_ranks'; success = false;
 
        ranks = calculate_ranks(misc.extra_data.db_team_game_summaries, misc.extra_data.db_teams, misc.data.ranks.keys, calc_specs[unit], ranks_stat_tag[unit]);

        try{
            /* data */
            stat_key = misc.data.ranks.stat_keys.filter( r => r.tag == ranks_stat_tag[unit])[0];
       
                
            /* visualization */
            if(calc_specs[unit].peers == "league"){
                specs = {'highlight': 1, 'margin_left': 25, 'chart_size': 'bigger', 'flip': 0};
            
                data = {'axis_labels': {'y': 'Number of teams grouped by ' + stat_key.desc, 'x': stat_key.desc}, 'data': []};
                tmp = {'stroke-dasharray': '3-3', 'stroke': "#666", 'points': []}

                tmp.points = ranks.buckets;
                data.data.push(tmp)
                
                x_ticks = create_game_x_ticks(data.data);
                data['x_ticks'] = x_ticks.ticks; data['max_x'] = x_ticks.max; data['min_x'] = x_ticks.min;
                y_ticks = create_numeric_y_ticks(data.data)
                data['y_ticks'] = y_ticks.ticks;
                data['max_y'] = y_ticks.max;  data['min_y'] = 0;
                if(on_mobile){
                    specs.width = $('#' + unit_desc + '_ranks_container_div').width()-20;
                }
                else{
                    specs.width = $('#' + unit_desc + '_ranks_container_div').width()*.66667-20;
                }
                data.text = [{'x': specs.width-35, 'y': on_mobile ? 15 : -15, 'align': 'end', 'text': on_mobile ? ranks.me_mob_str : ranks.me_str}];
                
                data['legend'] = {'items': [], 'layout': 'horizontal'}
                data.legend.items.push({'icon_type': 'rect', 'fill': 'orange', 'label': misc.data.short_code + " Bucket"})
                
                vertical_bars(data, unit_desc + '_ranks_graph_div', specs);
            }
            else{ // Show the conference line bubbles
                specs = {'highlight': 1, 'margin_left': 60, 'margin-right': 60, 'chart_size': 'bigger', 'flip': 0};
            
                data = {'show-data-labels': 'short_code', 'axis_labels': {'y': 'Conf teams; axis = ' + stat_key.desc, 'x': stat_key.desc}, 'data': []};
                tmp = {'stroke-dasharray': '3-3', 'stroke': "#666", 'points': []}
                tmp.points = ranks.teams.filter(r => r.conference_ID == misc.data.conference_ID);
                data.data.push(tmp)
                
                x_ticks = create_game_x_ticks(data.data);
                data['x_ticks'] = x_ticks.ticks; data['max_x'] = x_ticks.max; data['min_x'] = x_ticks.min;
                y_ticks = create_numeric_y_ticks(data.data)
                data['y_ticks'] = y_ticks.ticks;
                data['max_y'] = y_ticks.max;  data['min_y'] = 0;
                if(on_mobile){
                    specs.width = $('#' + unit_desc + '_ranks_container_div').width()-20;
                }
                else{
                    specs.width = $('#' + unit_desc + '_ranks_container_div').width()*.66667-20;
                }
                data.text = [{'x': specs.width-65, 'y': on_mobile ? 15 : -15, 'align': 'end', 'text': on_mobile ? ranks.me_mob_conf_str : ranks.me_conf_str}];
                
                data['legend'] = {'items': [], 'layout': 'horizontal'}
                data.legend.items.push({'icon_type': 'rect', 'fill': 'orange', 'label': misc.data.short_code + " Bucket"})
                
                horizontal_trainmap(data, unit_desc + '_ranks_graph_div', specs);
                
            }
            
            
            filter_options_faceoffs_dtop = $("#faceoffs_ranks_filter_options_dtop"); filter_options_faceoffs_dtop.empty();
            filter_options_faceoffs_mob = $("#faceoffs_ranks_filter_options_mob"); filter_options_faceoffs_mob.empty();
            
            
            for(var a = 0 ;a<filters[unit].options.length;a++){
                var fltr = filters[unit].options[a];
                html = "";
                html += "<div class='col-12-4 no-padding'>";
                html += "<div class='col-12 no-padding'><span class=' font-11 light'>" + fltr.desc + "</span></div>";
                
                for(var b = 0;b<fltr.choices.length;b++){
                    choice = fltr.choices[b];
                    html += "<div class='flex no-padding'>";
                    
                    html += "<div class='col-10 no-padding' style='padding-left:10px;'><span class='no-padding font-11'>" + choice.desc + "</span></div>";
                    html += "<div class='col-2 no-padding'><input id=\'" + [unit, fltr.tag].join("|") + "' " + (choice.selected ? " checked" : "") + " value='" + [unit, fltr.tag, choice.val].join("|") + "' type=checkbox onclick='toggle_rank_filter(this.id, this.value, this.checked);'></div>";
                    html += "</div>";
                    
                    
                }
                html += "</div>";
                filter_options_faceoffs_dtop.append(html); filter_options_faceoffs_mob.append(html);
            }
            /* mark complete */
            success = true;
        }
        catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
        if(!success){
            $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
            report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
        }
         
        id = 'faceoff_elo'; success = false;
        try{
            /* data */
            console.log("misc.data.fogos");
            console.log(misc.data.fogos);
            misc.data.fogos.sort(function(first, second) {          
                return second.faceoff_ELO - first.faceoff_ELO;
                            });
        
            misc.data.fogos= misc.data.fogos.filter(r => r.display);
            
            /* visualization */
            elem = $("#faceoff_elo_div"); elem.empty();
            
            html = "";
            html += "<div class='flex col-12 no-padding bbottom'>";
            
            html += "<div class='col-6 no-padding'>";
            html += "<span class='font-15 bold'>Player</span>";
            html += "</div>";
            
            html += "<div class='col-2 no-padding centered'>";
            html += "<span class='font-15 bold'>Win %</span>";
            html += "</div>";
            
            html += "<div class='col-2 no-padding centered'>";
            html += "<span class='font-15 bold'>ELO</span>";
            html += "</div>";
            
            html += "<div class='col-2 no-padding centered'>";
            html += "<span class='font-15 bold'>Season</span>";
            html += "</div>";
            
            html += "</div>";
            elem.append(html);
            
            for(var a = 0;a<misc.data.fogos.length;a++){
                fogo = misc.data.fogos[a];
                html = "";
                html += "<div class='table-row'>";
                html += "<div class='flex col-12 no-padding'>"
                
                html += "<div class='col-6 no-padding'>";
                html += "<FORM id='player" + fogo.player_ID + "form' action='/team_player_detail' method=POST><input type=hidden name='ID' value='" + fogo.player_ID+ "'><input type=hidden name='came_from' value='team_my_stats'><span onclick=\"document.getElementById(\'player" + fogo.player_ID + "form\').submit();\" class='no-padding'>" + fogo.player+ "</span></FORM>";
                //html += "<span class='font-15'>" + fogo.player + "</span>";
                html += "</div>";
                
                html += "<div class='col-2 no-padding centered'>";
                html += "<span class='font-15'>" + fogo.faceoff_pct_str + "</span>";
                html += "</div>";
                
                html += "<div class='col-2 no-padding centered'>";
                html += "<span class='font-15'>" + fogo.faceoff_ELO_str + "</span>";
                html += "</div>";
                
                html += "<div class='col-2 no-padding centered' id='faceoff_elo_spark" + a + "'></div>";
                
                html += "</div>";
                html += "</div>";
                elem.append(html);
            }
            var min_val = null; var max_val = null;
            for(var a = 0;a<misc.data.fogos.length;a++){
                fogo = misc.data.fogos[a];
                for(var b = 0;b<fogo.faceoff_ELO_history.length;b++){
                    y = fogo.faceoff_ELO_history[b].y;
                    if(min_val == null || min_val > y){ min_val = y; }
                    if(max_val == null || max_val < y){ max_val = y; }
                }
            }
            if(min_val < 1400 && max_val > 1600){  // Both ends are outside of the range
                if((max_val - 1500) > (1500 - min_val)){ // Check which is farther away; here it is the max
                    y_max = max_val; y_min = 1500 - (max_val - 1500);
                }
                else{
                    y_min = min_val; y_max = 1500 + (1500 - min_val);
                }
            }
            else if(min_val >= 1400 && max_val > 1600){ 
                y_max = max_val; y_min = 1500 - (max_val - 1500);
            }
            else if(min_val < 1400 && max_val <= 1600){ 
                y_min = min_val; y_max = 1500 + (1500 - min_val) ;
            }
            else if(min_val >= 1400 && max_val <= 1600){ 
                y_min = 1400; y_max = 1600;
            }
            y_min -= 25; y_max += 25;
            
            // Use the min of any team member FOGO and the max for all the charts instead of a min/max that is chart-specific
            
            for(var a = 0;a<misc.data.fogos.length;a++){
                fogo = misc.data.fogos[a];
                
                specs = {'highlight': 1, 'margin_left': 10, 'margin_right': 10, 'margin_top': 2, 'margin_bottom': 0, 'chart_size': 'spark', 'flip': 0};
            
                data = {'data': []};
                if(fogo.faceoff_ELO_history.length > 1){
                    start = fogo.faceoff_ELO_history[0].y;
                    end = fogo.faceoff_ELO_history[fogo.faceoff_ELO_history.length - 1].y;
                    
                    tmp = {'stroke-width': '2', 'points': []}
                    if(end > start){
                        tmp.stroke = "#3F3";
                    }
                    else{
                        tmp.stroke = "#800";
                    }
                    tmp.points = fogo.faceoff_ELO_history;
                    data.data.push(tmp)
                    
                    x_ticks = create_game_x_ticks(data.data);
                    data['x_ticks'] = x_ticks.ticks; data['max_x'] = x_ticks.max; data['min_x'] = x_ticks.min;
                    y_ticks = create_numeric_y_ticks(data.data)
                    data['y_ticks'] = y_ticks.ticks;
                    data['max_y'] = y_max;  data['min_y'] = y_min;
                    
                }
                specs.width = $('#' + id + '_container_div').width() * .166;
                
                specs.height = 19;
                spark_line(data, "faceoff_elo_spark" + a, specs);
                
            }
            
             
            /* mark complete */
            success = true;
        }
        catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
        if(!success){
            $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
            report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
        }
         
        id = 'faceoff_splits'; success = false;
        try{
            /* data */
            
            console.log("misc.data.fogo_splits");
            console.log(misc.data.fogo_splits);
            
                
            /* visualization */
  
            html = ""; $("#" + id + "_div").empty();
            for(var a = 0;a<misc.data.fogo_splits.length;a++){
                sp = misc.data.fogo_splits[a];
                
                if(a % 2 == 0){ html += "<div class='flex no-padding'>"; }
                    html += "<div class='col-6' style='margin:5px; background-color: #EEF;'><div class='no-padding'>";
                        html += "<div class='col-12 no-padding'><span class='light font-11'>" + sp.header + "</span></div>";
                        for(var b = 0;b<sp.options.length;b++){
                            o = sp.options[b];
                      
                            spark_bar_id = "spark_bar_fogo_splits_div" + a + "_" + b;
                            
                            html += "<div class='col-12 no-padding flex'>";
                            html += "<div class='col-6 no-padding'><span class='font-12'>" + o.label + "</span></div>";
                            html += "<div class='col-6 no-padding'><div class='no-padding spark-bar ' id=\'" + spark_bar_id + "' style=''></div></div>";
                            /*html += "<div class='col-4 no-padding right'><span class='font-12' style='font-style:italic;'>n = " + o.cnt_str + "</span></div>";*/
                            html += "</div>";  
                        }
                    html += "</div></div>";
                
                if(a % 2 == 1 || a == misc.data.fogo_splits.length-1){ html += "</div>"; }
               
                
                
                
            }
            $("#" + id + "_div").append(html)
            for(var a = 0;a<misc.data.fogo_splits.length;a++){
                sp = misc.data.fogo_splits[a];
                for(var b = 0;b<sp.options.length;b++){
                    o = sp.options[b];
                    spark_bar_id = "spark_bar_fogo_splits_div" + a + "_" + b;
                    
                    w = $('#faceoff_splits_container_div').width() * .5 * .5 * .95;
                    spark_bar(spark_bar_id, {'width': w, 'chart_size': 'small', 'label': (o.pct != null) ? (zFormat(100.0 * o.pct, 0) + "%") : null, 'margin_left': 0, 'margin_top': 0, 'margin_bottom': 0, 'margin_right': 0, 'height': 15, 'bar_width': o.pct, 'bar_fill': "#FFF", 'fill': "#88F"});
                }
            }
            
            /* mark complete */
            success = true;
        }
        catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
        if(!success){
            $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
            report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
        }
         
    }
    
    function display_goalkeepers(panel){
        unit = "goalkeepers"; unit_desc = unit;
        if([null, 'goalkeepers', 'goalkeepers_list', '', '', ''].indexOf(panel) == -1){ return; }

        id = 'goalkeepers_ranks'; success = false;
 
        ranks = calculate_ranks(misc.extra_data.db_team_game_summaries, misc.extra_data.db_teams, misc.data.ranks.keys, calc_specs[unit], ranks_stat_tag[unit]);

        try{
            /* data */
            stat_key = misc.data.ranks.stat_keys.filter( r => r.tag == ranks_stat_tag[unit])[0];
       
                
            /* visualization */
            if(calc_specs[unit].peers == "league"){
                specs = {'highlight': 1, 'margin_left': 25, 'chart_size': 'bigger', 'flip': 0};
            
                data = {'axis_labels': {'y': 'Number of teams grouped by ' + stat_key.desc, 'x': stat_key.desc}, 'data': []};
                tmp = {'stroke-dasharray': '3-3', 'stroke': "#666", 'points': []}

                tmp.points = ranks.buckets;
                data.data.push(tmp)
                
                x_ticks = create_game_x_ticks(data.data);
                data['x_ticks'] = x_ticks.ticks; data['max_x'] = x_ticks.max; data['min_x'] = x_ticks.min;
                y_ticks = create_numeric_y_ticks(data.data)
                data['y_ticks'] = y_ticks.ticks;
                data['max_y'] = y_ticks.max;  data['min_y'] = 0;
                if(on_mobile){
                    specs.width = $('#' + unit_desc + '_ranks_container_div').width()-20;
                }
                else{
                    specs.width = $('#' + unit_desc + '_ranks_container_div').width()*.66667-20;
                }
                data.text = [{'x': specs.width-35, 'y': on_mobile ? 15 : -15, 'align': 'end', 'text': on_mobile ? ranks.me_mob_str : ranks.me_str}];
                
                data['legend'] = {'items': [], 'layout': 'horizontal'}
                data.legend.items.push({'icon_type': 'rect', 'fill': 'orange', 'label': misc.data.short_code + " Bucket"})
                
                vertical_bars(data, unit_desc + '_ranks_graph_div', specs);
            }
            else{ // Show the conference line bubbles
                specs = {'highlight': 1, 'margin_left': 60, 'margin-right': 60, 'chart_size': 'bigger', 'flip': 0};
            
                data = {'show-data-labels': 'short_code', 'axis_labels': {'y': 'Conf teams; axis = ' + stat_key.desc, 'x': stat_key.desc}, 'data': []};
                tmp = {'stroke-dasharray': '3-3', 'stroke': "#666", 'points': []}
                tmp.points = ranks.teams.filter(r => r.conference_ID == misc.data.conference_ID);
                data.data.push(tmp)
                
                x_ticks = create_game_x_ticks(data.data);
                data['x_ticks'] = x_ticks.ticks; data['max_x'] = x_ticks.max; data['min_x'] = x_ticks.min;
                y_ticks = create_numeric_y_ticks(data.data)
                data['y_ticks'] = y_ticks.ticks;
                data['max_y'] = y_ticks.max;  data['min_y'] = 0;
                if(on_mobile){
                    specs.width = $('#' + unit_desc + '_ranks_container_div').width()-20;
                }
                else{
                    specs.width = $('#' + unit_desc + '_ranks_container_div').width()*.66667-20;
                }
                data.text = [{'x': specs.width-65, 'y': on_mobile ? 15 : -15, 'align': 'end', 'text': on_mobile ? ranks.me_mob_conf_str : ranks.me_conf_str}];
                
                data['legend'] = {'items': [], 'layout': 'horizontal'}
                data.legend.items.push({'icon_type': 'rect', 'fill': 'orange', 'label': misc.data.short_code + " Bucket"})
                
                horizontal_trainmap(data, unit_desc + '_ranks_graph_div', specs);
                
            }
            
            
            filter_options_goalkeepers_dtop = $("#goalkeepers_ranks_filter_options_dtop"); filter_options_goalkeepers_dtop.empty();
            filter_options_goalkeepers_mob = $("#goalkeepers_ranks_filter_options_mob"); filter_options_goalkeepers_mob.empty();
            
            
            for(var a = 0 ;a<filters[unit].options.length;a++){
                var fltr = filters[unit].options[a];
                html = "";
                html += "<div class='col-12-4 no-padding'>";
                html += "<div class='col-12 no-padding'><span class=' font-11 light'>" + fltr.desc + "</span></div>";
                
                for(var b = 0;b<fltr.choices.length;b++){
                    choice = fltr.choices[b];
                    html += "<div class='flex no-padding'>";
                    
                    html += "<div class='col-10 no-padding' style='padding-left:10px;'><span class='no-padding font-11'>" + choice.desc + "</span></div>";
                    html += "<div class='col-2 no-padding'><input id=\'" + [unit, fltr.tag].join("|") + "' " + (choice.selected ? " checked" : "") + " value='" + [unit, fltr.tag, choice.val].join("|") + "' type=checkbox onclick='toggle_rank_filter(this.id, this.value, this.checked);'></div>";
                    html += "</div>";
                    
                    
                }
                html += "</div>";
                filter_options_goalkeepers_dtop.append(html); filter_options_goalkeepers_mob.append(html);
            }
            /* mark complete */
            success = true;
        }
        catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
        if(!success){
            $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
            report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
        }
        
        id = 'goalkeepers_list'; success = false;
        
        try{
            /* data */
            keepers = misc.data.roster.filter(r=> r.role=="goalkeeper");
            
            console.log("keepers"); console.log(keepers)
            for(var a = 0;a<keepers.length;a++){
                p = keepers[a];
                p.seq = a;
                p.save_pct = p.shots_faced > 0 ? 1.0 - (p.goals_allowed / p.shots_faced) : null;
                p.sog_rate = p.shots_faced > 0 ? 1.0 - (p.sog_faced / p.shots_faced) : null;
                p.excess_saves = p.expected_goals_allowed - p.goals_allowed;
            }
            
            /* visualization */
            
            var js_data = {'no_row_count': 1, 'fields': [], 'cell_size': 'cell-holder'}
            js_data.classes = [{'class': 'col-2-4 mouseover-link'}, {'outer_class': 'col-10-8', 'classes': [{'class': 'right'}, {'class': 'right'}, {'class': 'right'}, {'class': 'right'}, {'class': 'right'}, {'class': 'right'}, {'class': 'right'}]}];
            js_data.fmt = [{'fmt': ""}, {'fmt': "0%"}, {'fmt': "0"}, {'fmt': "0"}, {'fmt': "1%"}, {'fmt': "0"}, {'fmt': "1"}, {'fmt': "1"}];
            js_data.fields.push({'sort_by': 'player', 'tag': 'player', 'display': 'Player'});
            js_data.fields.push({'sort_by': 'save_pct', 'tag': 'save_pct', 'display': 'Save Pct'});
            js_data.fields.push({'sort_by': 'shots_faced', 'tag': 'shots_faced', 'display': 'Shots Faced'});
            js_data.fields.push({'sort_by': 'sog_faced', 'tag': 'sog_faced', 'display': 'S.O.G. Faced'});
            js_data.fields.push({'sort_by': 'sog_rate', 'tag': 'sog_rate', 'display': 'S.O.G. Rate'});
            js_data.fields.push({'sort_by': 'goals_allowed', 'tag': 'goals_allowed', 'display': 'Goals'});
            js_data.fields.push({'sort_by': 'expected_goals_allowed', 'tag': 'expected_goals_allowed', 'display': 'Expected GA'});
            js_data.fields.push({'sort_by': 'excess_saves', 'tag': 'excess_saves', 'display': 'Excess Saves'});
                    
            
            js_data.data = keepers;
            generic_create_table(js_data, {'id': "goalkeepers_list_div", 'target_elem': "goalkeepers_list_div"});
            /* mark complete */
            success = true;
        }
        catch(err){ console.log("Error caught: " + id); if(!misc.on_server){ console.error(err.stack); } }
        if(!success){
            $("#" + id).empty(); $("#" + id).append(single_stat.split("</div>")[1].replace('[stat]', "Data could not be displayed."));
            report_js_visualization_issue(misc.target_template + "|" + id + "|" + misc.nhca);
        }
                

    }
    
    function redraw(panel=null){
        on_mobile = $("#main_logo").css('display') == "none";
        
        if(typeof panel == "object"){ panel = null; }
        
        console_log.push({'msg': 'Check misc.data...'});
        if('data' in misc && [{}, null].indexOf(misc.data) == -1){
            console_log.push({'msg': 'schedule...'});
            display_schedule(panel);
            console_log.push({'msg': 'roster...'});
            display_roster(panel);
            console_log.push({'msg': 'rankings...'});
            display_rankings(panel);
            console_log.push({'msg': 'stats: offensive...'});
            display_primary_unit("offense", panel);
            console_log.push({'msg': 'stats: defensive...'});
            display_primary_unit("defense", panel);
            console_log.push({'msg': 'stats: faceoffs...'});
            display_faceoffs(panel);
            console_log.push({'msg': 'stats: goalkeepers...'});
            display_goalkeepers(panel);
            
            
            
            if('observe' in misc && misc.observe){ report_user_view(misc.handler + "|" + panel + "|" + misc.nhca); }
        }
        
    }
    
    unit = "offense"; unit_desc = "offensive";
    toggle = {'val': calc_specs[unit].calculation == "raw" ? 0 : 1, 'start_x': 25, 'end_x': 40, 'id': 'movement_mob_calculation', 'text_align': 'right', 'start_label': 'Raw', 'end_label': "Adjusted"};
    display_toggle(toggle, unit_desc + '_movement_mob_calculation', {'chart_size': 'small', 'class': unit_desc + '_calculation_radio', 'height': 20});
    toggle = {'val': calc_specs[unit].calculation == "raw" ? 0: 1, 'start_x': 25, 'end_x': 40, 'id': 'ranks_mob_calculation', 'text_align': 'right', 'start_label': 'Raw', 'end_label': "Adjusted"};
    display_toggle(toggle, unit_desc + '_ranks_mob_calculation', {'chart_size': 'small', 'class': unit_desc + '_calculation_radio', 'height': 20});
    
    
    toggle = {'val': calc_specs[unit].peers == "conference" ? 1 : 0, 'start_x': 30, 'end_x': 40, 'id': 'movement_mob_peers', 'text_align': 'right', 'start_label':  'League', 'end_label': "Conference"};
    display_toggle(toggle, unit_desc + '_movement_mob_peers', {'chart_size': 'small', 'class': unit_desc + '_peers_radio', 'height': 20});
    toggle = {'val': calc_specs[unit].peers == "conference" ? 1 : 0, 'start_x': 30, 'end_x': 40, 'id': 'ranks_mob_peers', 'text_align': 'right', 'start_label': 'League', 'end_label': "Conference"};
    display_toggle(toggle, unit_desc + '_ranks_mob_peers', {'chart_size': 'small', 'class': unit_desc + '_peers_radio', 'height': 20});
    
    unit = "defense"; unit_desc = "defensive";
    toggle = {'val': calc_specs[unit].calculation == "raw" ? 0 : 1, 'start_x': 25, 'end_x': 40, 'id': 'movement_mob_calculation', 'text_align': 'right', 'start_label': 'Raw', 'end_label': "Adjusted"};
    display_toggle(toggle, unit_desc + '_movement_mob_calculation', {'chart_size': 'small', 'class': unit_desc + '_calculation_radio', 'height': 20});
    toggle = {'val': calc_specs[unit].calculation == "raw" ? 0: 1, 'start_x': 25, 'end_x': 40, 'id': 'ranks_mob_calculation', 'text_align': 'right', 'start_label': 'Raw', 'end_label': "Adjusted"};
    display_toggle(toggle, unit_desc + '_ranks_mob_calculation', {'chart_size': 'small', 'class': unit_desc + '_calculation_radio', 'height': 20});
    
    toggle = {'val': calc_specs[unit].peers == "conference" ? 1 : 0, 'start_x': 30, 'end_x': 40, 'id': 'movement_mob_peers', 'text_align': 'right', 'start_label':  'League', 'end_label': "Conference"};
    display_toggle(toggle, unit_desc + '_movement_mob_peers', {'chart_size': 'small', 'class': unit_desc + '_peers_radio', 'height': 20});
    toggle = {'val': calc_specs[unit].peers == "conference" ? 1 : 0, 'start_x': 30, 'end_x': 40, 'id': 'ranks_mob_peers', 'text_align': 'right', 'start_label': 'League', 'end_label': "Conference"};
    display_toggle(toggle, unit_desc + '_ranks_mob_peers', {'chart_size': 'small', 'class': unit_desc + '_peers_radio', 'height': 20});
    
    unit = "faceoffs"; unit_desc = unit;
    toggle = {'val': calc_specs[unit].calculation == "raw" ? 0 : 1, 'start_x': 25, 'end_x': 40, 'id': 'movement_mob_calculation', 'text_align': 'right', 'start_label': 'Raw', 'end_label': "Adjusted"};
    display_toggle(toggle, unit_desc + '_movement_mob_calculation', {'chart_size': 'small', 'class': unit_desc + '_calculation_radio', 'height': 20});
    toggle = {'val': calc_specs[unit].calculation == "raw" ? 0: 1, 'start_x': 25, 'end_x': 40, 'id': 'ranks_mob_calculation', 'text_align': 'right', 'start_label': 'Raw', 'end_label': "Adjusted"};
    display_toggle(toggle, unit_desc + '_ranks_mob_calculation', {'chart_size': 'small', 'class': unit_desc + '_calculation_radio', 'height': 20});
    
    toggle = {'val': calc_specs[unit].peers == "conference" ? 1 : 0, 'start_x': 30, 'end_x': 40, 'id': 'movement_mob_peers', 'text_align': 'right', 'start_label':  'League', 'end_label': "Conference"};
    display_toggle(toggle, unit_desc + '_movement_mob_peers', {'chart_size': 'small', 'class': unit_desc + '_peers_radio', 'height': 20});
    toggle = {'val': calc_specs[unit].peers == "conference" ? 1 : 0, 'start_x': 30, 'end_x': 40, 'id': 'ranks_mob_peers', 'text_align': 'right', 'start_label': 'League', 'end_label': "Conference"};
    display_toggle(toggle, unit_desc + '_ranks_mob_peers', {'chart_size': 'small', 'class': unit_desc + '_peers_radio', 'height': 20});
    
    unit = "goalkeepers"; unit_desc = unit;
    toggle = {'val': calc_specs[unit].calculation == "raw" ? 0 : 1, 'start_x': 25, 'end_x': 40, 'id': 'movement_mob_calculation', 'text_align': 'right', 'start_label': 'Raw', 'end_label': "Adjusted"};
    display_toggle(toggle, unit_desc + '_movement_mob_calculation', {'chart_size': 'small', 'class': unit_desc + '_calculation_radio', 'height': 20});
    toggle = {'val': calc_specs[unit].calculation == "raw" ? 0: 1, 'start_x': 25, 'end_x': 40, 'id': 'ranks_mob_calculation', 'text_align': 'right', 'start_label': 'Raw', 'end_label': "Adjusted"};
    display_toggle(toggle, unit_desc + '_ranks_mob_calculation', {'chart_size': 'small', 'class': unit_desc + '_calculation_radio', 'height': 20});
    
    toggle = {'val': calc_specs[unit].peers == "conference" ? 1 : 0, 'start_x': 30, 'end_x': 40, 'id': 'movement_mob_peers', 'text_align': 'right', 'start_label':  'League', 'end_label': "Conference"};
    display_toggle(toggle, unit_desc + '_movement_mob_peers', {'chart_size': 'small', 'class': unit_desc + '_peers_radio', 'height': 20});
    toggle = {'val': calc_specs[unit].peers == "conference" ? 1 : 0, 'start_x': 30, 'end_x': 40, 'id': 'ranks_mob_peers', 'text_align': 'right', 'start_label': 'League', 'end_label': "Conference"};
    display_toggle(toggle, unit_desc + '_ranks_mob_peers', {'chart_size': 'small', 'class': unit_desc + '_peers_radio', 'height': 20});
    
    
    //console.log("misc.active_element");
    //console.log(misc.active_element);
    // Select the appropriate panel to display
    if('active_element' in misc && ["None", null, -1, ' ', ''].indexOf(misc.active_element) == -1){ choose_left_menu_item(misc.active_element); }
    else{ choose_left_menu_item("offense"); }
    
    console_log.push({'msg': 'Start finish load...'});
    finish_load(JSON.parse({{user_obj.notifications|to_json2}}));
    
    window.addEventListener("resize", redraw); 
</script>
{% endblock %}

